"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,i=new Array(e.length);t<e.length;t++)i[t]=e[t];return i}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var CBC;window.CBC||(window.CBC={}),CBC.APP||(CBC.APP={}),CBC.APP.versions||(CBC.APP.versions={}),CBC.APP.versions["cbc-stats-bottom"]="2.59.0",window.CBC||(window.CBC={}),CBC.APP||(CBC.APP={}),CBC.APP.SC||(CBC.APP.SC={}),CBC.APP.SC.Detectizr=function(e){var t=e||(window.navigator.userAgent||window.navigator.vendor||window.opera).toLowerCase();function i(e){return e.test(t)}function n(e){return-1<t.indexOf(e)}function a(e){return e.exec(t)}function r(e,t){var i=(e.version=t).split(".");0<i.length?(i=i.reverse(),e.major=i.pop(),0<i.length?(e.minor=i.pop(),0<i.length?(i=i.reverse(),e.patch=i.join(".")):e.patch="0"):e.minor="0"):e.major="0"}var o={type:"",model:""},s={},c=["tv","tablet","mobile","desktop"];return i(/googletv|smarttv|smart-tv|internet.tv|netcast|nettv|appletv|boxee|kylo|dlnadoc|roku|pov_tv|hbbtv|ce-html/)?(o.type=c[0],o.model="smartTv"):i(/xbox|playstation.3|wii/)?(o.type=c[0],o.model="gameConsole"):i(/ip(a|ro)d/)?(o.type=c[1],o.model="ipad"):i(/tablet/)&&!i(/rx-34/)||i(/folio/)?(o.type=c[1],o.model=String(a(/playbook/)||"")):i(/linux/)&&i(/android/)&&!i(/fennec|mobi|htc.magic|htcX06ht|nexus.one|sc-02b|fone.945/)?(o.type=c[1],o.model="android"):i(/kindle/)||i(/mac.os/)&&i(/silk/)?(o.type=c[1],o.model="kindle"):i(/gt-p10|sc-01c|shw-m180s|sgh-t849|sch-i800|shw-m180l|sph-p100|sgh-i987|zt180|htc(.flyer|_flyer)|sprint.atp51|viewpad7|pandigital(sprnova|nova)|ideos.s7|dell.streak.7|advent.vega|a101it|a70bht|mid7015|next2|nook/)||i(/mb511/)&&i(/rutem/)?(o.type=c[1],o.model="android"):i(/bb10/)?(o.type=c[1],o.model="blackberry"):(o.model=a(/iphone|ipod|android|blackberry|opera mini|opera mobi|skyfire|maemo|windows phone|palm|iemobile|symbian|symbianos|fennec|j2me/),null!==o.model?(o.type=c[2],o.model=String(o.model)):(o.model="",i(/bolt|fennec|iris|maemo|minimo|mobi|mowser|netfront|novarra|prism|rx-34|skyfire|tear|xv6875|xv6975|google.wireless.transcoder/)||i(/opera/)&&i(/windows.nt.5/)&&i(/htc|xda|mini|vario|samsung-gt-i8000|samsung-sgh-i9/)?o.type=c[2]:i(/windows.(nt|xp|me|9)/)&&!i(/phone/)||i(/win(9|.9|nt)/)||i(/\(windows 8\)/)?o.type=c[3]:i(/macintosh|powerpc/)&&!i(/silk/)?(o.type=c[3],o.model="mac os"):i(/cros/)?o.type=c[3]:o.type=c[2])),""!==o.model&&("ipad"===o.model||"iphone"===o.model||"ipod"===o.model?(s.name="ios",r(s,(i(/os\s([\d_]+)/)?RegExp.$1:"").replace(/_/g,"."))):"android"===o.model?(s.name="android",r(s,i(/android\s([\d.]+)/)?RegExp.$1:"")):"blackberry"===o.model?(s.name="blackberry",r(s,i(/version\/([^\s]+)/)?RegExp.$1:"")):"playbook"===o.model&&(s.name="blackberry",r(s,i(/os ([^\s]+)/)?RegExp.$1.replace(";",""):""))),s.name||(n("win")||n("16bit")?(s.name="windows",n("windows nt 10")?r(s,"10"):n("windows nt 6.3")?r(s,"8.1"):n("windows nt 6.2")||i(/\(windows 8\)/)?r(s,"8"):n("windows nt 6.1")?r(s,"7"):n("windows nt 6.0")?r(s,"vista"):(n("windows nt 5.2")||n("windows nt 5.1")||n("windows xp"))&&r(s,"xp")):n("mac")||n("darwin")?(s.name="mac os",n("os x")&&r(s,(i(/os\sx\s([\d_]+)/)?RegExp.$1:"os x").replace(/_/g,"."))):n("webtv")?s.name="webtv":(n("x11")||n("inux"))&&(s.name="linux")),{os:s,device:o,ua:t}},window.Detectizr=CBC.APP.SC.Detectizr(),(CBC=CBC||{}).APP=CBC.APP||{},function(){if(!CBC.APP.PubSub){var e=function(){function n(e,t,i){_classCallCheck(this,n),this.subscribers=e||{},this.queuedEvents=t||[],this.isOn=i||!1}return _createClass(n,[{key:"turnOn",value:function(){if(this.isOn=!0,0<this.queuedEvents.length)for(var e=0;e<this.queuedEvents.length;e++)this.publish(this.queuedEvents[e].event,this.queuedEvents[e].payload),this.queuedEvents.splice(e,1)}},{key:"turnOff",value:function(){this.isOn=!1}},{key:"isOn",value:function(){return this.isOn}},{key:"publish",value:function(t,i){t in this.subscribers?this.subscribers[t].slice().forEach(function(e){try{e(t,i)}catch(e){console.error(e.message)}}):this.isOn||this.queuedEvents.push({event:t,payload:i})}},{key:"subscribe",value:function(e,t){return e in this.subscribers||(this.subscribers[e]=[]),this.subscribers[e].some(function(e){if(t===e)return!0})?(console.log("callback already exists for event:",e,t),!1):(this.subscribers[e].push(t),!0)}},{key:"unsubscribe",value:function(e,n){e in this.subscribers&&this.subscribers[e].some(function(e,t,i){if(n===e)return i.splice(t,1),!0})}}]),n}();CBC.APP.PubSub=new e}}(),(CBC=CBC||{}).APP=CBC.APP||{},CBC.APP.SC=CBC.APP.SC||{},CBC.APP.SC.viafouraSubscribed=!1,function(){function e(){CBC.APP.SC.viafouraSubscribed||(CBC.APP.SC.DEBUG&&console.log("Subscribing to Viafoura events"),window.vf.$subscribe("share","clicked",function(e,t){var i={network:e,elem:t};CBC.APP.SC.EventTracker.trackEvent("SHARED",i)}),window.vf.$subscribe("logout","success",function(){CBC.APP.SC.EventTracker.trackEvent("SIGNED OUT",{})}),window.vf.$subscribe("login","success",function(e){e&&1==e.isNewUser?CBC.APP.SC.EventTracker.trackEvent("SIGNED IN",{feature:{name:"sign-up-form"}}):CBC.APP.SC.EventTracker.trackEvent("SIGNED IN",{})}),window.vf.$subscribe("comment","created",function(e){CBC.APP.SC.EventTracker.trackEvent("COMMENTED",{})}),window.vf.$subscribe("comment-reply","posted",function(e){CBC.APP.SC.EventTracker.trackEvent("COMMENTED",{})}),CBC.APP.SC.viafouraSubscribed=!0,CBC.APP.PubSub.publish("viafouraAvailable",{}))}void 0!==window.vf?e():(window.vfQ=window.vfQ||[],window.vfQ.push(e)),CBC.APP.PubSub.subscribe("loadedAudiences",function e(){if(CBC.APP.DMP.LOTAME&&CBC.APP.DMP.LOTAME.audiences&&CBC.APP.DMP.LOTAME.audiences.Profile&&CBC.APP.DMP.LOTAME.audiences.Profile.Audiences&&CBC.APP.DMP.LOTAME.audiences.Profile.Audiences.Audience&&0<CBC.APP.DMP.LOTAME.audiences.Profile.Audiences.Audience.length){var t=CBC.APP.DMP.LOTAME.audiences.Profile.Audiences.Audience.filter(function(e){return e.id}).map(function(e){return e.id});0<t.length&&(CBC.APP.SC.EventTracker.mUP("set","user.segments.dmp.ids",t),CBC.APP.PubSub.unsubscribe("loadedAudiences",e))}})}(),function(){function e(e){var t=e=e.replace(":","");try{for(var i=0;i<100&&t!=(e=decodeURIComponent(e))&&!e.match(/^http(s)?\:/);i++)t=e}catch(e){}return e.replace(/(^\s+|\s+$)/g,"")}try{var r=function(e,t,i,n){return e[t]===n&&0===i||e[i]===n&&0===t};if(!location||!location.hostname||!location.pathname)return;var t,i,n,a,o=document.location.hostname.replace(/^www\./,""),s=function(){for(var e,t,i=document.getElementsByTagName("meta"),n=0,a=i.length;n<a;n++)if("og:title"===(t=i[n]).getAttribute("property")){e=t.getAttribute("content");break}return e=e||(document.title||"Untitled")}(),c=(B=s,(T=c={}).l1=o,T.l2=B,T.l3="__page__",T.l4="-",T),u=(new Date).getTime(),l=Math.floor(Math.random()*Math.pow(10,12));t=(i=function(){for(var e=[64],t=1;t<=3;t++)e.push(64+t),e.push(64-t);return{b:e=e[Math.floor(Math.random()*e.length)],a:0==Math.floor(Math.random()*e)}}()).a?i.b:0,c.zmoatab_cm=t,c.t=u,c.de=l,c.zMoatAB_SNPT=!0,n=t||1,a=!i||!!i.a;o=[];var d,p=(new Date).getTime().toString(35),h=[e(c.l1),e(c.l2),e(c.l3),e(c.l4)].join(":"),C=(s=/zct[a-z0-9]+/i,"");for(d in c)c.hasOwnProperty(d)&&d.match(s)&&(C+="&"+d+"="+c[d]);var g=document.referrer.match(/^([^:]{2,}:\/\/[^\/]*)/),f=g?g[1]:document.referrer,m=["e=17","d="+encodeURIComponent(h),"de="+l,"t="+u,"i=CBCCONTENT2","cm="+n,String("j="+encodeURIComponent(f)+C),"mp=1","ac=1","pl=1","bq=10","vc=2"],b=(p="https://5j8ujmnywdoc-a.akamaihd.net/"+p+".gif?")+(b=function(e){for(var t="",i=0;i<e.length;i++)t+=(0===i?"":"&")+e[i];return t}(function(e){for(var t=0;t<e.length;t++){var i=Math.floor(Math.random()*(e.length-t)+t),n=e[t],a=r(e,t,i,m[1]);r(e,t,i,m[0])||a?t--:(e[t]=e[i],e[i]=n)}return e}(m)))+"&cs=0",v="https://px.moatads.com/pixel.gif?e=17&d="+encodeURIComponent(h)+"&de="+l+"&t="+u+"&i=CBCCONTENT2&cm="+n+"&j="+encodeURIComponent(f)+C+"&mp=0&ac=1&pl=1&bq=10&ad_type=img&vc=2&cs=0",P="https://px.moatads.com/pixel.gif?e=17&d="+encodeURIComponent(h)+"&de="+l+"&t="+u+"&i=CBCCONTENT2&cm="+n+"&j="+encodeURIComponent(f)+C+"&ku=1&ac=1&pl=1&bq=10&ad_type=img&vc=2&cs=0";for(var S in a&&((new Image).src=b,(new Image).src=v),c)o.push(S+"="+encodeURIComponent(c[S]));o=(o=o.join("&"))+"&vc=2";var w=document.createElement("script");w.type="text/javascript",w.async=!0,a&&(w.onerror=function(){(new Image).src=P});var A=document.getElementsByTagName("script")[0];A.parentNode.insertBefore(w,A),w.src="https://z.moatads.com/cbc907UvMO43/moatcontent.js#"+o}catch(e){try{var y="//pixel.moatads.com/pixel.gif?e=24&d=data%3Adata%3Adata%3Adata&i=MOATCONTENTABSNIPPET1"+C+"&vc=2&ac=1&k="+encodeURIComponent(e)+"&j="+encodeURIComponent(f)+"&cs="+(new Date).getTime();(new Image).src=y}catch(e){}}var T,B}(),window._sf_endpt=(new Date).getTime(),window.CBC||(window.CBC={}),CBC.APP||(CBC.APP={}),CBC.APP.COMSCORE||(CBC.APP.COMSCORE={}),CBC.APP.COMSCORE={useBeacon:!1,payload:{c1:2,c2:3005684},dataStructure:{},Call:function(){if(CBC.APP.SC.DTM.formatted.comscore&&(this.dataStructure=CBC.APP.SC.DTM.formatted.comscore),this.useBeacon)this.pvCandidate();else{this.useBeacon=!0;var e="",t={};if(0<Object.keys(this.dataStructure).length){if(this.dataStructure.syndicate&&"gamp"===this.dataStructure.syndicate)return!1;e=this.getC6(),t=this.getOptions()}var i={c3:"",c4:escape(window.location.href),c5:"CBC.ca-CanadianNewsSportsEntertainmentKidsDocsRadioTV",c6:e,c15:"",options:t},n=window._comscore||[];n.push(this.generatePayload(i,this.payload)),window._comscore=n,this.pvCandidate();var a=document.createElement("script"),r=document.getElementsByTagName("script")[0];a.async=!0,a.src="https://sb.scorecardresearch.com/beacon.js",r.parentNode.insertBefore(a,r)}},getC6:function(){var e="";return this.dataStructure.subsection3?e=this.dataStructure.subsection3:this.dataStructure.subsection2?e=this.dataStructure.subsection2:this.dataStructure.subsection1&&(e=this.dataStructure.subsection1),e},getOptions:function(){var e={};if(this.dataStructure.syndicate&&"fia"===this.dataStructure.syndicate)e={url_append:"comscorekw=fbia"};else if(this.useBeacon&&this.dataStructure.contentarea&&"homepage"!==this.dataStructure.contentarea){var t=this.dataStructure.contentarea,i=this.dataStructure.subsection1,n=t;"news"===t&&i&&(n=i),e={url_append:"comscorekw=".concat(n)}}if(document.getElementById("comscore-comment-div")&&document.getElementById("comscore-comment-div").remove(),e.url_append){var a=document.createElement("div"),r=document.createComment("comScore Identifier: ".concat(e.url_append));a.id="comscore-comment-div",a.appendChild(r),document.body.appendChild(a)}return e},generatePayload:function(e,t){return Object.assign({},e,t)},pvCandidate:function(){var e=this.getOptions();window.COMSCORE&&window.COMSCORE.beacon(this.generatePayload(this.payload,{options:e}));var t=void 0!==e.url_append?e.url_append+"&":"";CBC.APP.SC.UTIL.makeGETRequest("//www.cbc.ca/g/stats/comscore.json?".concat(t,"cache=").concat((new Date).getTime()),{success:function(e){JSON.parse(e.responseText).comscore||console.log("COMSCORE-bottom: json response error")},failure:function(){console.log("COMSCORE-bottom: json request error")}},{success:{success:!0},failure:{success:!1}})}},window.CBC||(window.CBC={}),CBC.APP||(CBC.APP={}),CBC.APP.CXENSE||(CBC.APP.CXENSE={addMetaTags:function(){for(var e=document.querySelectorAll("meta[name^=cXenseParse]"),t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t]);var i,n=CBC.APP.SC.DTM.formatted.cxense,a=document.querySelector("head");if(n&&n.contenttype){var r="article";"index"===n.contenttype&&(r="frontpage",n.contentarea&&/(video|kids|tv)/i.test(n.contentarea)&&(r="article","video"!==n.contentarea||n.contentid||(r="frontpage"),n.subsection1&&/(index|search)/i.test(n.subsection1)&&(r="frontpage")));var o=this.createMetaTag("cXenseParse:","pageclass",r);a.appendChild(o)}if(n&&n.contenttype&&"index"===n.contenttype&&n.contentarea&&/(video|kids|tv|life)/i.test(n.contentarea))if(n.pillar&&"legacyee"===n.pillar){i=n.subsection2?n.subsection2.replace(/[^a-zA-Z0-9"]/g," "):"",i+=n.subsection3&&"home"!==n.subsection3?" "+n.subsection3.replace(/[^a-zA-Z0-9"]/g," "):"";var s=this.createMetaTag("cXenseParse:","cbc-keymatch",i);a.appendChild(s)}else if("video"===n.contentarea&&n.contentid){i=n.subsection3?n.subsection3.replace(/[^a-zA-Z0-9"]/g," "):"";var c=this.createMetaTag("cXenseParse:","cbc-keymatch",i);a.appendChild(c)}for(var u in n)if({}.hasOwnProperty.call(n,u)){var l=this.createMetaTag("cXenseParse:cbc-",u,n[u]);if(a.appendChild(l),"publishedTime"===u&&!isNaN(parseInt(n[u]))){var d=this.createMetaTag("article:","published_time",new Date(parseInt(n[u])).toISOString(),"property");a.appendChild(d)}if("updatedTime"===u&&!isNaN(parseInt(n[u]))){var p=this.createMetaTag("article:","modified_time",new Date(parseInt(n[u])).toISOString(),"property");a.appendChild(p)}}},createMetaTag:function(e,t,i,n){var a=3<arguments.length&&void 0!==n?n:"name",r=document.createElement("meta");return r.setAttribute(a,e+t),r.setAttribute("content",i),r},pageView:function(){CBC.APP.CXENSE.addMetaTags(),window.cX.callQueue.push(["sendPageViewEvent"])}}),function(){var e,t,i,n;window.cX=window.cX||{},window.cX.callQueue=window.cX.callQueue||[],window.cX.callQueue.push(["setSiteId","9222369215399074873"]),e=document,t="script",(i=e.createElement(t)).type="text/java"+t,i.async="async",i.src="https://scdn.cxense.com/cx.js",(n=e.getElementsByTagName(t)[0]).parentNode.insertBefore(i,n)}(),function(){function i(i,n){if("READ"!==i.toUpperCase()||!n||!n.content||n.content.id&&"comments"!==n.content.type){var c=CBC.APP.SC.UTIL.getCookie("cbc_plus"),u=CBC.APP.SC.UTIL.getCookie("cbc_visitor");try{CBC.APP.SC.masterSwitch.switches.googlecloud&&(/ess/.test(CBC.APP.SC.masterSwitch.googlecloud.url)?l(CBC.APP.SC.masterSwitch.googlecloud.url,i,n,0):a(CBC.APP.SC.masterSwitch.googlecloud.url,i,n))}catch(e){var t="//www.cbc.ca/network/includes/stats/master-switch.json";CBC.APP.SC.UTIL.makeGETRequest(t,{success:function(e){var t=JSON.parse(e.responseText);t.switches.googlecloud&&(/ess/.test(t.googlecloud.url)?l(t.googlecloud.url,i,n,0):a(t.googlecloud.url,i,n))},failure:function(e,t){console.log("ERROR: Unable to talk to config URL: "+t.failure.uri)}},{success:{uri:t},failure:{uri:t}})}}function l(i,n,a,e){if(!a.content.id)return!1;var r=e,o=(new Map).set(500,!0).set(502,!0).set(503,!0).set(504,!0),t=(new Map).set("READ",["Read","E0406C","PolopolyArticle",a.content.id]).set("WATCHED",["Watched","WATCHED_PREDICATE_ID","MPXVideo","Replace_With_MPX_Video_ID"]).set("LISTENED",["Listened","LISTENED_PREDICATE_ID","AudioDB","Replace_With_AudioDB_ID"]),s={subject:{}};return s.subject.type="User",s.subject.id=c||u,!!s.subject.id&&(s.predicate={},s.predicate.type=t.get(n.toUpperCase())[0],s.predicate.id=t.get(n.toUpperCase())[1],s.predicate.end=(new Date).toISOString(),s.object={},s.object.type=t.get(n.toUpperCase())[2],s.object.id=t.get(n.toUpperCase())[3],!(!JSON.stringify(s)||"{}"===JSON.stringify(s))&&void CBC.APP.SC.UTIL.makePOSTRequest(i,JSON.stringify(s),{success:function(){},failure:function(e,t){o.has(e.status)&&r<3?(++r,setTimeout(function(){l(i,n,a,r)},2e3)):o.has(e.status)&&3<=r?(console.log("ERROR: ESS Server too busy or overloaded."),console.log("    URL: "+t.failure.uri),console.log("    Payload: "+JSON.stringify(t.failure.payload))):400===e.status?(console.log("ERROR: Missing or malformed ESS Payload."),console.log("    Payload: "+JSON.stringify(t.failure.payload))):(console.log("ERROR: Unable to talk to ESS Enpoint."),console.log("    URL: "+t.failure.uri))}},{success:{uri:i},failure:{payload:s,uri:i}},null,{"Content-Type":"application/json"}))}function a(e,t,i){(i=i||{}).user||(i.user={}),i.session||(i.session={}),i.verb=t,u&&(i.user.cbc_visitor=u),c&&(i.user.cbc_plus=c),i.session.startTime=CBC.APP.SC.EventTracker.sessionStartTime,CBC.APP.SC.UTIL.makePOSTRequest(e,JSON.stringify(i),{success:function(){},failure:function(e){console.log("ERROR: Unable to talk to RecSys URL: "+e.failure.uri)}},{success:{uri:e},failure:{uri:e}},null,{"Content-Type":"application/json"})}}function n(e,t){"STREAMED"===e&&t.content?"video"===t.content.area||t.content.media&&"video"===t.content.media.audiovideo?window.CBC.APP.AB.Testing.sendGoal("api-streamed-video",1):("audio"===t.content.area||t.content.media&&"audio"===t.content.media.audiovideo)&&window.CBC.APP.AB.Testing.sendGoal("api-streamed-audio",1):"READ"===e&&t.content&&"comments"===t.content.type&&window.CBC.APP.AB.Testing.sendGoal("api-read-comment",1)}function a(e){e.user&&e.user.id&&e.user.id.gem&&(CBC.APP.SC.DTM.DATA.user||(CBC.APP.SC.DTM.DATA.user={},CBC.APP.SC.DTM.DATA.user.id={}),CBC.APP.SC.DTM.DATA.user.id.gem=e.user.id.gem,CBC.APP.SC.UTIL.sendGemID(CBC.APP.SC.UTIL.createUIEPayload()))}CBC.APP.PubSub.subscribe("LOADED",function(e,t){}),CBC.APP.PubSub.subscribe("LOADED MORE",function(e,t){}),CBC.APP.PubSub.subscribe("SIGNED IN",function(e,t){CBC.APP.SC.DTM.DATA.authenticated=CBC.APP.SC.PageTracker.isLoggedIn(),CBC.APP.SC.UTIL.setFormattedLayer(),a(t)}),CBC.APP.PubSub.subscribe("SIGNED OUT",function(e,t){CBC.APP.SC.DTM.DATA.authenticated=CBC.APP.SC.PageTracker.isLoggedIn(),CBC.APP.SC.UTIL.setFormattedLayer(),CBC.APP.SC.UTIL.removeCBCPlusID(),a(t)}),CBC.APP.PubSub.subscribe("COMMENTED",function(e,t){}),CBC.APP.PubSub.subscribe("READ",function(e,t){n("READ",t),i("READ",t)}),CBC.APP.PubSub.subscribe("STREAMED",function(e,t){n("STREAMED",t),a(t)}),CBC.APP.PubSub.subscribe("SUBSCRIBED",function(e,t){a(t)}),CBC.APP.PubSub.subscribe("UNSUBSCRIBED",function(e,t){a(t)})}(),window.CBC||(window.CBC={}),CBC.APP||(CBC.APP={}),CBC.APP.FBPIXEL=CBC.APP.FBPIXEL||{},CBC.APP.FBPIXEL.VALIDATE={restrictKidsURL:function(){return/(cbc)?kids(cbc2|news|fantasyhockey)?/.test(CBC.APP.SC.UTIL.returnURL())},validateFacebookLibrary:function(){CBC.APP.SC.UTIL.masterSwitchMetaPromise().then(function(e){e.switches.facebook&&!CBC.APP.FBPIXEL.VALIDATE.restrictKidsURL()?CBC.APP.FBPIXEL.LIBRARY.facebookLibrary():CBC.APP.SC.LinkTracker.debug("Facebook has not been initialized on this page.")})}},CBC.APP.FBPIXEL.VALIDATE.validateFacebookLibrary(),window.CBC||(window.CBC={}),CBC.APP||(CBC.APP={}),CBC.APP.FBPIXEL||(CBC.APP.FBPIXEL={}),CBC.APP.FBPIXEL.DISPATCH={pageView:function(){window.fbq&&CBC.APP.FBPIXEL.VALIDATE&&!CBC.APP.FBPIXEL.VALIDATE.restrictKidsURL()&&fbq("track","PageView")}},function(){var e={FATAL:"fatal",ERROR:"error",WARN:"warn",INFO:"info",DEBUG:"debug",TRACE:"trace"},r={OFF:"OFF",FATAL:e.FATAL,ERROR:e.ERROR,WARN:e.WARN,INFO:e.INFO,DEBUG:e.DEBUG,TRACE:e.TRACE,ALL:"ALL"},o=[e.FATAL,e.ERROR,e.WARN,e.INFO,e.DEBUG,e.TRACE],i=function(){function a(e){_classCallCheck(this,a);var t=0;t=(e=e||r.OFF)===r.OFF?0:e===r.ALL?o.length:o.indexOf(e)+1;for(var i=0;i<o.length;i++){var n=o[i];this[n]=i<t?this._log.bind(this,n):function(){}}}return _createClass(a,[{key:"_log",value:function(e,t){var i=this;e=e||"";var n=t;if(2<arguments.length){var a=Array.prototype.slice.call(arguments,2);n=t.replace(/{(\d+)}/g,function(e,t){return t in a?i._stringify(a[t]):e})}else n=this._stringify(t);console.log("DMP: ".concat(e.toUpperCase(),": ").concat(n))}},{key:"_stringify",value:function(e){var t=this;return e&&e.toString===Object.prototype.toString?JSON.stringify(e):Array.isArray(e)?"[".concat(e.map(function(e){return t._stringify(e)}).join(","),"]"):""+e}}]),a}();i.LEVEL=r,i.CHANNEL=e;function u(e,t){_classCallCheck(this,u),this.type=e,this.value=t}var s={watch:!0,live:!0,betalisten:!0,gem:!0},c={artists:!0},l=function(){function n(e){var i=this;_classCallCheck(this,n),this.hostname="",this.pathname="",this.path=[],this.query="",this.params={},this.fragment="",this.productHostName=null,e=(e=e||"").toLowerCase();var t=document.createElement("a");t.href=e,t.hostname&&(this.hostname=t.hostname.replace(/^www\./,"")),t.pathname&&(this.pathname=t.pathname,this.path=t.pathname.split("/").filter(Boolean)),t.hash&&(this.fragment=t.hash.replace(/^#/,"")),t.search&&(this.query=t.search.substr(1),this.query.split("&").forEach(function(e){var t=e.split("=");i.params[t[0]]=decodeURIComponent(t[1])}))}return _createClass(n,[{key:"getProductHostName",value:function(){if(null!=this.productHostName)return this.productHostName;this.productHostName=this.hostname||"";var e=this.hostname.split("."),t=null,i=null,n=null;if(2<=e.length&&(t=e[e.length-1],i=e[e.length-2],3<=e.length&&(n=e[0])),"ca"!==t)return this.productHostName;var a=null;if("cbc"===i)a=s;else{if("cbcmusic"!==i)return this.productHostName;a=c}return this.productHostName=a[n]?"".concat(n,".").concat(i,".").concat(t):"".concat(i,".").concat(t),this.productHostName}}],[{key:"getLocationUrl",value:function(){return window.location.href}}]),n}();u.TYPES={INTEREST:"int",GENERIC_PROPERTY:"genp",CUSTOM_SEGMENT:"seg",ACTION:"act",MEDIA:"med",GENERIC_GEO:"geo",GENERIC_DEMO:"dem",SITEMAPS:"sm",PAGE_VIEW:"pv"};var d=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"spa",get:function(){return!0===(window.CBC.APP.SC.DTM.DATA&&window.CBC.APP.SC.DTM.DATA.spa)}},{key:"keywords",get:function(){var e=window.CBC.APP.SC.DTM.DATA&&window.CBC.APP.SC.DTM.DATA.keywords;return void 0===e?null:e}},{key:"contentType",get:function(){return window.CBC.APP.SC.DTM.DATA&&window.CBC.APP.SC.DTM.DATA.contenttype||""}},{key:"url",get:function(){var e=window.CBC.APP.SC.DTM.formatted&&window.CBC.APP.SC.DTM.formatted.lotame&&window.CBC.APP.SC.DTM.formatted.lotame.url;return(e=e||l.getLocationUrl())||""}},{key:"userTier",get:function(){return window.CBC.APP.SC.DTM.DATA&&window.CBC.APP.SC.DTM.DATA.userTier||""}}]),e}(),n=function(){function n(e,t){var i=e.logger;_classCallCheck(this,n),this.logger=i,this._hostname=t||"",this._tagFiredCount=0,this._pageViewCount=0,this._queuedBehaviours=[]}return _createClass(n,[{key:"getClientId",value:function(){var e=10205;return"cbcmusic.ca"===this._hostname.replace(/.+?(?=cbc)/,"")&&(e=10907),e}},{key:"isInitialized",value:function(){return!!this.LOTCC}},{key:"init",value:function(){this.isInitialized()||this.loadScript()}},{key:"loadScript",value:function(){var e=this,t=this.getClientId(),i=this.createScriptElement();i.src="//tags.crwdcntrl.net/c/".concat(t,"/cc.js?ns=_cc").concat(t),i.async=!0;function n(){e.pageChange(),e.flushBehaviours()}i.readyState?i.onreadystatechange=function(){"loaded"!==i.readyState&&"complete"!==i.readyState||(i.onreadystatechange=null,n())}:i.onload=n,this.injectScriptElement(i)}},{key:"injectScriptElement",value:function(e){if(e){var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}}},{key:"createScriptElement",value:function(){return document.createElement("script")}},{key:"pageChange",value:function(){if(this.isInitialized()){this.logger.debug("Firing bcp() and removing iframes. tagFiredCount - {0}",this._tagFiredCount);for(var e=document.getElementsByTagName("iframe"),t=0;t<e.length;t++)/^LOTCCFrame/.test(e[t].id)&&(this.logger.debug("Removing iframe with id: {0}",e[t].id),e[t].remove(),t--);this.LOTCC.bcp(),this._tagFiredCount+=1}}},{key:"sendBehaviours",value:function(e,t){t&&(0<this.pageViewCount&&e.push(new u(u.TYPES.PAGE_VIEW,"y")),this._pageViewCount++),this.isInitialized()?this._sendBehaviours(e):this._queuedBehaviours.push({behaviours:e})}},{key:"_sendBehaviours",value:function(e){var t=e.reduce(function(e,t){return e.push(t.type),e.push(t.value),e},[]);0!==t.length&&this.LOTCC.bcpw.apply(void 0,t)}},{key:"flushBehaviours",value:function(){var i=this;this.isInitialized()&&this._queuedBehaviours.length&&(this._queuedBehaviours.forEach(function(t){try{i._sendBehaviours(t.behaviours)}catch(e){i.logger.error("Failed to send queued behaviours {0}",t.behaviours)}}),this._queuedBehaviours=[])}},{key:"pageViewCount",get:function(){return this._pageViewCount}},{key:"tagFiredCount",get:function(){return this._tagFiredCount}},{key:"LOTCC",get:function(){return window.LOTCC}},{key:"behaviours",get:function(){return this._queuedBehaviours.slice()}}]),n}(),a=function(){function i(e){var t=e.logger;_classCallCheck(this,i),this.logger=t}return _createClass(i,[{key:"listSubPaths",value:function(e,t){var i=1<arguments.length&&void 0!==t?t:" : ",n=[],a=e.path.slice(0);if(-1!==e.fragment.indexOf("/")){var r=e.fragment.split("/").filter(Boolean);0<r.length&&(a=[].concat(_toConsumableArray(a),["#"],_toConsumableArray(r)))}var o=[];return a.forEach(function(e){o.push(e),"#"!==e&&n.push(o.join(i))}),n}},{key:"buildPageChangeBehaviours",value:function(e,t,i){var n=this.buildSiteTrafficBehaviours(e),a=this.buildSiteSectionBehaviours(e,t),r=[];"story"===t&&(r=this.buildKeywordBehaviours(i));var o=this.buildTimestampBehaviours("Page View"),s=new l(l.getLocationUrl()),c=this.buildCampaignReferralBehaviours(s),u=[];return t&&"index"===t&&(u=this.buildLandingPageBehaviours(e)),[].concat(n,a,r,o,c,u)}},{key:"buildSiteTrafficBehaviours",value:function(e){var t=e?e.getProductHostName():"";return[new u(u.TYPES.INTEREST,"".concat(t," : Total Site Traffic"))]}},{key:"buildSiteSectionBehaviours",value:function(e,t){var i=[],n=e?e.getProductHostName():"",a="".concat(n," : Site Section");if(0===e.path.length)i.push(new u(u.TYPES.INTEREST,"".concat(a," : homepage")));else for(var r=this.listSubPaths(e),o=0;o<r.length;o++){var s=u.TYPES.INTEREST;o===r.length-1&&t&&"index"!==t&&(s=u.TYPES.MEDIA),i.push(new u(s,"".concat(a," : ").concat(r[o])))}return i}},{key:"buildLandingPageBehaviours",value:function(e){var t=[],i=e?e.getProductHostName():"",n="".concat(i," : Landing Page");if(0<e.path.length){var a=this.listSubPaths(e);t.push(new u(u.TYPES.MEDIA,"".concat(n," : ").concat(a[a.length-1])))}return t}},{key:"buildSubjectKeywordBehaviours",value:function(e){var t=[],i=u.TYPES.GENERIC_PROPERTY;if("entities"in e&&e.entities instanceof Array)for(var n=0;n<e.entities.length;n++){var a="Keyword : Subject";if(e.entities[n].name)for(var r=e.entities[n].name.split("/").filter(Boolean),o=0;o<r.length;o++)a+=" : "+r[o],-1===t.indexOf(a)&&t.push(a)}return t.map(function(e){return new u(i,e)})}},{key:"buildKeywordBehaviours",value:function(e){var t=[],i=u.TYPES.GENERIC_PROPERTY;if(e instanceof Array)for(var n=0;n<e.length;n++){var a=e[n].name,r="Keyword : "+a;if("Subject"===a){var o=this.buildSubjectKeywordBehaviours(e[n]);t=t.concat(o)}else if("entities"in e[n]&&e[n].entities instanceof Array)for(var s=0;s<e[n].entities.length;s++){var c=r+" : "+e[n].entities[s].name;t.push(new u(i,c))}}return t}},{key:"buildShareBehaviours",value:function(e,t){t=t||"";var i=e?e.getProductHostName():"";t=t.toLowerCase().replace(/\b[a-z]/g,function(e){return e.toUpperCase()});var n="".concat(i," : Share Content"),a="".concat(i," : Share Content on ").concat(t),r=this.listSubPaths(e);r.push("");var o=[];return r.forEach(function(e){e=e&&" : ".concat(e),o.push(new u(u.TYPES.ACTION,"".concat(n).concat(e)),new u(u.TYPES.ACTION,"".concat(a).concat(e)))}),o}},{key:"buildSurveySubmissionBehaviours",value:function(i,e){if(!e||!(e instanceof Array)||e.length<=0)return this.logger.error("Answers does not exist or empty"),[];var n=[];return e.forEach(function(e){var t="Survey Data : ".concat(i," : ").concat(e.tag," : ");e.choices instanceof Array!=!1&&e.choices.forEach(function(e){n.push(new u(u.TYPES.ACTION,"".concat(t).concat(e)))})}),n}},{key:"buildSurveyLoadedBehaviour",value:function(e){return e?[new u(u.TYPES.ACTION,"Survey Loaded : ".concat(e))]:[]}},{key:"buildAudienceSegmentRatingBehaviours",value:function(e,t,i){if("number"!=typeof i)return this.logger.error("Segment rating was not provided"),[];var n=0<i?"like":"dislike",a="Audience Segment Feedback : ".concat(e," : ").concat(n),r=[new u(u.TYPES.INTEREST,a)];if(t){var o="Family Feedback : ".concat(t," : ").concat(n);r.push(new u(u.TYPES.INTEREST,o))}return r}},{key:"buildTimestampBehaviours",value:function(e){var t=new Date,i="Timestamp",n={0:"Sunday",1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday"}[t.getDay()],a=t.getHours(),r=a<10?"0".concat(a,":00"):"".concat(a,":00");return[new u(u.TYPES.ACTION,"".concat(i," : ").concat(r," : ").concat(e)),new u(u.TYPES.ACTION,"".concat(i," : ").concat(n," : ").concat(e)),new u(u.TYPES.ACTION,"".concat(i," : ").concat(r," : ").concat(n," : ").concat(e))]}},{key:"buildCampaignReferralBehaviours",value:function(e){return e.params&&void 0!==e.params.cmp&&null!==e.params.cmp?[new u(u.TYPES.INTEREST,"Referral : Campaign : ".concat(e.params.cmp))]:[]}},{key:"buildRegionChangeBehaviours",value:function(e){return e?[new u(u.TYPES.GENERIC_GEO,"Local Region : news : ".concat(e))]:[]}},{key:"buildAdTargetingOptOutBehaviour",value:function(e){return e?[new u(u.TYPES.ACTION,"Global Ad Targeting Opt Out : ".concat(e))]:[]}},{key:"buildStartWebSessionBehaviour",value:function(){return[new u(u.TYPES.ACTION,"Start Web Session")]}},{key:"buildReadBehaviours",value:function(e,t){var i=[],n=e?e.getProductHostName():"";if("comments"===t)i.push(new u(u.TYPES.ACTION,"".concat(n," : Read comment")));else for(var a="".concat(n," : Read"),r=this.listSubPaths(e),o=0;o<r.length;o++){var s=u.TYPES.INTEREST;o===r.length-1&&t&&"index"!==t&&(s=u.TYPES.MEDIA),i.push(new u(s,"".concat(a," : ").concat(r[o])))}return i}},{key:"buildStreamedShortFormVideo",value:function(e){if(!e.content||!e.content.media)return[];var t=["cbc.ca","streamed"].concat(_toConsumableArray([e.content.media.genre,e.content.media.region,e.content.media.show,e.content.title].filter(function(e){return!!e}))).join(" : ");return[new u(u.TYPES.MEDIA,t)]}}]),i}(),p=function(){function i(e){var t=e.logger;_classCallCheck(this,i),this.logger=t}return _createClass(i,[{key:"isValidString",value:function(e){return"string"==typeof e&&0<e.trim().length&&"nan"!==e.toLowerCase()&&"null"!==e.toLowerCase()&&"undefined"!==e.toLowerCase()}},{key:"buildStreamedBehaviours",value:function(e,t){var i=[],n=e?e.getProductHostName():"",a="".concat(n," : streamed");if(t){if(i.push(new u(u.TYPES.ACTION,a)),t.content&&t.content.media)if(t.content.media.liveondemand&&"live"===t.content.media.liveondemand||"linear"===t.content.media.liveondemand)t.content.media.streamtitle&&i.push(new u(u.TYPES.INTEREST,"".concat(a," : ").concat(t.content.media.liveondemand," : ").concat(t.content.media.streamtitle)));else if(this.isValidString(t.content.media.show)){var r="".concat(a," : ").concat(t.content.media.show);if(i.push(new u(u.TYPES.INTEREST,r)),this.isValidString(t.content.media.seasonnumber)){var o="".concat(r," : season ").concat(t.content.media.seasonnumber);this.isValidString(t.content.media.episodenumber)?o="".concat(o," : episode ").concat(t.content.media.episodenumber):this.isValidString(t.content.media.streamtitle)&&(o="".concat(o," : ").concat(t.content.media.streamtitle)),i.push(new u(u.TYPES.MEDIA,o))}else this.isValidString(t.content.media.episodenumber)?i.push(new u(u.TYPES.MEDIA,"".concat(r," : episode ").concat(t.content.media.episodenumber))):this.isValidString(t.content.media.streamtitle)&&i.push(new u(u.TYPES.MEDIA,"".concat(r," : ").concat(t.content.media.streamtitle)))}t.feature&&this.isValidString(t.feature.name)&&i.push(new u(u.TYPES.ACTION,"".concat(a," : ").concat(t.feature.name)))}return i}},{key:"buildSubscribedBehaviours",value:function(e){var t=[],i=e?e.getProductHostName():"",n="".concat(i," : subscribed");return t.push(new u(u.TYPES.ACTION,n)),t}},{key:"buildUnsubscribedBehaviours",value:function(e){var t=[],i=e?e.getProductHostName():"",n="".concat(i," : unsubscribed");return t.push(new u(u.TYPES.ACTION,n)),t}},{key:"buildLoadedBehaviours",value:function(e,t){var i=[],n=e?e.getProductHostName():"",a="".concat(n," : loaded");return t&&i.push(new u(u.TYPES.ACTION,"".concat(a," : user tier : ").concat(t))),i}}]),i}(),h=function(){function t(e){_classCallCheck(this,t),this.dmp=e,this.logger=e.logger,this.pubSub=e.pubSub,this.lotame=e.lotame,this.behaviourBuilder=e.behaviourBuilder,this.behaviourBuilderOtt=e.behaviourBuilderOtt}return _createClass(t,[{key:"init",value:function(){this._pageChangeSub=this._onPageChange.bind(this),this.pubSub.subscribe("pageChange",this._pageChangeSub),this._sendSurveyDataSub=this._onSendSurveyData.bind(this),this.pubSub.subscribe("surveySubmission",this._sendSurveyDataSub),this._sendSurveyNameSub=this._onSendSurveyName.bind(this),this.pubSub.subscribe("surveyLoad",this._sendSurveyNameSub),this._storySharedSub=this._onStoryShared.bind(this),this.pubSub.subscribe("SHARED",this._storySharedSub),this._rateSegmentSub=this._onRateSegment.bind(this),this.pubSub.subscribe("rateAudienceSegment",this._rateSegmentSub),this._regionChangeSub=this._onRegionChange.bind(this),this.pubSub.subscribe("regionChange",this._regionChangeSub),this._adTargetingOptOutSub=this._onAdTargetingOptOut.bind(this),this.pubSub.subscribe("adTargetingOptOut",this._adTargetingOptOutSub),this._startWebSessionSub=this._onStartWebSession.bind(this),this.pubSub.subscribe("START WEB SESSION",this._startWebSessionSub),this._videoStreamedSub=this._onVideoStreamed.bind(this),this.pubSub.subscribe("STREAMED",this._videoStreamedSub),this._subscribedEventSub=this._onSubscribedEvent.bind(this),this.pubSub.subscribe("SUBSCRIBED",this._subscribedEventSub),this._unsubscribedEventSub=this._onUnsubscribedEvent.bind(this),this.pubSub.subscribe("UNSUBSCRIBED",this._unsubscribedEventSub),this._loadedEventSub=this._onLoadedEvent.bind(this),this.pubSub.subscribe("LOADED",this._loadedEventSub),this._readEventSub=this._onReadEvent.bind(this),this.pubSub.subscribe("READ",this._readEventSub)}},{key:"_onPageChange",value:function(){this.logger.debug("pageChange subscriber");var e=d.url;if(e){var t=this.behaviourBuilder.buildPageChangeBehaviours(new l(e),d.contentType,d.keywords);this.lotame.sendBehaviours(t,!0)}}},{key:"_onStoryShared",value:function(e,t){this.logger.debug("Story shared - {0}",t);var i=new l(d.url),n=this.behaviourBuilder.buildShareBehaviours(i,t.network);this.lotame.sendBehaviours(n)}},{key:"_onSendSurveyData",value:function(e,t){this.logger.debug("Send survey data sub - {0}",t);var i=this.behaviourBuilder.buildSurveySubmissionBehaviours(t.name,t.answers);this.lotame.sendBehaviours(i)}},{key:"_onSendSurveyName",value:function(e,t){this.logger.debug("Send survey name sub - {0}",t);var i=this.behaviourBuilder.buildSurveyLoadedBehaviour(t);this.lotame.sendBehaviours(i)}},{key:"_onRateSegment",value:function(e,t){var i=t.segmentId,n=t.family,a=t.rating,r=this.behaviourBuilder.buildAudienceSegmentRatingBehaviours(i,n,a);this.lotame.sendBehaviours(r)}},{key:"_onRegionChange",value:function(e,t){var i=this.behaviourBuilder.buildRegionChangeBehaviours(t.title);this.lotame.sendBehaviours(i)}},{key:"_onAdTargetingOptOut",value:function(e,t){var i=this.behaviourBuilder.buildAdTargetingOptOutBehaviour(t);this.lotame.sendBehaviours(i)}},{key:"_onStartWebSession",value:function(){var e=this.behaviourBuilder.buildStartWebSessionBehaviour();this.lotame.sendBehaviours(e)}},{key:"_onReadEvent",value:function(e,t){var i=t.content&&t.content.type;i=i||d.contentType;var n=new l(d.url),a=this.behaviourBuilder.buildReadBehaviours(n,i);this.lotame.sendBehaviours(a)}},{key:"_onVideoStreamed",value:function(e,t){var i=new l(d.url),n=this.behaviourBuilderOtt.buildStreamedBehaviours(i,t);i.pathname.match(/^\/player\/play\/\d+/)&&(n=n.concat(this.behaviourBuilder.buildStreamedShortFormVideo(t))),this.lotame.sendBehaviours(n)}},{key:"_onSubscribedEvent",value:function(){var e=new l(d.url),t=this.behaviourBuilderOtt.buildSubscribedBehaviours(e);this.lotame.sendBehaviours(t)}},{key:"_onUnsubscribedEvent",value:function(){var e=new l(d.url),t=this.behaviourBuilderOtt.buildUnsubscribedBehaviours(e);this.lotame.sendBehaviours(t)}},{key:"_onLoadedEvent",value:function(){var e=new l(d.url),t=this.behaviourBuilderOtt.buildLoadedBehaviours(e,d.userTier);this.lotame.sendBehaviours(t)}}]),t}(),C=function(){function i(e){var t=e.logger;_classCallCheck(this,i),this.logger=t}return _createClass(i,[{key:"isLoggedIn",value:function(){try{var e=this.viafouraApi.users.current().user_privilege;return e&&"guest"!==e}catch(e){return!1}}},{key:"version",get:function(){return window.vf?2:window.viafoura?1:0}},{key:"viafouraApi",get:function(){return window.viafoura}},{key:"userId",get:function(){return this.isLoggedIn()?this.viafouraApi.users.current().id:(this.logger.debug("user unauthenticated!"),null)}},{key:"userPrivilege",get:function(){return this.isLoggedIn()&&this.viafouraApi.users.current().user_privilege?this.viafouraApi.users.current().user_privilege:(this.logger.debug("user has no privilege!"),null)}},{key:"userDateCreated",get:function(){var e=this.isLoggedIn()?this.viafouraApi.users.current().date_created:0;return 1<this.version&&(e/=1e3),e}},{key:"commentsMade",get:function(){return this.isLoggedIn()?this.viafouraApi.users.current().comments_made:0}},{key:"activityRange",get:function(){var e=(Date.now()/1e3-this.userDateCreated+1)/86400,t=this.commentsMade/e;return t<=0?"inactive":t<=1?"less than 1 comment per day":t<=5?"1-5 comments per day":t<=16?"5-16 comments per day":"more than 16 comments per day"}}]),i}(),g=function(){function r(e){var t=e.pubSub,i=e.logger,n=e.lotame,a=e.util;_classCallCheck(this,r),this.logger=i,this.lotame=n,this.pubSub=t,this.util=a}return _createClass(r,[{key:"init",value:function(){this._pageChangeSub=this.update.bind(this),this.pubSub.subscribe("pageChange",this._pageChangeSub)}},{key:"update",value:function(){-1==="//www.cbc.ca/cookie-jar/api/geoinfo/list".indexOf("www.cbc.ca")&&(900<=this.getSecondsDiff()?(this.updateSessionTime(),this.callGeoJson()):this.logger.debug("Skipping EdgescapeSession update"))}},{key:"callGeoJson",value:function(){var t=this,e="//www.cbc.ca/cookie-jar/api/geoinfo/list";this.util.makeGETRequest(e,{success:function(e){t.logger.debug("xhr.responseText: {0}",e.responseText),t.sendData(e.responseText)},failure:function(){t.logger.error("Unable to talk to config URL: {0}",e)}})}},{key:"sendData",value:function(e){this.logger.trace("geo responseText: {0}",e);var t=JSON.parse(e),i=this.getGeoDataArr(t);this.lotame.sendBehaviours(i)}},{key:"getHumanReadableName",value:function(e){return e.match(/([A-Z])?[a-z]+/g).join(" ").toLowerCase()}},{key:"getGeoDataArr",value:function(e){var t=[];for(var i in e)if(e.hasOwnProperty(i)){var n=this.getHumanReadableName(i)+" : "+e[i];t.push(new u(u.TYPES.GENERIC_GEO,n))}return this.logger.trace("geo dataArr: {0}",t),t}},{key:"updateSessionTime",value:function(){var e={value:!0,timestamp:(new Date).getTime()};try{window.sessionStorage.setItem("edgescape",JSON.stringify(e))}catch(e){void 0===window.sessionStorage?this.logger.debug("This browser doesn't support sessionStorage. The error message is {0}",e):this.logger.debug("Unable to store edgescape in sessionStorage: {0}",e)}}},{key:"getSessionTime",value:function(){try{return JSON.parse(window.sessionStorage.getItem("edgescape")).timestamp}catch(e){return void 0===window.sessionStorage?this.logger.debug("This browser doesn't support sessionStorage. The error message is {0}",e):this.logger.debug("No value for key 'edgescape' in sessionStorage or 'timestamp' in edgescape."),0}}},{key:"getSecondsDiff",value:function(){var e=(new Date).getTime(),t=Math.floor((e-this.getSessionTime())/1e3);return this.logger.trace("Time difference: {0}",t),t}}]),r}(),f=function(){function a(e){var t=e.viafoura,i=e.pubSub,n=e.logger;_classCallCheck(this,a),this.vf=t,this.pubSub=i,this.logger=n,this.vfIdToLotame="vfidtolotame",this.lotamePixel=null,this.lotameScr="//bcp.crwdcntrl.net/map/c=10743/tp=VIAF/tpid="}return _createClass(a,[{key:"init",value:function(){var i=this;void 0===this.vf.viafouraApi?this.pubSub.subscribe("viafouraAvailable",function(e,t){i.addVfEvents()}):this.addVfEvents()}},{key:"run",value:function(){this.logger.debug("Running Viafoura/Lotame sync pixel code."),this.lotamePixel=this.getPixel(this.vfIdToLotame),this.vf.isLoggedIn()?this.lotamePixel?this.updatePixel():this.addPixel():this.lotamePixel&&this.deletePixel()}},{key:"addVfEvents",value:function(){var e=this;this.logger.debug("Add Viafoura events");try{this.vf.viafouraApi.subscribe("onLoginSuccess",function(){e.run()})}catch(e){this.logger.error("Can't subscribe onLoginSuccess event.")}try{this.vf.viafouraApi.subscribe("onLogoutSuccess",function(){e.run()})}catch(e){this.logger.error("Can't subscribe onLogoutSuccess event.")}}},{key:"getPixel",value:function(e){return document.getElementById(e)}},{key:"addPixel",value:function(){this.logger.debug("Add Viafoura/Lotame sync pixel code.");var e=document.createElement("img");e.src=this.lotameScr+this.vf.userId,e.id=this.vfIdToLotame,e.async=!0,document.body.appendChild(e)}},{key:"updatePixel",value:function(){this.logger.debug("Update Viafoura/Lotame sync pixel code.");var e=this.getPixel(this.vfIdToLotame),t=this.lotameScr+this.vf.userId;e.src=t}},{key:"deletePixel",value:function(){this.logger.debug("Delete Viafoura/Lotame sync pixel code."),this.getPixel(this.vfIdToLotame).remove()}}]),a}(),m=function(){function o(e){var t=e.logger,i=e.viafoura,n=e.lotame,a=e.pubSub,r=e.util;_classCallCheck(this,o),this.logger=t,this.viafoura=i,this.lotame=n,this.pubSub=a,this.util=r}return _createClass(o,[{key:"init",value:function(){this._viafouraAvailableSub=this._onViafouraAvailable.bind(this),void 0===this.viafoura.viafouraApi?this.pubSub.subscribe("viafouraAvailable",this._viafouraAvailableSub):this._viafouraAvailableSub(),this._signInSub=this._onSignIn.bind(this),this.pubSub.subscribe("SIGNED IN",this._signInSub),this._signOutSub=this._onSignOut.bind(this),this.pubSub.subscribe("SIGNED OUT",this._signOutSub)}},{key:"callLoginRadiusApi",value:function(e){var t=this,i="//api.loginradius.com/api/v2/userprofile?access_token="+e;this.util.makeGETRequest(i,{success:function(e){t.logger.debug("User logged in success : {0}",e.responseText),t.sendData(JSON.parse(e.responseText))},failure:function(){t.logger.error("Error : login radius api call to get user profile")}})}},{key:"sendData",value:function(e){var t;if(e){var i=e.Addresses&&e.Addresses[0]&&e.Addresses[0].PostalCode?e.Addresses[0].PostalCode.substring(0,3):"",n=e.Gender?e.Gender:"",a=e.Age?e.Age:"";t=[new u(u.TYPES.GENERIC_DEMO,"User Info : Gender : "+n),new u(u.TYPES.GENERIC_DEMO,"User Info : Age : "+a),new u(u.TYPES.GENERIC_GEO,"User Info : Postal Code : "+i)],this.lotame.sendBehaviours(t)}}},{key:"_onSignIn",value:function(){var e=this.accessTokenForUser;this.loginRadiusV2&&e&&this.callLoginRadiusApi(e)}},{key:"_onSignOut",value:function(){this.lotame.sendBehaviours([new u(u.TYPES.ACTION,"User Info : Sign out")])}},{key:"_onViafouraAvailable",value:function(){var e;e=Boolean(this.viafoura.userId)?[new u(u.TYPES.CUSTOM_SEGMENT,"Authenticated User"),new u(u.TYPES.CUSTOM_SEGMENT,"User privilege: "+this.viafoura.userPrivilege),new u(u.TYPES.CUSTOM_SEGMENT,"User activity range: "+this.viafoura.activityRange)]:[new u(u.TYPES.CUSTOM_SEGMENT,"Unauthenticated User")],this.lotame.sendBehaviours(e)}},{key:"loginRadiusV2",get:function(){return this.viafoura&&this.viafoura.viafouraApi&&this.viafoura.viafouraApi.core&&this.viafoura.viafouraApi.core.loginRadiusSVOD&&this.viafoura.viafouraApi.core.loginRadiusSVOD.LRV2?this.viafoura.viafouraApi.core.loginRadiusSVOD.LRV2:window.LoginRadiusV2?window.LoginRadiusV2:void 0}},{key:"accessTokenForUser",get:function(){return window.localStorage.getItem("LRTokenKey")?window.localStorage.getItem("LRTokenKey").replace(/"/g,""):window.localStorage.getItem("lrtoken")?window.localStorage.getItem("lrtoken").replace(/"/g,""):null}}]),o}(),t=function(){function t(e){_classCallCheck(this,t),this.pubSub=e.pubSub,this.util=e.util,this.logger=new i(e.logLevel),this.lotame=new n(this,e.hostname),this.behaviourBuilder=new a(this),this.behaviourBuilderOtt=new p(this),this.subscribers=new h(this),this.viafoura=new C(this),this.syncPixel=new f(this),this.edgescapeSession=new g(this),this.userInfo=new m(this),this._modules=[this.lotame,this.subscribers,this.syncPixel,this.edgescapeSession,this.userInfo]}return _createClass(t,[{key:"init",value:function(){/\/(kidsnews|kidscbc2|kidsfantasyhockey)(\/|$)/.test(d.url.toLowerCase())?this.logger.debug("Not initializing DMP on CBC Kids or Kids News"):this._modules.forEach(function(e){e.init()})}}]),t}();[window.Element.prototype,window.CharacterData.prototype,window.DocumentType.prototype].forEach(function(e){e.hasOwnProperty("remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode.removeChild(this)}})});var b=new t({logLevel:window.CBC.APP.SC.DEBUG?i.LEVEL.DEBUG:i.LEVEL.ERROR,hostname:window.location.hostname,pubSub:window.CBC.APP.PubSub,util:window.CBC.APP.SC.UTIL});b.logger.debug("DMP initialize starting"),b.init(),function(){window.CBC=window.CBC||{};var e=window.CBC;e.APP=e.APP||{},e.APP.DMP=e.APP.DMP||{},e.APP.DMP.pageChange=function(){b.logger.debug("Forced DMP pageChange"),d.spa&&e.APP.PubSub.publish("pageChange")}}()}(),window.CBC||(window.CBC={}),CBC.APP||(CBC.APP={}),CBC.APP.PubSub=CBC.APP.PubSub||{},CBC.APP.SC||(CBC.APP.SC={}),CBC.APP.SC.Subscribers=CBC.APP.SC.Subscribers||{},CBC.APP.SC.Subscribers.pageview=CBC.APP.SC.Subscribers.pageview||[],CBC.APP.SC.Pillar=CBC.APP.SC.Pillar||{},CBC.APP.SC.PageTracker=function(){var u=CBC.APP.SC.UTIL,l=null,d=[],p=!1;d.pageviewcount=0;var h=!1;function t(){d.channel="misc",d.subsection=[],d.pageurl="",d.searchprefix="",d.separator=":",d.index="index",d.contenttype="page",d.pagetype="",d.pagetitle="",d.scqs={},d.directory="",d.pageName=null,d.hier1=null}return t(),{init:function(){try{CBC.APP.PubSub.turnOn()}catch(e){console.log("There has been an error: "+e)}var e=document.location.href;if(-1<e.indexOf("polopoly")||-1<e.indexOf("/meta/preview")||-1<e.indexOf("/preview/www")||-1<e.indexOf("/preview/web"))return u.console("Preview page. Page Tracking Disabled."),!1;if(-1!==window.Detectizr.ua.indexOf("googlebot"))return!1;if(u.inDebugMode(),!s_cbc_sitecatalyst)return u.console("The Adobe s_code.js is missing on the page"),!1;l=s_cbc_sitecatalyst,h?(this.clearVariables(),window.CBC.APP.SC.Subscribers.pageview.push({cb:function(){window.dispatchEvent(new window.CustomEvent("ConductricsStateChange",{detail:l.pageName}))}})):document.addEventListener("click",CBC.APP.SC.LinkTracker.checkClickEvent);var t=CBC.APP.versions["cbc-stats-top"],i=CBC.APP.versions["cbc-stats-bottom"];if(void 0!==t&&void 0!==i&&this.checkStatsVersions(t,i),l.prop36=(window.self!==window.top).toString(),void 0===CBC.APP.SC.DTM&&(CBC.APP.SC.DTM={}),void 0===CBC.APP.SC.DTM.DATA&&(CBC.APP.SC.DTM.DATA={}),0<Object.keys(CBC.APP.SC.DTM.DATA).length?(CBC.APP.SC.DTM.DATA.authenticated=this.isLoggedIn(),u.setFormattedLayer(),d.scqs=JSON.parse(JSON.stringify(CBC.APP.SC.DTM.formatted.adobe)),d.scqs.storytitle&&(d.scqs.title=d.scqs.storytitle,CBC.APP.SC.storyTitle=d.scqs.storytitle.toLowerCase().replace(/\s/g,"-")),d.pagetitle||(d.pagetitle=d.scqs.pagetitle?d.scqs.pagetitle:""),d.scqs.publishedTime&&(d.scqs.pubdate=d.scqs.publishedTime),l.prop75="new"):(u.console("Data Layer - Data layer not found. Defaulting to URL."),d.scqs=this.urlToObj(document.location.hostname,document.location.pathname),l.prop75="dne"),u.initReferringDepartmentStatus(),this.setTimeVars(),this.setOsAppVars(),this.setSearchPrefix(),this.getAdHierarchy(),this.setFromMetaTags(),CBC.APP.readJS.checkLoad(),this.getUrl(),CBC.APP.SC.DTM.DATA.spa&&0<d.pageviewcount?this.getReferrer(d.scqs.referrer.url):(this.getReferrer(document.referrer),window.conductricsDataLayer=window.conductricsDataLayer||[],CBC.APP.SC.DTM&&window.conductricsDataLayer.push(CBC.APP.SC.DTM)),d.scqs.referrer&&d.scqs.referrer.pillar?l.prop53=d.scqs.referrer.pillar:l.prop53="noReferrer",d.scqs.referrer&&d.scqs.referrer.department){var n=d.scqs.referrer.department;l.prop65=[n.level1,n.level2,n.level3].filter(function(e){return e}).join(":"),l.prop65="noreferrer"===l.prop65?"noReferrer":l.prop65}else l.prop65="noReferrer";CBC.APP.SC.DTM.DATA.wordcount&&(l.prop7=CBC.APP.SC.DTM.DATA.wordcount),this.setWordCount(),this.setStrategicPillar(),this.setCMFAppId(),this.readLinkTrackerCookie(),this.setUserJourney(),this.setUserTier(),this.setDateVars(),this.setSponsor(),this.setContentPartner(),this.detectAdBlocker(),this.checkCbcIdCookieExists(),this.checkHTTPSstatus(document.location.href);var a=this.checkFeatureNameAndPosition();this.checkEmbeddedMedia(),!p&&window.vf&&window.vf.$once&&(window.vf.$once("comments","read",function(e){window.vf.context.get("page").then(function(e){e.num_replies&&CBC.APP.SC.EventTracker.trackEvent("READ",{content:{type:"comments"}})}),p=!1}),p=!0),this.parseStatsVars(),CBC.APP.PubSub.publish("pageChange"),CBC.APP.COMSCORE&&CBC.APP.COMSCORE.Call(),CBC.APP.CXENSE&&CBC.APP.CXENSE.pageView(),window._sf_async_config.cbc&&"gamp"!==d.scqs.syndicate&&window._sf_async_config.cbc.pageChange(),CBC.APP.FBPIXEL&&CBC.APP.FBPIXEL.DISPATCH.pageView();var r={},o="LOADED";a||!l.prop22&&!l.prop24||(r.feature={},l.prop22&&(r.feature.name=l.prop22),l.prop24&&(r.feature.position=l.prop24)),d.scqs.referrer&&d.scqs.referrer.url===d.scqs.url&&(o="LOADED MORE"),"LOADED"===o&&(r.custom={},r.custom.DNT=CBC.APP.SC.UTIL.getDoNotTrackValue(),r.custom.cookiesenabled=window.navigator.cookieEnabled),CBC.APP.SC.EventTracker.trackEvent(o,r),d.pageviewcount+=1,h||(h=!0,window.viafoura&&window.viafoura.users&&window.viafoura.users.current&&window.viafoura.users.current().id?u.setCBCPlusIDPromise().catch(function(e){CBC.APP.SC.UTIL.console(e)}):u.setCBCVisitorIDPromise().catch(function(e){CBC.APP.SC.UTIL.console(e)}));var s=0,c=window.setInterval(function(){if(l.pageName&&l.events||39<s){var e=CBC.APP.SC.Subscribers.pageview,t=e.length,i=0;for(i=0;i<t;++i)"function"==typeof e[t-i-1].cb?e.pop().cb():e.pop();window.clearInterval(c)}else++s},10);return!0},checkFeatureNameAndPosition:function(){return!!(CBC.APP.SC.DTM&&CBC.APP.SC.DTM.formatted&&CBC.APP.SC.DTM.formatted.adobe&&CBC.APP.SC.DTM.formatted.adobe.feature&&(CBC.APP.SC.DTM.formatted.adobe.feature.name||CBC.APP.SC.DTM.formatted.adobe.feature.position))&&(CBC.APP.SC.DTM.formatted.adobe.feature.name&&(l.prop22=CBC.APP.SC.DTM.formatted.adobe.feature.name,l.eVar83="D=c22"),CBC.APP.SC.DTM.formatted.adobe.feature.position&&(l.prop24=CBC.APP.SC.DTM.formatted.adobe.feature.position,l.eVar84="D=c24"),!0)},checkEmbeddedMedia:function(){CBC.APP.SC.DTM&&CBC.APP.SC.DTM.formatted&&CBC.APP.SC.DTM.formatted.adobe&&["story","segment","blogentry"].includes(CBC.APP.SC.DTM.DATA.contenttype)&&(l.prop16=CBC.APP.SC.DTM.formatted.adobe.embedtypes)},checkCbcIdCookieExists:function(){u.getCookie("CBC_ID")?(u.expireCookie("CBC_ID"),l.prop73="true"):l.prop73="false"},checkHTTPSstatus:function(e){return new RegExp(/^https:\/\//).test(e)?(l.prop74="yes",!0):!(l.prop74="no")},objToQueryString:function(e){var t,i="";for(t in e)e.hasOwnProperty(t)&&(i+="&"+t+"="+e[t]);return i.slice(1)},detectAdBlocker:function(){CBC.APP.SC.ads?(l.prop68="false",l.eVar68="false"):(l.prop68="true",l.eVar68="true")},urlToObj:function(e,t){var i,n=t.split("/"),a={},r=0;r=(e.match("cbcmusic")?a.contentarea="music":a.contentarea="misc",1);for(var o=0;o<n.length;o++)""!==n[o]&&(i="subsection"+r,r++,a[i]=u.sanitize(n[o]));return a.contenttype="index",a.url="https://"+e+t,a},getReferrer:function(e){return void 0!==e&&""!==e&&(l.prop57=e,l.eVar57="D=c57",!0)},setInitialized:function(){h=!0},setUserTier:function(){window.viafoura&&window.viafoura.users&&window.viafoura.users.current&&window.viafoura.users.current().user_privilege?this.isLoggedIn()?l.prop58="authenticated":l.prop58="unauthenticated":CBC&&CBC.APP&&CBC.APP.SC&&CBC.APP.SC.DTM&&CBC.APP.SC.DTM.DATA&&CBC.APP.SC.DTM.DATA.userTier&&(l.prop58=CBC.APP.SC.DTM.DATA.userTier)},readLinkTrackerCookie:function(){try{var e=window.s_cbc_sitecatalyst.c_r("SC_LINKS");if(e){var t=JSON.parse(e);return l.prop21=t.pageName,l.prop22=t.linkName,l.prop23=t.concatValue,l.prop24=t.linkPosition,window.s_cbc_sitecatalyst.c_w("SC_LINKS","",0),!0}return}catch(e){window.s_cbc_sitecatalyst.c_w("SC_LINKS","",0)}},parseStatsVars:function(){var e;for(d.scqs.contentarea?d.channel=d.scqs.contentarea:d.scqs.contentArea&&(d.channel=d.scqs.contentArea),l.channel=d.channel,d.subsection=[],d.scqs.contenttype&&(d.contenttype=d.scqs.contenttype),l.prop4=d.contenttype,e=1;e<=5;e++)d.scqs["subsection"+e]&&d.subsection.push(d.scqs["subsection"+e]);d.scqs.contentid&&(l.prop6=d.scqs.contentid),this.setContentVars(),l.pageName=this.setPageName(),l.hier1=d.hier1,this.setSubsectionVars(),l.prop14=this.removeDomain(d.pageurl),l.eVar14=d.pageurl,l.prop15=this.getUserSegmentation(),this.registerPageView()},setCMFAppId:function(){d.scqs.cmfAppId&&(l.prop69=d.scqs.cmfAppId)},setStrategicPillar:function(){0===Object.getOwnPropertyNames(CBC.APP.SC.Pillar).length&&(CBC.APP.SC.Pillar={pillar:{available:["feed","listen","watch","legacyee"],url:{default:"legacy","cbc.ca/listen":"listen","cbcmusic.ca":"listen","watch.cbc.ca":"watch","gem.cbc.ca":"watch","watch.qa.nm.cbc.ca":"watch","gem.qa.nm.cbc.ca":"watch"}}});var e=CBC.APP.SC.Pillar.pillar;if(l.prop67=e.url.default,d.scqs.pillar&&-1<e.available.indexOf(d.scqs.pillar))l.prop67=u.sanitize(d.scqs.pillar);else if(!CBC.APP.SC.QueryString&&!window.scstats&&CBC.APP.SC.DTM.DATA.pillar&&-1<e.available.indexOf(CBC.APP.SC.DTM.DATA.pillar))l.prop67=u.sanitize(CBC.APP.SC.DTM.DATA.pillar);else for(var t in e.url)if(e.url.hasOwnProperty(t)&&-1<d.pageurl.indexOf(t)){l.prop67=e.url[t],CBC.APP.SC.DTM.DATA.pillar=e.url[t],d.scqs.pillar=e.url[t];break}},setUserJourney:function(){var e=CBC.APP.SC.Pillar.pillar.url.default;void 0!==d.scqs.pillar&&d.scqs.pillar!==e?e=d.scqs.pillar:l.prop67!==e&&(e=l.prop67),void 0!==d.scqs.syndicate&&"cbcca-web"!==d.scqs.syndicate?e=d.scqs.syndicate:"cbcca-web"!==l.prop66&&(e=l.prop66),l.prop35=e+":"+d.scqs.contentarea+":"+d.scqs.contenttype},setTimeVars:function(){var e=this.getTimeVars();void 0!==e.var9&&(l.prop9=e.var9),void 0!==e.var10&&(l.prop10=e.var10)},getTimeVars:function(){function e(e){return"number"==typeof e?("0"+e).slice(-2):null}var t,i,n={},a=new Date,r=(t=a)&&"function"==typeof t.getTimezoneOffset?-t.getTimezoneOffset()/60:null,o=a.getDay(),s=0===o||6===o?"weekend":"weekday";return n.var9=((i=a)&&"function"==typeof i.getHours?e(i.getHours())+e(i.getMinutes()):null)+"|"+r,n.var10=s+"|"+["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][o]+"|"+("0"+a.getHours()).slice(-2)+(30<a.getMinutes()?"30":"00"),n},setOsAppVars:function(){var e=this.getOsAppVars();void 0!==e.var60&&(l.prop60=e.var60),void 0!==e.var61&&(l.prop61=e.var61),void 0!==e.var62&&(l.prop62=e.var62),void 0!==e.var63&&(l.prop63=e.var63),void 0!==e.var64&&(l.prop64=e.var64)},getAdHierarchy:function(){d.scqs.hierarchy?l.prop65=d.scqs.hierarchy:CBC.Metadata&&CBC.Metadata.hierarchy&&(l.prop65=CBC.Metadata.hierarchy)},getOsAppVars:function(){var e={};return CBC.APP.SC.DTM.formatted&&CBC.APP.SC.DTM.formatted.adobe&&CBC.APP.SC.DTM.formatted.adobe.appname?e.var60=CBC.APP.SC.DTM.formatted.adobe.appname:e.var60="cbcca-web",e.var61="osVersion",e.var62="os",e.var63="web",e.var64="2.59.0",e.var64=d.scqs.appVersion?d.scqs.appVersion:e.var64,void 0===window.Detectizr||void 0===window.Detectizr.os||("undefined"!==window.Detectizr.os.name&&("ott-web-app"===e.var60?e.var62=window.Detectizr.os.name+"|"+e.var60:e.var62=window.Detectizr.os.name),"undefined"!==window.Detectizr.os.version&&(e.var61=window.Detectizr.os.version)),e},setFromMetaTags:function(){var e,t=document.getElementsByTagName("META");if(d.scqs.originaltitle)d.originalHeadline=d.scqs.orginaltitle;else{for(e=0;e<t.length;e++)"original-headline"===t[e].name&&(d.originalHeadline=t[e].content);CBC.APP.SC["original-headline"]&&(d.originalHeadline=CBC.APP.SC["original-headline"],d.originalHeadline=d.originalHeadline.replace(/\s/g,"-"),d.originalHeadline=d.originalHeadline.toLowerCase())}if("string"==typeof d.scqs.keywords)l.list1=d.scqs.keywords.replace(/, /g,",").replace(/\s/g,"-").toLowerCase();else if("object"===_typeof(d.scqs.keywords))l.list1=this.parseKeywords(d.scqs.keywords);else for(e=0;e<t.length;e++)"keywords"===t[e].name&&(l.list1=t[e].content.replace(/, /g,",").replace(/\s/g,"-").toLowerCase());d.scqs.experiments&&d.scqs.experiments.content&&(l.list3=d.scqs.experiments.content.trim()),l.list2=d.scqs.authors?d.scqs.authors.replace(/, /g,",").replace(/\s/g,"-").toLowerCase():void 0,d.scqs.syndicate?l.prop66=u.normalize(d.scqs.syndicate):CBC.APP.SC.syndicate?l.prop66=u.normalize(CBC.APP.SC.syndicate):l.prop66="cbcca-web"},setWordCount:function(){CBC.APP.SC.DTM.formatted.adobe.wordcount&&["story","segment","blogentry"].includes(CBC.APP.SC.DTM.DATA.contenttype)&&(l.prop7=CBC.APP.SC.DTM.formatted.adobe.wordcount)},setContentVars:function(){if(d.scqs.author&&(l.prop25=d.scqs.author),d.scqs.title&&d.scqs.pubdate&&d.scqs.contentid){var e,t=new Date(parseInt(d.scqs.pubdate)),i=t.getUTCDate();i<10&&(i="0"+i);var n=t.getUTCMonth()+1;n<10&&(n="0"+n),e=t.getUTCFullYear()+"/"+n+"/"+i+"/"+d.scqs.contentid,l.prop27=e+":"+d.scqs.title}d.scqs.section&&(l.prop26=d.scqs.section,d.subsection.push(d.scqs.section)),d.scqs.sitename&&(l.prop26=d.scqs.sitename),d.scqs.postdate&&(l.prop28=d.scqs.postdate)},getUrl:function(){var e="";if(e=CBC.APP.SC.url?CBC.APP.SC.url:d.scqs.url?decodeURIComponent(d.scqs.url):window.location.href,!u.isExternallyHosted()){var t=e.indexOf("#");-1!==t&&(e=e.substring(0,t));var i=e.indexOf("?");-1!==i&&(e=e.substring(0,i))}d.pageurl=e},removeDomain:function(e){return e.replace(/https?:\/\/.*?cbc(music)?\.ca(:.*?)*\//,"")},setSubsectionVars:function(){for(var e=0;e<3;e++)if(d.subsection[e]){var t=d.subsection.slice(0,e+1);l["prop"+(e+1)]=d.channel+":"+t.join(":")}},clearVariables:function(){try{u.console("before clearing variables",s_cbc_sitecatalyst);var e=d.pageviewcount;(d=[]).pageviewcount=e,t(),delete window.s_cbc_sitecatalyst.pageName,window.s_cbc_sitecatalyst.clearVars(),u.console("after clearing variables",s_cbc_sitecatalyst)}catch(e){console.log(e)}},copyPropsToEvars:function(){l.prop1&&!l.eVar1&&(l.eVar1="D=c1"),l.prop2&&!l.eVar2&&(l.eVar2="D=c2"),l.prop3&&!l.eVar3&&(l.eVar3="D=c3"),l.prop4&&!l.eVar4&&(l.eVar4="D=c4"),l.prop5&&!l.eVar5&&(l.eVar5="D=c5"),l.prop6&&!l.eVar6&&(l.eVar6="D=c6"),l.prop7&&!l.eVar7&&(l.eVar7="D=c7"),l.prop8&&!l.eVar8&&(l.eVar8="D=c8"),l.prop9&&!l.eVar9&&(l.eVar9="D=c9"),l.prop10&&!l.eVar10&&(l.eVar10="D=c10"),l.pageName&&!l.eVar11&&(l.eVar11="D=pageName"),l.channel&&!l.eVar12&&(l.eVar12="D=ch"),l.prop13&&!l.eVar13&&(l.eVar13="D=c13"),l.prop15&&!l.eVar15&&(l.eVar15="D=c15"),l.prop16&&!l.eVar16&&(l.eVar16="D=c16"),l.prop17&&!l.eVar17&&(l.eVar17="D=c17"),l.prop18&&!l.eVar18&&(l.eVar18="D=c18"),l.prop25&&!l.eVar25&&(l.eVar25="D=c25"),l.prop26&&!l.eVar26&&(l.eVar26="D=c26"),l.prop27&&!l.eVar27&&(l.eVar27="D=c27"),l.prop28&&!l.eVar28&&(l.eVar28="D=c28"),l.prop35&&!l.eVar35&&(l.eVar35="D=c35"),l.prop36&&!l.eVar36&&(l.eVar36="D=c36"),l.prop37&&!l.eVar37&&(l.eVar37="D=c37"),l.prop40&&!l.eVar40&&(l.eVar40="D=c40"),l.prop41&&!l.eVar41&&(l.eVar41="D=c41"),l.prop42&&!l.eVar42&&(l.eVar42="D=c42"),l.prop44&&!l.eVar44&&(l.eVar44="D=c44"),l.prop45&&!l.eVar45&&(l.eVar45="D=c45"),l.prop46&&!l.eVar46&&(l.eVar46="D=c46"),l.prop47&&!l.eVar47&&(l.eVar47="D=c47"),l.prop48&&!l.eVar48&&(l.eVar48="D=c48"),l.prop51&&!l.eVar51&&(l.eVar51="D=c51"),l.prop52&&!l.eVar52&&(l.eVar52="D=c52"),l.prop53&&!l.eVar53&&(l.eVar53="D=c53"),l.prop58&&!l.eVar58&&(l.eVar58="D=c58"),l.prop60&&!l.eVar60&&(l.eVar60="D=c60"),l.prop61&&!l.eVar61&&(l.eVar61="D=c61"),l.prop62&&!l.eVar62&&(l.eVar62="D=c62"),l.prop63&&!l.eVar63&&(l.eVar63="D=c63"),l.prop64&&!l.eVar64&&(l.eVar64="D=c64"),l.prop65&&!l.eVar65&&(l.eVar65="D=c65"),l.prop66&&!l.eVar66&&(l.eVar66="D=c66"),l.prop67&&!l.eVar67&&(l.eVar67="D=c67"),l.prop69&&!l.eVar69&&(l.eVar69="D=c69"),l.prop70&&!l.eVar70&&(l.eVar70="D=c70"),l.prop73&&!l.eVar73&&(l.eVar73="D=c73")},buildPageName:function(){var e=d.subsection.join(d.separator),t=[];0<arguments.length&&(t=u.arrayFromArguments(arguments)),t[0]&&u.typecheck(t[0]).array&&0<t[0].length&&(t=t[0]),0<d.subsection.length&&t.splice(0,0,e),t.splice(0,0,d.channel);for(var i=t.length;0<=i;i--){if(t[i]&&void 0!==d.scqs.contentid&&t[i]===l.prop5&&d.scqs.pubdate&&d.scqs.contenttype){var n=new Date(parseInt(d.scqs.pubdate)),a=n.getUTCDate();a<10&&(a="0"+a);var r=n.getUTCMonth()+1;r<10&&(r="0"+r),t[i]=n.getUTCFullYear()+"-"+r+"-"+a+"-"+d.scqs.contentid+"-"+t[i];break}if(t[i]&&void 0!==d.scqs.contentid&&t[i]===l.prop5&&d.scqs.contenttype){t[i]=d.scqs.contentid+"-"+t[i];break}}return(CBC.APP.SC.PageTracker.objEmpty(d.scqs)&&!d.directory?"misc:"+d.pageurl.replace(/:/g,"-"):t.join(d.separator)).toLowerCase().replace(/\s/g,"-")},conditionalEqualInArray:function(e,t){for(var i=e.length,n=0;n<i;n++)if(e[n]===t)return!0;return!1},getPageName:function(){return d.pageName},setPageName:function(){if("page"!==d.contenttype){this.conditionalEqualInArray(["story","episode","segment","feature","blogentry","media","authorbio","riding","image","link","photogallery","stub","bio","recipe"],d.contenttype)&&d.scqs.title?this.handleStory():"videoclip"!==d.contenttype&&"audioclip"!==d.contenttype||!d.scqs.title?"error"===d.contenttype?this.handleErrorPage():"index"===d.contenttype?this.handleIndexPage():this.handleOtherContent():this.handleVideoClip()}else"page"===d.contenttype&&this.handleGenericPage();return d.pageName},setTitle:function(){d.scqs.title&&!l.prop5&&(d.scqs.title=d.scqs.title.replace(/\//g,"-"),l.prop5=d.scqs.title)},setSponsor:function(){d.scqs.sponsor&&d.scqs.sponsor.name&&(CBC.APP.SC.UTIL.getMetadataWhitelist().metadata.whitelist.sponsor.name[d.scqs.sponsor.name]?l.prop51=d.scqs.sponsor.name:delete d.scqs.sponsor)},setContentPartner:function(){d.scqs.partner&&d.scqs.partner.name&&CBC.APP.SC.UTIL.getMetadataWhitelist().metadata.whitelist.partner.name[d.scqs.partner.name]&&(l.prop52=d.scqs.partner.name)},handleStory:function(){if(CBC.APP.SC.storyTitle&&(l.prop5=CBC.APP.SC.storyTitle,d.originalHeadline)){var e=d.scqs.title.split("-",1);d.scqs.title=e+"-"+d.originalHeadline}d.scqs.originaltitle&&(d.scqs.title=d.scqs.originaltitle),d.scqs.title=d.scqs.title.replace(/\//g,"-").replace(/\s/g,"-").toLowerCase(),l.prop5||(l.prop5=d.scqs.title),d.pageName=this.buildPageName(d.contenttype,d.scqs.title),l.prop11="D=pageName",d.hier1=this.getHierarchy()},handleVideoClip:function(){this.setTitle(),d.pageName=this.buildPageName(d.contenttype,d.scqs.title),d.hier1=this.getHierarchy()},handleErrorPage:function(){l.pageType="errorPage",d.pageName=this.buildPageName(),d.hier1=this.getHierarchy()},handleIndexPage:function(){d.pageName=this.buildPageName("index"),d.hier1=this.getHierarchy()},handleOtherContent:function(){d.contenttype?(d.pageName=this.buildPageName(d.contenttype),"audioclip"===d.contenttype&&this.setTitle()):d.pageName=this.buildPageName(),d.hier1=this.getHierarchy()},handleGenericPage:function(){var e=[];if(this.objEmpty(d.scqs)&&d.directory){e.push(d.directory);var t=this.getSubFolders(d.directory);""!==t&&e.push(t)}var i=this.getCurrentFile();"cbc"===i||"web"===i||d.scqs.filename||e.push(i),0<e.length?d.pageName=this.buildPageName(e):d.pageName=this.buildPageName(),d.hier1=this.getHierarchy(d.directory)},getHierarchy:function(e){if(0===d.subsection.length)return d.channel;var t=d.subsection.join(","),i=d.channel+","+t;return e&&(i+=","+e),i},registerPageView:function(){this.copyPropsToEvars(),l.campaign||(l.campaign=l.Util.getQueryParam("cmp")),l.campaign=l.getValOnce(l.campaign,"s_campaign",0),l.hbx_lt="auto",l.events=l.apl(l.events,"event2",",",2),l.prop71="undefined"!=typeof Visitor?"VisitorAPI Present":"VisitorAPI Missing",l.t()},getSubFolders:function(e){var t=d.pageurl,i=new RegExp(e+"\\/(.*)\\/"),n=t.match(i);return n&&2===n.length?n[1].replace("/",d.separator):""},getCurrentFile:function(){var e=d.pageurl.match(/.*\/([^?#]*)/)[1];return""!==e?e:"index.html"},getVal:function(e){return d[e]},objEmpty:function(e){for(var t in e)if("function"!=typeof e[t])return!1;return!0},setSearchPrefix:function(){0<window.location.port.length?d.searchprefix="cbc.ca:"+window.location.port+"/":d.searchprefix="cbc.ca/"},getUserSegmentation:function(){var e=this.isLoggedIn()?"loggedin":"anonymous",t=this.isCommentor()?"commentor":"";return e+(t?" | "+t:"")},isLoggedIn:function(){try{return"guest"!==window.viafoura.users.current().user_privilege}catch(e){return!1}},isCommentor:function(){try{return 0<window.viafoura.users.current().comments_made}catch(e){return!1}},setDateVars:function(){var e=this.getDateVars();void 0!==e.var13&&(l.prop13=e.var13)},getDateVars:function(){var e={};if(!/^(index|bio)$/i.test(d.scqs.contenttype)){var t,i=new RegExp("^\\d+$");i.test(CBC.APP.SC.publishedTime)?t=CBC.APP.SC.publishedTime:d.scqs.pubdate&&i.test(d.scqs.pubdate)?t=d.scqs.pubdate:void 0!==d.scqs.pubdate&&(t="Incorrect date format received: "+d.scqs.pubdate),e.var13=t}return e},exitSPA:function(){return!(d.pageviewcount=0)},parseKeywords:function(e){var t=0,i=0,n=[];if("object"!==_typeof(e))return"";for(t=0;t<e.length;t++)for(i=0;i<e[t].entities.length;i++)n.push(e[t].name+":"+e[t].entities[i].name);return n.join([","]).toLowerCase().replace(/\s/g,"-")},checkStatsVersions:function(e,t){var i=(e===t)+":"+e+":"+t;return l.prop70=i}}}(),CBC.APP.SC.preventDefault||CBC.APP.SC.DTM.DATA.preventDefault?CBC.APP.SC.UTIL.console("Warning: Not firing page tracking on page load"):CBC.APP.SC.PageTracker.init(),function(){if(document.getElementById("cbc-as-search-root")){var e=document.createElement("link");e.rel="stylesheet",e.id="cbc-as-search-css",e.href="/search-assets/static/css/cbc-as-search.css",document.head.appendChild(e);var t=document.createElement("script");t.type="text/javascript",t.id="cbc-as-search-js",t.src="/search-assets/static/js/cbc-as-search.js",document.body.appendChild(t)}}(),function(n){function e(e,t){var i=window.document.createElement("iframe");i.setAttribute("src","/g/stats/html/cmf.html?a="+e+"&m="+t+"&s=cbc&p="+encodeURIComponent(n.location.href)),i.setAttribute("id","cmf-iframe"),i.setAttribute("width","0"),i.setAttribute("height","0"),i.setAttribute("frameBorder","0"),document.body.appendChild(i)}n.CBC||(n.CBC={}),n.CBC.APP||(n.CBC.APP={}),n.CBC.APP.SC||(n.CBC.APP.SC={}),n.CBC.APP.SC.DTM||(n.CBC.APP.SC.DTM={}),n.CBC.APP.SC.DTM.DATA||(n.CBC.APP.SC.DTM.DATA={}),document.getElementById("cmf-iframe")&&document.getElementById("cmf-iframe").remove();var t,i={"cbc.ca\\/xcompany\\/debriefing":"1415.11316.140589","cbc.ca\\/bellevue\\/videos\\/1994-videos":"1617.11311.146736","cbc.ca\\/kidscbc1\\/shows\\/chirp":"1213.11116.133491","cbc.ca\\/covermecanada":"1112.11416.132002","cbc.ca\\/player\\/tv\\/Halifax%20Comedy%20Festival\\/Season%2019":"1415.11453.141153","cbc.ca\\/kidscbcolympics":"1617.11116.144982","cbc.ca\\/murdochmysteries\\/onthecase":"1516.11316.142584","cbc.ca\\/murdochmysteries\\/noqs":"1213.11316.132929","cbc.ca\\/murdochmysteries\\/videos\\/making-murdoch\\/\\S+":"1314.11313.138117","cbc.ca\\/murdochmysteries\\/theinfernaldevice":"1415.11353.141147","cbc.ca\\/overtherainbow":"1213.11416.133409","cbc.ca\\/republicofdoyle\\/episodes\\/season-5\\/\\S+":"1314.11313.138147","cbc.ca\\/thebestlaidplans\\/videos\\/the-petes-laid-plans\\/\\S+":"1314.11313.138145","cbc.ca\\/22minutes\\/videos\\/22-minutes-update\\/\\S+":"1516.11353.142570","cbc.ca\\/thislife\\/videos\\/exclusives\\/\\S+":"1516.11313.142585","cbc.ca\\/workinmoms\\/videos\\/season-1\\/\\S+":"1617.11353.145375","cbc.ca\\/xcompany\\/videos\\/x-company-animated\\/\\S+":"1516.11313.142581","cbc.ca\\/shootthemessenger\\/murderboard":"1516.11315.142932","cbc.ca\\/arcticair\\/videos\\/man-of-the-north":"1112.11316.131909","cbc.ca\\/michael\\/videos\\/lost-therapy-tapes":"1112.11316.131239","cbc.ca\\/michael\\/videos\\/after-the-beep":"1112.11316.131239","comedycoup.cbc.ca\\/cc\\/canada-2014":"1415.11316.139499","cbc.ca\\/mrd\\/videos\\/xavier-gazette":"1112.11316.131856","cbc.ca\\/insecurity":"1011.11316.128616"};Object.keys(i).some(function(e){return!!new RegExp(e).test(n.location.href)&&(t=i[e],!0)})?e(t,n.document.title):n.CBC.APP.SC.DTM.DATA&&n.CBC.APP.SC.DTM.DATA.cmfAppId&&e(n.CBC.APP.SC.DTM.DATA.cmfAppId,n.CBC.APP.SC.DTM.DATA.title)}(window._window||window);