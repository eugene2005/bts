(window._vfP=window._vfP||[]).push([[26],{1382:function(e,t,i){},1383:function(e,t){e.exports="<div class=viafoura> <transition name=fade> <vf-realtime-bar class=realtime-bar---v2-commenting v-bind=this.$data v-if=visible :show-action-button=false @realtime-main-action=clicked></vf-realtime-bar> </transition> </div> "},1384:function(e,t,i){var n=i(425);e.exports=(n.default||n).template({1:function(e,t,i,n,s){return" vf-sharelink"},3:function(e,t,i,n,s){var o,a,r=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,c=e.escapeExpression;return'        <li class="vf-user-title vf-tip" data-title="title_'+c("function"==typeof(a=null!=(a=i.title||(null!=t?t.title:t))?a:l)?a.call(r,{name:"title",hash:{},data:s,loc:{start:{line:11,column:59},end:{line:11,column:68}}}):a)+'">\n'+(null!=(o=(i.isEqual||t&&t.isEqual||l).call(r,null!=t?t.title:t,"moderator",{name:"isEqual",hash:{},fn:e.program(4,s,0),inverse:e.program(6,s,0),data:s,loc:{start:{line:12,column:12},end:{line:16,column:24}}}))?o:"")+'            <span class="vf-offscreen-text">'+c((i.i18n||t&&t.i18n||l).call(r,null!=t?t.title_desc_key:t,{name:"i18n",hash:{},data:s,loc:{start:{line:17,column:44},end:{line:17,column:69}}}))+"</span>\n        </li>\n"},4:function(e,t,i,n,s){var o,a;return"                "+(null!=(o="function"==typeof(a=null!=(a=i.moderatorIcon||(null!=t?t.moderatorIcon:t))?a:e.hooks.helperMissing)?a.call(null!=t?t:e.nullContext||{},{name:"moderatorIcon",hash:{},data:s,loc:{start:{line:13,column:16},end:{line:13,column:37}}}):a)?o:"")+"\n"},6:function(e,t,i,n,s){var o;return"                "+(null!=(o=(i.icon||t&&t.icon||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},null!=t?t.title:t,"medium",{name:"icon",hash:{},data:s,loc:{start:{line:15,column:16},end:{line:15,column:43}}}))?o:"")+"\n"},8:function(e,t,i,n,s){return"inherit"},10:function(e,t,i,n,s){return"none"},12:function(e,t,i,n,s){var o,a=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing;return'        <li class="vf-right vf-comment-highlight">\n            <em class="vf-comment-highlight-text vf-text-small">'+e.escapeExpression((i.i18n||t&&t.i18n||r).call(a,"editor_pick_icon_txt",{name:"i18n",hash:{},data:s,loc:{start:{line:24,column:64},end:{line:24,column:95}}}))+'</em>\n            <span class="vf-editors-pick-icon" aria-hidden="true">\n                '+(null!=(o=(i.icon||t&&t.icon||r).call(a,"editors_pick","small",{name:"icon",hash:{},data:s,loc:{start:{line:26,column:16},end:{line:26,column:50}}}))?o:"")+"\n            </span>\n        </li>\n"},14:function(e,t,i,n,s){return'<em class="vf-badge vf-content-badge vf-owner-badge vf-label vf-label-upper"><span>'+e.escapeExpression((i.i18n||t&&t.i18n||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},"owner_status",{name:"i18n",hash:{},data:s,loc:{start:{line:33,column:114},end:{line:33,column:139}}}))+"</span></em>"},16:function(e,t,i,n,s){return'        <div data-view="gallery"></div>\n'},18:function(e,t,i,n,s){return'        <li class="vf-rt-has-edit-li"><a href="#" class="vf-rt-has-edit-link">'+e.escapeExpression((i.i18n||t&&t.i18n||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},"comment_edited",{name:"i18n",hash:{},data:s,loc:{start:{line:46,column:78},end:{line:46,column:103}}}))+"</a></li>\n"},20:function(e,t,i,n,s){return" vf-dislike-enabled"},22:function(e,t,i,n,s){return" hidden"},24:function(e,t,i,n,s){return"vf-like-dislike"},26:function(e,t,i,n,s){return"vf-disabled-likes"},28:function(e,t,i,n,s){var o,a,r=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,c=e.escapeExpression;return'            <li class="'+(null!=(o=i.if.call(r,null!=t?t.enableDislikes:t,{name:"if",hash:{},fn:e.program(24,s,0),inverse:e.noop,data:s,loc:{start:{line:58,column:23},end:{line:58,column:67}}}))?o:"")+'">\n                <button class="vf-comment-actions-btn vf-dislike-btn '+c("function"==typeof(a=null!=(a=i.dislikeClass||(null!=t?t.dislikeClass:t))?a:l)?a.call(r,{name:"dislikeClass",hash:{},data:s,loc:{start:{line:59,column:69},end:{line:59,column:85}}}):a)+" "+(null!=(o=(i.isEqual||t&&t.isEqual||l).call(r,null!=t?t.email_unverified:t,1,{name:"isEqual",hash:{},fn:e.program(26,s,0),inverse:e.noop,data:s,loc:{start:{line:59,column:86},end:{line:59,column:146}}}))?o:"")+'">\n                    '+(null!=(o=(i.icon||t&&t.icon||l).call(r,"dislike","medium",{name:"icon",hash:{},data:s,loc:{start:{line:60,column:20},end:{line:60,column:51}}}))?o:"")+'\n                    <span class="vf-count-dislikes"><span>'+c("function"==typeof(a=null!=(a=i.num_dislikes||(null!=t?t.num_dislikes:t))?a:l)?a.call(r,{name:"num_dislikes",hash:{},data:s,loc:{start:{line:61,column:58},end:{line:61,column:74}}}):a)+'</span></span><span class="vf-count-dislikes-label"> '+c((i.i18n||t&&t.i18n||l).call(r,"dislikes_lnk",{name:"i18n",hash:{},data:s,loc:{start:{line:61,column:127},end:{line:61,column:152}}}))+"</span>\n                </button>\n            </li>\n"},30:function(e,t,i,n,s){var o;return'            <li>\n                <button class="vf-comment-actions-btn vf-reply-btn">\n                    '+(null!=(o=(i.icon||t&&t.icon||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},"reply","medium ",{name:"icon",hash:{},data:s,loc:{start:{line:68,column:20},end:{line:68,column:49}}}))?o:"")+"\n                </button>\n            </li>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,i,n,s){var o,a,r,l=null!=t?t:e.nullContext||{},c=e.hooks.helperMissing,h="function",u=e.escapeExpression,d='<div class="vf-comment-container vf-comment '+u(typeof(a=null!=(a=i.classes||(null!=t?t.classes:t))?a:c)===h?a.call(l,{name:"classes",hash:{},data:s,loc:{start:{line:1,column:44},end:{line:1,column:55}}}):a);return a=null!=(a=i.sharelink||(null!=t?t.sharelink:t))?a:c,r={name:"sharelink",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s,loc:{start:{line:1,column:55},end:{line:1,column:96}}},o=typeof a===h?a.call(l,r):a,i.sharelink||(o=e.hooks.blockHelperMissing.call(t,o,r)),null!=o&&(d+=o),d+'" data-id="'+u(typeof(a=null!=(a=i.id||(null!=t?t.id:t))?a:c)===h?a.call(l,{name:"id",hash:{},data:s,loc:{start:{line:1,column:107},end:{line:1,column:113}}}):a)+'" itemscope itemtype="http://schema.org/Review">\n    <div class="vf-comment-user-container">\n        <div class="vf-rt-new-circle vf-rt-accent-color-background"></div>\n        <div class="view" data-view="avatar"></div>\n    </div>\n\n    <ul class="vf-row vf-user-meta vf-hlist vf-text-small">\n        <li class="vf-comment-rating" itemprop="reviewRating" itemscope itemtype="http://schema.org/Rating"><div class="view" data-view="comment_rating"></div></li>\n        <li class="vf-comment-username" itemprop="author" itemscope itemtype="http://schema.org/Person"><button class="vf-username h4" itemprop="name">'+u(e.lambda(null!=(o=null!=t?t.user:t)?o.name:o,t))+"</button></li>\n"+(null!=(o=i.if.call(l,null!=t?t.title:t,{name:"if",hash:{},fn:e.program(3,s,0),inverse:e.noop,data:s,loc:{start:{line:10,column:8},end:{line:19,column:15}}}))?o:"")+'        <li class="vf-js-date vf-date" itemprop="datePublished" content="'+u(typeof(a=null!=(a=i.formattedDate||(null!=t?t.formattedDate:t))?a:c)===h?a.call(l,{name:"formattedDate",hash:{},data:s,loc:{start:{line:20,column:73},end:{line:20,column:92}}}):a)+'"></li>\n        <li class="vf-right vf-js-outdated-message" style="display:'+(null!=(o=i.if.call(l,null!=t?t.isOutdated:t,{name:"if",hash:{},fn:e.program(8,s,0),inverse:e.program(10,s,0),data:s,loc:{start:{line:21,column:67},end:{line:21,column:111}}}))?o:"")+';"> '+u((i.i18n||t&&t.i18n||c).call(l,"reply_outdated",null!=t?t.parentType:t,{name:"i18n",hash:{},data:s,loc:{start:{line:21,column:115},end:{line:21,column:151}}}))+" </li>\n"+(null!=(o=i.if.call(l,null!=t?t.editor_pick:t,{name:"if",hash:{},fn:e.program(12,s,0),inverse:e.noop,data:s,loc:{start:{line:22,column:8},end:{line:29,column:15}}}))?o:"")+'    </ul>\n    <div class="vf-row">\n\n        '+(null!=(o=i.if.call(l,null!=t?t.isCurrentOwner:t,{name:"if",hash:{},fn:e.program(14,s,0),inverse:e.noop,data:s,loc:{start:{line:33,column:8},end:{line:33,column:158}}}))?o:"")+'\n\n        <span class="vf-comment-html">\n            <span class="view" data-view="comment_badge"></span>\n            <span class="vf-comment-html-content" itemprop="description" content="'+u(typeof(a=null!=(a=i.truncatedDescription||(null!=t?t.truncatedDescription:t))?a:c)===h?a.call(l,{name:"truncatedDescription",hash:{},data:s,loc:{start:{line:37,column:82},end:{line:37,column:108}}}):a)+'"> '+(null!=(o=(i.formatLinks||t&&t.formatLinks||c).call(l,null!=t?t.content:t,{name:"formatLinks",hash:{},data:s,loc:{start:{line:37,column:111},end:{line:37,column:136}}}))?o:"")+" </span>\n        </span>\n\n"+(null!=(o=i.unless.call(l,null!=(o=null!=t?t.settings:t)?o.disablePreview:o,{name:"unless",hash:{},fn:e.program(16,s,0),inverse:e.noop,data:s,loc:{start:{line:40,column:4},end:{line:42,column:15}}}))?o:"")+'    </div>\n    <ul class="vf-row vf-comment-meta vf-hlist">\n'+(null!=(o=i.if.call(l,null!=t?t.wasEdited:t,{name:"if",hash:{},fn:e.program(18,s,0),inverse:e.noop,data:s,loc:{start:{line:45,column:4},end:{line:47,column:11}}}))?o:"")+'    </ul>\n    <div class="vf-row vf-row-edges">\n        <ul class="vf-comment-actions vf-strong vf-hlist '+(null!=(o=i.if.call(l,null!=t?t.enableDislikes:t,{name:"if",hash:{},fn:e.program(20,s,0),inverse:e.noop,data:s,loc:{start:{line:50,column:57},end:{line:50,column:105}}}))?o:"")+(null!=(o=i.if.call(l,null!=t?t.wasEdited:t,{name:"if",hash:{},fn:e.program(22,s,0),inverse:e.noop,data:s,loc:{start:{line:50,column:105},end:{line:50,column:136}}}))?o:"")+'">\n            <li class="'+(null!=(o=i.if.call(l,null!=t?t.enableDislikes:t,{name:"if",hash:{},fn:e.program(24,s,0),inverse:e.noop,data:s,loc:{start:{line:51,column:23},end:{line:51,column:67}}}))?o:"")+'">\n                <button class="vf-comment-actions-btn vf-new-like-btn '+u(typeof(a=null!=(a=i.likeClass||(null!=t?t.likeClass:t))?a:c)===h?a.call(l,{name:"likeClass",hash:{},data:s,loc:{start:{line:52,column:70},end:{line:52,column:83}}}):a)+" "+(null!=(o=(i.isEqual||t&&t.isEqual||c).call(l,null!=t?t.email_unverified:t,1,{name:"isEqual",hash:{},fn:e.program(26,s,0),inverse:e.noop,data:s,loc:{start:{line:52,column:84},end:{line:52,column:144}}}))?o:"")+'">\n                    '+(null!=(o=(i.icon||t&&t.icon||c).call(l,"like","medium",{name:"icon",hash:{},data:s,loc:{start:{line:53,column:20},end:{line:53,column:48}}}))?o:"")+'\n                    <span class="vf-count-likes"><span>'+u(typeof(a=null!=(a=i.num_likes||(null!=t?t.num_likes:t))?a:c)===h?a.call(l,{name:"num_likes",hash:{},data:s,loc:{start:{line:54,column:55},end:{line:54,column:68}}}):a)+'</span></span><span class="vf-count-likes-label"> '+u((i.i18n||t&&t.i18n||c).call(l,"likes_lnk",{name:"i18n",hash:{},data:s,loc:{start:{line:54,column:118},end:{line:54,column:140}}}))+"</span>\n                </button>\n            </li>\n"+(null!=(o=i.if.call(l,null!=t?t.enableDislikes:t,{name:"if",hash:{},fn:e.program(28,s,0),inverse:e.noop,data:s,loc:{start:{line:57,column:12},end:{line:64,column:19}}}))?o:"")+(null!=(o=i.unless.call(l,null!=t?t.hideReply:t,{name:"unless",hash:{},fn:e.program(30,s,0),inverse:e.noop,data:s,loc:{start:{line:65,column:12},end:{line:71,column:23}}}))?o:"")+'            <li>\n                <div class="view" data-view="comment_actions"></div>\n            </li>\n        </ul>\n        <div class="vf-comment-user-actions" data-view="user_actions"></div>\n    </div>\n</div>\n'},useData:!0})},1385:function(e,t,i){},1447:function(e,t,i){"use strict";i.r(t);var n=i(0),s=i(2),o=i(460),a=i(426),r=i(436),l=i(7),c=i(5),h=a.a.extend({initialize:function(e){e.page_id?this.model=new o.a(c.vuexStore.getInstance().getters[n.nc]({uuid:Object(l.f)(e.page_id)})):this.model=this.currentPage,this.listenTo(r.a,"/commenting/comment/created",this.incrementCount),this.render(),this.$publish(s.h.CHANNEL,s.h.EVENTS.LOADED,this.$el[0])},render:function(){return this.$el.text(this.model.get("num_replies")),this},incrementCount:function(e){e.page.id===this.model.id&&this.model.set("num_replies",this.model.get("num_replies")+1)}}),u=(i(138),i(87),i(86),i(132),i(1382),i(429)),d=i.n(u),m=i(424),f=i(18),p=i(431),g=i(430),v=i(832),b=i(450),w=(i(278),i(40),i(13),i(6),i(8),i(4),i(17),i(21)),_=i(3),y=i(79);function C(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function E(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?C(i,!0).forEach((function(t){S(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):C(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function S(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var T={props:{page:Object},created:function(){this.loadComponent(),this.loadAsyncLanguage(w.b.PAGE_SETTINGS)},data:function(){return{settingsComponent:null}},computed:E({},Object(y.c)({languageFileIsLoaded:n.Zb}),{ready:function(){return Boolean(this.settingsComponent)&&this.languageFileIsLoaded(w.b.PAGE_SETTINGS)}}),methods:E({loadComponent:function(){var e=this;Promise.all([i.e(0),i.e(89)]).then(i.bind(null,1459)).then((function(t){e.settingsComponent=t.default}))}},Object(y.b)({loadAsyncLanguage:_.Xb}))},$=i(85),k=Object($.a)(T,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.ready?i(e.settingsComponent,{tag:"component",attrs:{page:e.page},on:{"page-status-change":function(t){return e.$emit("page-status-change",t)}}}):e._e()}),[],!1,null,null,null).exports,O=i(441),x=O.a.View.extend({tagName:"vf-page-settings",attributes:{":page":"page","v-on:page-status-change":"onPageStatusChange"},initialize:function(e){this.page=e.page,this.model=e.page},render:function(){var e=c.vuexStore.getInstance();return this.vueComponent=new f.default({el:this.el,data:{backbonePage:this.page},computed:{page:function(){return this.backbonePage.toJSON()}},methods:{onPageStatusChange:function(e){this.backbonePage.set(e)}},store:e,components:{vfPageSettings:k}}),this},remove:function(){this.vueComponent&&(this.vueComponent.$el.remove(),this.vueComponent.$destroy())}}),A=(i(37),i(1383)),N=i.n(A),R=i(556),I=i(625),M={renderHoverStyles:function(e,t,i,n){e.preventDefault(),t.css({"-webkit-transition":n,"-moz-transition":n,"-ms-transition":n,"-o-transition":n,transition:n,height:i,top:0})},removeHoverStyles:function(e,t,i,n){e.preventDefault(),t.css({"-webkit-transition":n,"-moz-transition":n,"-ms-transition":n,"-o-transition":n,transition:n,height:i,top:"100%"})}},P=i(120);var F=a.a.extend({templateName:"comments_options",mixins:[b.a,M],new_comments:0,new_comments_counter_limit:9,waypoint:null,events:{"click .vf-comments-realtime":"loadNewest","touchstart .vf-rt-main-static":"touchstartStatic","touchend .vf-rt-main-static":"touchendStatic","click .js-newest":"onNewestSortOptionClick"},initialize:function(e){var t,i,n=this;m.default.bindAll(this,"onNewestSortOptionClick","loadNewest"),this.isShare=!1,this.settings=e.settings,e.hasRealtime&&this.initRealtime(),this.views={page_count:new e.PageCountView({model:e.model,user:e.user,widgetType:e.widgetType,hasRealtime:e.hasRealtime}),sort_options:new e.SortOptionsView({})},this.stickyBarData={visible:!1,labelText:""},this.stickyBar=(t=function(){return n.stickyBarData},i=function(){return n.loadNewest()},new f.default({template:N.a,data:t,methods:{clicked:i},components:{vfRealtimeBar:R.a}}).$mount()),this.rtBadgeData={max:this.new_comments_counter_limit,count:this.new_comments,ariaLabel:""},window.requestAnimationFrame((function(){document.body.appendChild(n.stickyBar.$el)})),this.viewVars={hasRealtime:e.hasRealtime,hasNotificationBell:e.hasNotificationBell},this.listenTo(this.options.intersectionModel,"change",(function(){return n.toggleStickyBar()})),this.renderCounter(),this.toggleStickyBar(),this.listenTo(this.views.sort_options,"/sort/change",(function(e){return n.onSortOptionChange(e)}))},render:function(){var e,t;return this.sort=this.options.sort,this.templateOnly(m.default.defaults(this.viewVars,Object.assign(this.model.toJSON(),{sorting_method:this.sort,sorting_aria:this.i18n("get_sort_aria",this.sort),sorting_label:this.i18n("get_sort_label",this.sort)}))),this.insertSubViews(this.$el,this.views),this.$sort=this.$(".vf-comments-sort"),"newest"===this.sort?(this.$(".js-other-text").text(this.i18n("likes_sort")),this.switchToNewestSort()):this.switchToOtherSort(),P.h&&this.initializeTouchEvents(),this.countBadge=(e=this.$(".vf-rt-bubble-text")[0],t=this.rtBadgeData,new f.default({el:e,data:t,components:{roundCountBadge:I.a}})),this},onNewestSortOptionClick:function(){this.onSortOptionChange("newest")},switchToNewestSort:function(){this.$(".js-other").data("checked",!1).attr("aria-selected",!1),this.$(".js-newest").data("checked",!0).attr("aria-selected",!0),this.$(".vf-sort-option").attr("aria-selected",!1)},switchToOtherSort:function(){this.$(".js-other-text").text(this.i18n("".concat(this.sort,"_sort"))),this.$(".js-sort-option[data-value=".concat(this.sort,"]")).closest(".vf-sort-option").attr("aria-selected",!0).addClass("vf-active"),this.$(".js-other").data("checked",!0).attr("aria-selected",!0),this.$(".js-newest").data("checked",!1).attr("aria-selected",!1)},onSortOptionChange:function(e){var t=this.sort;this.sort=e,"newest"===this.sort?(this.switchToNewestSort(),this.$(".js-newest").focus()):(this.switchToOtherSort(),this.$(".js-other").focus()),"newest"===this.sort&&this.new_comments?this.loadNewest():(this.trigger("change:sort",this.sort),r.a.trigger("/commenting/sorted",this.sort,t,this.settings.commenting_sort))},realtimeFilters:function(){var e,t,i,n=this.model.get("id"),s="".concat(n,":comment");return e={},t=s,i={event_type:["comment"],page_uuid:[g.a.toUuid(n)]},t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e},realtimeUpdate:function(e){var t=this;!this.isShare&&"comment.enable"===e.event_type&&e.thread_uuid&&(this.isSelf(e,p.a.current.user)||this.trigger("visible",g.a.toVfId(e.thread_uuid),(function(i){i||e.comment_uuid!==e.thread_uuid||t.realtimeIncrement(1)})))},initializeTouchEvents:function(){var e=this.$(".vf-rt-main-static .vf-rt-hover-state");this.rt_static={$el:e,heightDefault:e.height(),heightOnHover:this.$(".vf-rt-main-static").height(),transition:e.css("transition")}},touchstartStatic:function(e){M.renderHoverStyles(e,this.rt_static.$el,this.rt_static.heightOnHover,this.rt_static.transition)},touchendStatic:function(e){M.removeHoverStyles(e,this.rt_static.$el,this.rt_static.heightDefault,this.rt_static.transition),this.loadNewest(e)},loadNewest:function(e){var t=this;e&&e.preventDefault(),window.requestAnimationFrame((function(){g.a.isElementPartiallyInViewport(t.$el)||t.$el[0].scrollIntoView({behavior:"smooth",block:"start"})})),"newest"!==this.sort?this.changeSortOption("newest"):this.trigger("fetch")},changeSortOption:function(e){this.$sort.val(e),this.trigger("change:sort",e)},realtimeIncrement:function(e){this.new_comments+=e,this.new_comments<0&&(this.new_comments=0),this.stickyBarData.number=this.new_comments,this.rtBadgeData.count=this.new_comments,this.renderCounter(),this.toggleStickyBar()},realtimeReset:function(){this.new_comments=0,this.rtBadgeData.count=this.new_comments,this.stickyBarData.number=this.new_comments,this.renderCounter(),this.toggleStickyBar()},renderCounter:function(){if(this.new_comments){var e="newest"===this.sort?"realtime_new_comments":"realtime_new_comments_switch",t=this.i18n(e,this.new_comments,this.new_comments_counter_limit);this.stickyBarData.labelText=t}else this.stickyBarData.bubbleText="";this.$(".vf-rt-main-static").toggleClass("invisible",0===this.new_comments)},toggleStickyBar:function(){this.stickyBarData.visible=this.new_comments>0&&this.options.intersectionModel.isFullyInViewport()},remove:function(){var e=this.stickyBar.$el;e.parentNode.removeChild(e),this.stickyBar&&this.stickyBar.$destroy()}}),D=(i(31),i(34),i(80),i(542)),L={defaultError:"something_went_wrong",codes:{65540:"banned_from_posting",65541:"page_is_closed",65542:"anonymous_not_enabled",65543:"unverified_user_comment_limit",65544:"not_logged_in",65545:"email_already_verified",65554:"reload_comment",65555:"comment_content_same",131073:"flag_not_found",131074:"flag_login",131075:"flag_login_moderator",196609:"like_not_found",196610:"like_login",196611:"unlike_login",262151:"login_banned",327681:"user_update_email_in_use",327682:"user_update_password_required",327683:"user_update_picture_not_found",327684:"user_update_unrecognized_picture_format",458753:"signup_banned"},uploadCodes:{500:"something_went_wrong",400:"problem_uploading",401:"logged_in_to_upload",403:"your_account_banned",415:"cannot_process_upload"},codeToI18n:function(e,t){var i=[];if(this.codes.hasOwnProperty(e))switch(i.push(this.codes[e]),this.codes[e]){case"banned_from_posting":i.push(t&&t.reason||"")}else i.push(this.defaultError);return i},uploadStatusToI18n:function(e){return this.uploadCodes.hasOwnProperty(e)?this.uploadCodes[e]:this.defaultError}},U=i(481),B=i(482),V=i(597),j=i(143),z=(i(63),i(32),i(181),i(621)),K=O.a.Collection.extend({model:z.a,initialize:function(e,t){m.default.bindAll(this,"onAfterMediaComplete","onAdd"),this.restAPI=t.restAPI,this.section=t.section,this.media={},this.inProgress=new Set,this.on("add",this.onAdd),this.on("remove",this.onRemove),this.on("reset",this.onReset)},upload:function(e){var t=new z.a({restAPI:this.restAPI,file:e,type:"media",section:this.section});return this.add(t),t},unqueue:function(e){this.stopListening(e,"aftermedia error"),this.inProgress.delete(e),0===this.inProgress.size&&this.trigger("complete")},onAdd:function(e){this.inProgress.add(e),this.listenTo(e,"afterMedia",this.onAfterMediaComplete),this.listenTo(e,"error",this.onUploadError)},onRemove:function(e){delete this.media[e.get("progressId")],this.unqueue(e)},onReset:function(){this.media={},this.inProgress.forEach((function(e){this.stopListening(e)}),this),this.inProgress.clear()},onAfterMediaComplete:function(e,t,i){this.media[e.get("progressId")]=e,this.unqueue(i)},onUploadError:function(e,t){this.unqueue(t)},getIds:function(){return Object.values(this.media).filter((function(e){return e.get("id")||e.get("t")})).map((function(e){return e.get("id")||e.get("t").id}))},getIdsAsString:function(){return this.getIds().join(",")}}),Y=i(540),H=i(478),J={resendVerification:function(e){var t=this;e.preventDefault(),this.resetStatus(d()(".vf-resend-verification-status"));var i=this.$(".vf-resend-verification-status");i.attr("aria-hidden",!1).loader("show"),window.viafoura.$publish(s.C.CHANNEL,s.C.EVENTS.RESEND_EMAIL,null,{resend_verification:!0,success:function(){t.displayResendStatus("success",i)},error:function(e){var n=null;e.api_code&&(n=H.a.getInstance().translate(L.codeToI18n(e.api_code).shift())),t.displayResendStatus("error",i,n)}})},resetStatus:function(e){e.attr("aria-hidden",!0),e.find(".vf-moderation-status-icon").removeClass("vf-icon-success, vf-icon-error").addClass("hidden"),e.find("strong").text("")},displayResendStatus:function(e,t,i){setTimeout((function(){t.loader("hide"),t.find(".vf-moderation-status-icon").removeClass("hidden").addClass("vf-icon-".concat(e)),t.find("strong").text(i||H.a.getInstance().translate("resend_verification_".concat(e)))}),1e3)}},W=a.a.extend({templateName:"verification_message",render:function(){var e={};e.message=this.options.message,e.warning=this.options.warning||!1,e.info_type=this.options.infoType||"disabled",this.templateOnly(e)}}),q=a.a.extend(J).extend({templateName:"verification_status",className:"vf-email-verification",events:{"click .vf-open-modal-profile":"showEmailSettings","click .vf-resend-verification-email":"resendVerification"},initialize:function(e){m.default.bindAll(this,"showEmailSettings","resendVerification"),e.templateName&&(this.templateName=e.templateName),this.message=e.message,this.infoType=this.infoType},render:function(){var e=m.default.extend(this.model.toJSON(),this.options.data||{});e.message=this.message,e.domain=this.options.domain,e.type=this.type,e.infoType=this.infoType,e.isGuest=this.model.isGuest(),this.templateOnly(e),this.renderMessage()},showEmailSettings:function(e){e.preventDefault(),e.stopPropagation(),window.viafoura.$publish(s.A.CHANNEL,s.A.EVENTS.OPEN,e.target,"vf-settings")},hasLinks:function(){return"email"===this.type||"warning"===this.infoType&&("username"===this.type||"avatar"===this.type)},renderMessage:function(){var e=new W({message:this.message,infoType:this.infoType,hasLinks:this.hasLinks()});this.$(".vf-verification-status-message").replaceWith(e.el),e.render()}}),G=(i(109),i(466),a.a.extend({tagName:"ul",initialize:function(e){this.canView=e.canView,this.itemView=e.itemView||this.itemView,this.views=[],this.settings=e.settings||{},this.index=0,m.default.bindAll(this,"appendItem","prependItem","render"),this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"add",this.add),this.listenTo(this.collection,"sync",this.resetIndex),this.listenTo(this.collection,"remove",this.onRemove)},render:function(){return this.views=[],this.$el&&this.collection.length>=0&&(this.$el.empty(),this.collection.each(this.appendItem)),this},add:function(e,t,i){var n={prepend:this.prependItem,append:this.appendItem}[i.insert_method||"append"](e);n&&i.animate&&n.hide().slideDown()},onRemove:function(e){var t=this.views.findIndex((function(t){return t.model===e}));this.removeItem(this.views[t],t)},appendItem:function(e){if(!this.canView||this.canView(e)){var t=new this.itemView({model:e,settings:this.settings});return this.views.push(t),t.render().$el.appendTo(this.el)}},prependItem:function(e){if(!this.canView||this.canView(e)){var t=new this.itemView({model:e,settings:this.settings}),i=this.$el.children().eq(this.index);return this.views.splice(this.index,0,t),this.index+=1,t.render().$el.insertBefore(i)}},removeItem:function(e,t){this.views.splice(t,1),e.remove()},resetIndex:function(){this.index=0}})),Q=a.a.extend({templateName:"upload",initialize:function(){a.a.prototype.initialize.call(this,arguments),this.listenTo(this.model,"progress",this.updateProgress),this.listenTo(this.model,"done",this.updateProgress),this.listenTo(this.model,"media",this.attachMedia),this.listenTo(this.model,"error",this.uploadError)},events:{"click .js-progress-cancel":"cancelUpload"},render:function(){return this.templateOnly(this.model.toJSON()),this.$progress=this.$(".vf-progress"),this.$percent=this.$(".vf-progress-percent"),this.$error=this.$(".vf-js-error"),this},updateProgress:function(e){var t=e.state,i=0;"uploading"===t?i=Math.min(Math.floor(e.received/e.size*100),99):"done"===t&&(i=99),this.updateProgressBar("".concat(i,"%"),i,Boolean(i))},updateProgressBar:function(e,t,i){this.$el.toggle(i),this.$percent.text(e),this.$progress.css("width","".concat(t,"%"))},attachMedia:function(){this.stopListening(this.model),this.updateProgressBar("100%",100,!0)},cancelUpload:function(e){e.preventDefault(),this.$(".vf-error-box").empty(),this.model&&(this.model.cancel(),this.stopListening(this.model)),this.model.collection.remove(this.model)},uploadError:function(){this.$error.show(),this.$progress.addClass("vf-warning-bg-colour")}}),X=G.extend({itemView:Q}),Z=i(584),ee={validators:["non-empty","max-len"],validateComment:function(e,t,i){delete this.commentError;var n=Z.a.cleanString(e.get("content").replace(i,""));return"review"!==e.get("type")&&this.validators.includes("non-empty")&&""===n&&!e.hasMedia()?(this.commentError=this.i18n("verror_empty"),!1):!(this.validators.includes("max-len")&&n.length>t)||(this.commentError=this.i18n("verror_maxLength",t),!1)}},te={resizeTextarea:function(e){var t=e[0].offsetHeight,i=e[0].scrollHeight;i>t&&(e.parent().css({height:"".concat(i,"px")}),e.css({height:"".concat(i,"px")}))},resizeWithLimit:function(e,t,i){var n=e[0].scrollHeight;n>i?e.css({height:"".concat(i,"px"),overflow:"auto"}):(e.height(0),(n=e[0].scrollHeight)<t?e.css({height:"".concat(t,"px"),overflow:"hidden"}):e.css({height:"".concat(n,"px"),overflow:"hidden"}))}},ie={countCharacters:function(e,t,i,n,s){var o;if((o=g.a.supportCORS()||g.a.supportXDomain()&&!this.forceEncodeCount?e.length:encodeURIComponent(e).length)>=t){if(n.text(i-o).show(),o>i)return n.removeClass("char-near-limit").addClass("char-over-limit"),s.tipsy({template:"charcounter",title:"over-char-limit",gravity:"ne"}),!0;s.tipsy("remove"),o>=i-50?n.removeClass("char-over-limit").addClass("char-near-limit"):n.removeClass("char-near-limit char-over-limit")}else n.empty().hide(),s.tipsy("remove");return!1}},ne=i(105),se=i(433),oe=a.a.extend({getTemplateData:function(){},onSubmitError:function(){},onSubmitSuccess:function(){},onRender:function(){},processFormData:function(e){return e},mixins:[ie,ee,te],templateName:"comment_form",events:{submit:"submitForm","click .js-cancel":"onCancel","change .vf-attach":"uploadFile","keydown .vf-comment-textarea":"onTextChange","change .vf-comment-textarea":"onTextChange","input .vf-comment-textarea":"onTextChange","keyup .vf-comment-textarea":"onKeyUp","paste .vf-comment-textarea":"onPaste","textInput .vf-comment-textarea":"onTextChange","click .vf-comment-attach-wrapper":"onUploadMedia","keydown .vf-comment-attach-wrapper":"onUploadMediaKeyboard"},initialize:function(e){m.default.bindAll(this,"onCancel","onCommentSave","onCommentSaveError"),this.forceEncodeCount=P.b&&P.b<=9,this.user=p.a.current.user,this.settings=e.settings,this.forcedDisabled=!1,this.original_text=e.text||"",this.section=e.section,this.commentType=e.commentType,this.maxCharacters=this.settings.get("comment_max_length"),this.uploads=new K([],{restAPI:this.restAPI,section:this.section}),this.showCharacterCount=this.maxCharacters-100,this.commentLimitEnabled=1===this.domainSettings.get("enable_email_verification")||1===this.domainSettings.get("enable_username_premoderation"),this.views={},this.subviews={},this.listenTo(this.uploads,"complete",this.enableSubmit),this.listenTo(this.uploads,"remove",this.clearUploadInput),this.listenTo(this.user,"change:id",this.onUserLogin.bind(this)),this.listenTo(p.a.events,"/user/login/success",this.render.bind(this)),this.listenTo(this.user,"change:email_pending change:username_pending change:avatar_moderation_status",this.toggleModeration.bind(this)),this.listenTo(this.user,"change:comments_made",this.checkCommentLimit.bind(this)),this.$subscribe(s.C.CHANNEL,s.C.EVENTS.LOADED,this.render.bind(this))},render:function(){var e=p.a.current.settings.get("enable_comment_video")||p.a.current.settings.get("enable_comment_images");this.views.verification_status=new q({model:this.user,domain:this.locations.domain}),e&&(this.subviews.attachment_viewer=new X({collection:this.uploads}));var t=Object.assign({enable_file_attachment:e,hasVerification:this.domainSettings.get("enable_email_verification")||this.domainSettings.get("enable_username_premoderation")||this.domainSettings.get("enable_avatar_premoderation"),commentType:this.commentType||"comment"},this.getTemplateData());return this.templateOnly(t),this.$submitButton=this.$(".vf-js-comment-submit"),this.$attachWrapper=this.$(".vf-comment-attach-wrapper"),this.$attachInput=this.$(".vf-attach"),this.$textarea=this.$("textarea"),this.$textareaContainer=this.$(".vf-comment-textarea"),this.$loader=this.$(".vf-js-comment-submit-gif"),this.$textareaContainer.height(0),this.toggleModeration(),this.$textarea.val(this.original_text),this.onUserLogin(),this.clearUploads(),this.onRender(),this.revalidateTextarea(),this},revalidateTextarea:function(){this.$textarea.keyup()},onPaste:function(e){var t=this;setTimeout((function(){t.onTextChange(e)}),0),this.onCharacterChange(e)},onUserLogin:function(){var e=p.a.current.user.isLoggedIn();this.$(".vf-anonymous-menu").toggle(!e),this.$(".vf-image-file, .vf-video-file").toggle(e),this.removeMessages(),e?this.cacheRestore():(this.clearUploads(),this.cacheClear())},clear:function(){this.$textarea.val(""),this.$textarea.css("height",""),this.$textarea.parent().css("height",""),this.clearUploads()},clearUploads:function(){this.uploads.reset(),this.clearUploadInput(),this.enableSubmit()},clearUploadInput:function(){this.$(".vf-attach").val("")},onTextChange:function(e){this.cacheSave(this.$textarea),this.autoResizeTextContent(),"review"!==this.commentType&&(this.$submitButton[0].disabled=0===this.$textarea.val().length),e&&e.ctrlKey&&13===e.keyCode&&"keydown"===e.type&&!this.$submitButton[0].disabled&&this.submitForm(e)},autoResizeTextContent:function(){var e=this.$(".vf-content")[0],t=this.$(".vf-comment-textarea")[0];t.className.indexOf("vf-active")>=0&&0!==e.value.length?(e.style.height="".concat(e.scrollHeight,"px"),t.style.height=e.style.height):(e.style.height="auto",t.style.height="auto")},onKeyUp:function(e){this.onTextChange(e),this.onCharacterChange(e)},onCharacterChange:function(e){if(!this.submittingComment){var t=d()(e.target).val();this.countCharacters(t,this.showCharacterCount,this.maxCharacters,this.$(".vf-char-count"),this.$(".vf-tipsy-mask"))?this.disableSubmit(!0):0!==this.$textarea.val().length&&this.enableSubmit(!0)}},onUploadMediaKeyboard:function(e){13===e.keyCode&&this.onUploadMedia(e)},isCommentBoxOpen:function(){return this.$(".vf-comment-textarea").hasClass("vf-active")},onCancel:function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.$(".vf-content")[0].value="",this.toggleTextArea(!1),this.clearUploads(),this.trigger("cancel")},toggleTextArea:function(e){this.$(".vf-textarea-container").toggleClass("vf-active",e),this.$textareaContainer.toggleClass("vf-active",e),this.autoResizeTextContent(),this.revalidateTextarea()},getFormData:function(){var e={};return e.content=this.$textarea.val(),e.anonymous_name=this.$("[name=vf_anonymous_name]").val(),e.media_id=this.uploads.getIdsAsString()||void 0,e.parent_id=this.model.id,this.processFormData(e)},submitForm:function(e){e.preventDefault(),e.stopPropagation();var t=this.getFormData();t.content=Z.a.cleanString(t.content);var i=new Y.a(t);if(this.$(".vf-error-box").empty(),window.viafoura.$authorize("create","comment",[p.a.current.user.toJSON(),p.a.current.settings.toJSON(),i.toJSON()],{trigger:this.$(".vf-js-comment-submit"),action:se.e}))return this.validateComment(i,this.maxCharacters,this.original_text)?(this.$(".vf-error-message, .vf-char-count").empty(),p.a.current.user.isLoggedIn()?delete t.anonymous_name:p.a.current.user.set("name",t.anonymous_name),d.a.fn.loader.hideErrors(),this.$loader.loader("show",{gifType:"blue",inside:!0}),this.canSubmit&&(this.disableSubmit(),i.save(t,{success:this.onCommentSave,error:this.onCommentSaveError,xhr:!this.forceEncodeCount}),this.submittingComment=!0),this.cacheClear(),this):(this.displayError(this.commentError),this.cacheClear(),this)},onCommentSave:function(e){var t=this;this.clear(),this.enableSubmit();var i=new Y.a(e.result);i.triggerCreatedEvents(),this.trigger("comment:submitted",i),this.$loader.loader("hide"),this.submittingComment=!1,e.result.media.forEach((function(e){e.user=t.user.attributes})),window.viafoura.$publish("media","uploaded",e.result.media),this.user.set("comments_made",this.user.get("comments_made")+1),this.onSubmitSuccess()},onCommentSaveError:function(e){var t;if(this.enableSubmit(),this.submittingComment=!1,this.$loader.loader("hide"),e.http_status===j.UNAUTHORIZED&&0===e.api_code)t=this.i18n("session_expired");else{var i=Object(ne.a)(e),n=i.error_key,s=i.reason,o=i.endDate,a=i.isPermanent;t=this.i18n(n,s,new Date(o),a)}this.displayError(t),this.onSubmitError()},loginError:function(e){this.displayError(e)},uploadFile:function(e){this.disableSubmit(),this.uploads.upload(d()(e.target)).upload(),this.$attachWrapper.focus()},displayError:function(e){this.$(".vf-error-box").html(this.inlineError(e)),r.a.trigger("/commenting/resize")},displaySuccess:function(e){this.$(".vf-error-box").html(this.inlineSuccess(e))},disableSubmit:function(e){this.toggleSubmit(!1,e)},enableSubmit:function(e){this.toggleSubmit(!0,e)},toggleSubmit:function(e,t){!this.$submitButton||!1!==this.forcedDisabled&&!0!==t||(this.canSubmit=e,this.forcedDisabled=!e&&Boolean(t),this.$submitButton.attr("disabled",!e||null),this.$(".vf-tipsy-mask").toggle(!e))},onUploadMedia:function(e){window.viafoura.$authorize("upload","media",[p.a.current.user.toJSON(),p.a.current.settings.toJSON()],{trigger:e.currentTarget,action:se.f})||(e.preventDefault(),e.stopPropagation())},toggleModeration:function(){if(!this.user.isLoggedIn()||!this.user.hasUnverifiedEmail()&&!this.user.hasUnapprovedUsername()&&!this.user.hasUnapprovedAvatar())return this.$(".vf-verification-status").empty(),void this.closeComments(!1);this.initVerificationMessage(),this.renderVerificationMessage()},initVerificationMessage:function(){this.user.hasUnverifiedEmail()?this.initEmailVerificationMessage():this.user.hasUnapprovedUsername()?this.initUnapprovedUsernameMesssage():this.initAvatarModerationMessage()},initEmailVerificationMessage:function(){if(this.views.verification_status.type="email",this.views.verification_status.message=this.i18n("verify_email_post"),this.views.verification_status.tooltip=this.i18n("verification_required",this.user.get("email_pending")),this.views.verification_status.infoType="error",this.closeComments(!1),this.user.hasUpdatedEmail())return this.views.verification_status.tooltip=this.i18n("verify_email_update",this.user.get("email_pending")),void(this.views.verification_status.infoType="warning");this.user.isLoggedIn()&&!window.viafoura.$can("attempt_to_create","comment",this.user.toJSON())&&(this.views.verification_status.message=this.i18n("verify_email_post"),this.views.verification_status.infoType="warning",this.closeComments(!0))},initUnapprovedUsernameMesssage:function(){this.views.verification_status.type="username";var e=this.user.toJSON(),t=this.domainSettings.toJSON(),i=window.viafoura.$can("has_pending_username","user",e,t),n=window.viafoura.$can("has_new_username","user",e,t),s=window.viafoura.$can("has_rejected_username","user",e,t);i||n?(this.views.verification_status.message=this.i18n("user_name_awaiting_approval"),this.views.verification_status.tooltip=this.i18n("name_update_awaiting"),this.views.verification_status.infoType="warning"):s&&(this.views.verification_status.message=this.i18n("name_rejected"),this.views.verification_status.tooltip=this.user.get("name")?this.i18n("name_rejected_tip"):this.i18n("name_rejected_alert",this.user.get("username_pending")),this.views.verification_status.infoType="error")},initAvatarModerationMessage:function(){if(this.views.verification_status.type="avatar",this.user.hasPendingAvatar())return this.views.verification_status.message=this.i18n("avatar_pending_tip"),this.views.verification_status.tooltip=this.i18n("avatar_awaiting_approval"),void(this.views.verification_status.infoType="warning");this.views.verification_status.message=this.i18n("avatar_rejected"),this.views.verification_status.tooltip=this.i18n(this.user.get("pic_small")===this.user.defaults.pic_small?"avatar_rejected_default":"avatar_rejected_change"),this.views.verification_status.infoType="error"},renderVerificationMessage:function(){this.domainSettings.get("enable_email_verification")||this.domainSettings.get("enable_username_premoderation")||this.domainSettings.get("enable_avatar_premoderation")?this.insertSubViews(this.$el,{verification_status:this.views.verification_status}):(this.$(".vf-verification-status").replaceWith(this.views.verification_status.el),this.views.verification_status.render())},checkCommentLimit:function(){this.commentLimitEnabled&&this.toggleModeration()},closeComments:function(e){this.$("textarea").attr("disabled",e||null),e?this.disableSubmit(!0):this.enableSubmit(!0)}}),ae=oe.extend({initialize:function(){m.default.bindAll(this,"closeTextArea","openTextArea"),oe.prototype.initialize.apply(this,arguments),this.listenTo(r.a,"reply/open",this.openTextArea)},getTemplateData:function(){return{isReview:!1,isActive:!1,can_anonymously_post:p.a.current.settings.get("enable_anonymous_comments")&&p.a.current.user.canAnonymouslyPost()}},onRender:function(){var e;this.$textarea.focus(this.openTextArea);var t=function(t){var i=t.relatedTarget?0:200;e=setTimeout(function(){this.closeTextArea(t)}.bind(this),i)}.bind(this);this.$el.click(function(){clearTimeout(e),this.openTextArea()}.bind(this)),this.$el.focusout(t),this.$attachInput.click(this.openTextArea)},shouldStayFocused:function(e){if(0!==this.$textarea.val().length)return!0;var t=e&&e.relatedTarget||document.activeElement;return this.$el[0]===t||this.$el.find(t).length>0},openTextArea:function(){this.$textareaContainer.hasClass("vf-active")||this.toggleTextArea(!0)},closeTextArea:function(e){this.shouldStayFocused(e)||this.toggleTextArea(!1)},submitForm:function(e){if(e.preventDefault(),!this.isCommentBoxOpen())return this.openTextArea(),void this.$textarea[0].focus();oe.prototype.submitForm.apply(this,arguments)},onSubmitSuccess:function(){this.toggleTextArea(!1)},onUploadMedia:function(){this.openTextArea(),oe.prototype.onUploadMedia.apply(this,arguments)}}),re=a.a.extend({templateName:"reply_box",events:{"keyup .vf-content":"cacheComment"},initialize:function(e){this.section=e.section,this.user=e.user,this.page=e.page,this.comment=e.comment,this.settings=e.settings,this.prefix=e.prefix||"",this.text=e.text,this.views={avatar:new V.a({user:this.user,hasCommentBoxAvatar:e.hasCommentBoxAvatar||!1}),comment_form:new ae({section:this.section,model:this.page||this.comment,settings:this.settings,text:this.prefix,commentType:e.commentType})},this.listenTo(this.views.comment_form,"comment:submitted",this.commentSubmitted),this.listenTo(this.user,"change:name",this.onUsernameChange),this.listenTo(this.user,"change:username_pending",this.onUsernameChange)},toggle:function(e){this.$el.toggle(e)},onUsernameChange:function(){this.$username&&this.$username.text(this.user.getDisplayName(!0))},commentSubmitted:function(e){this.trigger("comment:submitted",e)},isCommentReply:function(){return Boolean(this.comment)},render:function(){var e=this;if(this.cacheSave(this.$("textarea")),this.subviews=this.views,this.templateOnly({name:p.a.current.user.getDisplayName(!0)}),this.text&&(this.$(".vf-content").val(this.text),this.text=!1,this.views.comment_form.revalidateTextarea()),p.a.current.user.isLoggedIn()?this.cacheRestore():(this.cacheClear(),this.$(".vf-content").val(this.prefix)),this.isCommentReply()){var t=this.$(".vf-content");this.views.comment_form.openTextArea(),setTimeout((function(){t.focus(),e.views.comment_form.toggleTextArea(!0)}),0)}return this.user.isGuest()&&this.$el.addClass("vf-is-anonymous"),this.$username=this.$(".vf-js-comment-form-name"),this},cacheComment:function(){this.comment&&r.a.trigger("/commenting/reply/save",this.$("textarea").val(),this.comment.id),this.cacheSave(this.$("textarea"))}}),le=a.a.extend({templateName:"comment_badge",render:function(){var e={};e.message=this.options.data.message,e.info_type=this.options.data.infoType||"disabled",e.needsGhost=this.options.data.needsGhost,this.templateOnly(e)}}),ce=i(851),he=i(46),ue=a.a.extend({templateName:"date",events:{"mouseover .vf-date":"initDateTooltip"},initialize:function(){this.initDateTooltip=this.initDateTooltip.bind(this),this.listenTo(this.model,"change:date_edited change:date_created",this.render.bind(this))},render:function(){this.$el.html(this.template(Object(he.b)(this.model.toJSON(),{time:this.getTimeString()})))},getTimeString:function(){if(this.model.get("date_edited")){var e=this.getRelativeTime(this.model.get("date_edited"));return" ".concat(this.i18n("post_edited",e))}return this.getRelativeTime(this.model.get("date_created"),this.domainSettings.currentTime())},initDateTooltip:function(){var e=H.a.getInstance().language,t=new Date(1e3*this.model.get("date_created")),i=t.toLocaleDateString(e,{month:"long",day:"numeric"}),n=t.toLocaleTimeString(e,{hour:"numeric",minute:"numeric",timeZoneName:"short"}),s=this.i18n("posted_on",i,n);this.$(".vf-date").css({cursor:"pointer"}).tipsy({title:s,gravity:"ne",interactive:!0,delayIn:1e3,delayOut:100,offset:0})}}),de=i(442),me=de.a.extend({url:"/bans"});function fe(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function pe(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var ge=a.a.extend({tagName:"ul",className:"vf-moderator-menu vf-comment-actions-list",templateName:"moderation",events:{"click .vf-spam-btn":"spamComment","click .vf-unspam-btn":"approveComment","click .vf-disable-btn":"disableComment","click .vf-approve-btn":"approveComment","click .vf-pick-btn":"pickComment","click .vf-unpick-btn":"unpickComment","click .vf-trust-btn":"trustUser","click .vf-untrust-btn":"untrustUser","click .vf-ban-btn":"banUser"},initialize:function(){m.default.bindAll(this,"onSuccess","onError"),this.user=this.model.user},render:function(){return this.$el.html(this.template({comment:this.model.toJSON(),user:this.user.toJSON()})),(this.user.isModOrAdmin()||this.user.isGuest())&&this.$(".vf-trust-btn, .vf-untrust-btn").remove(),this},performGenericModAction:function(e,t){e.preventDefault(),this.model.save(function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?fe(i,!0).forEach((function(t){pe(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):fe(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({},t,{source:"widgets"}),{error:this.onError})},spamComment:function(e){this.performGenericModAction(e,{status:"spam"})},approveComment:function(e){this.performGenericModAction(e,{status:"approved",date_edited:this.model.get("date_edited")})},disableComment:function(e){this.performGenericModAction(e,{status:"disabled"})},pickComment:function(e){this.performGenericModAction(e,{editor_pick:!0,date_edited:this.model.get("date_edited")})},unpickComment:function(e){this.performGenericModAction(e,{editor_pick:!1})},trustUser:function(e){e.preventDefault(),this.user.save({badge_trusted:!0,source:"widgets"},{success:this.onSuccess,error:this.onError})},onSuccess:function(){this.user.fetch({section:!1,success:function(e){return c.vuexStore.getInstance().dispatch(_.wc,{user:e.toJSON()})}})},onError:function(e){this.trigger("error",e)},untrustUser:function(e){e.preventDefault(),this.user.save({source:"widgets",badge_trusted:!1},{success:this.onSuccess,error:this.onError})},banUser:function(e){e.preventDefault(),(new me).save({user_id:this.user.attributes.id,type:"hide",source:"widgets"},{success:this.onSuccess,error:this.onError})}}),ve=i(579),be=i(616),we=a.a.extend({templateName:"comment_actions_menu",events:{"click .vf-more-actions-menu":"onMenuClick","click .vf-more-actions-btn":"toggleCommentActions","click .vf-subscribe":"follow","click .vf-flag":"flag","click .vf-share-btn":"toggleShareMenu","click .vf-hide-share-btn":"toggleShareMenu","click .vf-facebook-like":"trackFacebookLike","click .vf-twitter-tweet":"trackTwitterTweet","click .vf-email-icon":"trackEmailShare","blur .vf-comment-action:not(.invisible):last-child":"trapFocus","blur .vf-share-list-option:last-of-type":"trapFocus","keyup .vf-more-actions-menu":"closeOnEsc","keyup .vf-more-actions-btn":"closeOnEsc"},initialize:function(e){m.default.bindAll(this,"closeOnEsc","toggleCommentActions","fadeCommentActions","onFlagSuccess","onFlagError","onFollowSuccess","onFollowError","onMenuClick"),this.model=e.comment,this.page=e.page,this.templateData=e.templateData,this.dropdownIsOpen=!1},closeOnEsc:function(e){e.keyCode===be.KEY_ESCAPE&&this.dropdownIsOpen&&(this.toggleCommentActions(e),this.$(".vf-more-actions-btn").focus())},onMenuClick:function(e){e.stopPropagation()},render:function(){var e=this.model.toJSON();e.showFlag=this.templateData.showFlag,e.showFollow=window.viafoura.$can("see_follow","user",p.a.current.user.toJSON(),e.user,p.a.current.settings.toJSON()),e.isFlagged=this.flagged,this.templateOnly(e);var t="vf-more-actions-menu-".concat(e.id);this.$(".vf-more-actions-menu").attr("id",t),this.$(".vf-more-actions-btn").attr("aria-controls",t),window.viafoura.$can("moderate","comment",p.a.current.user.toJSON())&&this.showModeration()},trapFocus:function(e){var t,i=d()(e.currentTarget);if(i.find(".vf-share-btn").length>0&&this.$(".vf-share-list").hasClass("vf-slide-in"))e.preventDefault();else{if(i.hasClass("vf-comment-action")){var n=window.viafoura.$can("moderate","comment",p.a.current.user.toJSON()),s=i.parent().hasClass("vf-moderator-menu");if(n&&!s)return;t=this.$(".vf-more-actions-btn")[0]}else i.hasClass("vf-share-list-option")&&(t=this.$(".vf-hide-share-btn")[0]);e.preventDefault(),t.focus()}},toggleCommentActions:function(e){var t=this;e&&(e.stopPropagation(),this.ignoreToggleOnMobile(e))||(this.locked||(this.dropdownIsOpen=!this.dropdownIsOpen,this.locked=!0,this.$(".vf-more-actions-menu").toggle(this.dropdownIsOpen),requestAnimationFrame((function(){t.fadeCommentActions(!t.dropdownIsOpen),t.locked=!1}))))},fadeCommentActions:function(e){var t=this.$(".vf-more-actions-menu"),i=this.$(".vf-more-actions-btn");e&&(d()(".viafoura .vf-more-actions-menu.vf-show-dropdown").removeClass("vf-show-dropdown").attr("aria-hidden",!0),d()(".viafoura .vf-more-actions-btn").removeClass("active").attr({"aria-expanded":!1}),d()(".vf-share-btn").attr("aria-expanded",!1),d()(".vf-hide-share-btn").attr("aria-expanded",!1),d()(".vf-share-list").removeClass("vf-slide-in").attr("aria-hidden",!0)),t.toggleClass("vf-show-dropdown",!e).attr("aria-hidden",e),i.toggleClass("active",!e).attr("aria-expanded",!e);var n=e?this.i18n("more_btn"):this.i18n("hide_more_btn");this.$(".vf-more-actions-btn").attr("aria-label",n),document.removeEventListener("click",this.toggleCommentActions),e||document.addEventListener("click",this.toggleCommentActions),!t.hasClass("vf-show-dropdown")&&t.find(".vf-share-list").hasClass("vf-slide-in")&&this.toggleShareMenuAria(!1)},ignoreToggleOnMobile:function(e){return"mouseleave"===e.type&&this.$el.closest(".vf-comments").hasClass("vf-mobile")&&d()(e.currentTarget).hasClass("vf-more-actions-btn")&&d()(e.relatedTarget).closest(".vf-more-actions").length>0},toggleShareMenu:function(e){e.preventDefault(),this.toggleShareMenuAria(d()(e.currentTarget).hasClass("vf-share-btn"))},toggleShareMenuAria:function(e){this.$(".vf-share-btn").attr("aria-expanded",e),this.$(".vf-hide-share-btn").attr("aria-expanded",e),this.$(".vf-comment-actions-menu").toggleClass("vf-share-menu-min-height",e),this.$(".vf-share-list").toggleClass("vf-slide-in",e).attr("aria-hidden",!e),e?(this.$(".vf-hide-share-btn").removeAttr("tabIndex"),this.$(".vf-share-list-link").removeAttr("tabIndex")):(this.$(".vf-hide-share-btn").attr("tabIndex",-1),this.$(".vf-share-list-link").attr("tabIndex",-1));var t=e?this.$(".vf-hide-share-btn")[0]:this.$(".vf-share-btn")[0];this.$(".vf-more-actions-menu").hasClass("vf-show-dropdown")&&setTimeout((function(){t.focus()}),200)},showModeration:function(){this.moderation=new ge({model:this.model}),this.$(".vf-comment-actions-list").after(this.moderation.render().el),this.listenTo(this.moderation,"change:user",this.render),this.listenTo(this.moderation,"error",this.onModError),this.listenTo(this.moderation,"click",this.hideError)},trackFacebookLike:function(e){e.preventDefault(),e.stopPropagation();var t=this.model.shareLink(ve.a.FACEBOOK);this.openShareLink("http://www.facebook.com/sharer/sharer.php?u=".concat(t),"Facebook"),this.restAPI.request("post","analytics/shares",{provider:ve.a.FACEBOOK,id:this.model.id})},trackTwitterTweet:function(e){e.stopPropagation(),e.preventDefault();var t=this.model.shareLink(ve.a.TWITTER),i=encodeURIComponent(this.i18n("share_comment_cta"));this.openShareLink("https://twitter.com/intent/tweet?text=".concat(i,":%20").concat(t),"Twitter"),this.restAPI.request("post","analytics/shares",{provider:ve.a.TWITTER,id:this.model.id})},trackEmailShare:function(e){e.preventDefault();var t=this.model.shareLink(ve.a.EMAIL),i=encodeURIComponent(this.i18n("share_comment_cta")),n="mailto:?subject=".concat(i,"&body=").concat(i,":%20").concat(t),s=function(){window.location.href=n};this.restAPI.request("post","analytics/shares",{provider:"email",id:this.model.id},{success:s,error:s})},openShareLink:function(e,t){window.open(e,t,"status = 1, height = 350, width = 550, resizable = 0")},flag:function(e){e.preventDefault(),d()(e.target).hasClass("active")||!this.flagged&&window.viafoura.$authorize("flag","content",[p.a.current.user.toJSON(),p.a.current.settings.toJSON(),this.model.user.toJSON()],{action:se.c,trigger:this.$(".vf-more-actions-btn")[0]})&&(this.flagged=!0,this.restAPI.request("put","flags/".concat(this.model.id),{},{success:this.onFlagSuccess,error:this.onFlagError}),d.a.fn.loader.hideErrors(),this.$(".vf-flag .vf-comment-action-btn-text").loader("show",{position:"right"}))},onFlagSuccess:function(){this.$(".vf-flagged").addClass("vf-is-flagged").attr("aria-hidden",!1),this.$(".vf-flag .vf-comment-action-btn-text").loader("hide"),this.$(".vf-flag").addClass("active").attr("disabled",!0).find(".vf-comment-action-btn-text").text(this.i18n("flagged_lnk")),this.toggleCommentActions()},onFlagError:function(e){this.flagged=!1,this.$(".vf-flag .vf-comment-action-btn-text").loader("error",{position:"right"}).tipsy({title:L.codeToI18n(e.api_code)[0],interactive:!0,delayOut:300}),this.$(".vf-more-actions-menu").removeClass("vf-show-dropdown")},follow:function(e){e.preventDefault(),window.viafoura.$authorize("follow","user",[p.a.current.user.toJSON(),this.model.user.toJSON(),p.a.current.settings.toJSON()],{action:se.p,trigger:e.target})?(d.a.fn.loader.hideErrors(),this.$(".vf-subscribe .vf-comment-action-btn-text").loader("show",{gifType:"blue",position:"right"}).addClass("vf-loader-inverted vf-follow-loader"),this.model.user.toggleFollow(this.page.get("id")).then(this.onFollowSuccess.bind(this)).catch(this.onFollowError.bind(this))):d.a.fn.tipsy.revalidate()},onFollowSuccess:function(){var e=this.model.user.get("subscribed")?"unsubscribe_user_btn":"subscribe_user_btn";this.$(".vf-subscribe .vf-comment-action-btn-text").text(this.i18n(e)).loader("hide")},onFollowError:function(){this.$(".vf-subscribe .vf-comment-action-btn-text").loader("error",{position:"right"}).addClass("vf-error-inverted").tipsy({title:"something_went_wrong",interactive:!0})}}),_e=i(173),ye=a.a.extend({initialize:function(){m.default.bindAll(this,"timerComplete"),this.started=!1,this.timerIntervalShort=1e3,this.timerIntervalMedium=1e4,this.timerIntervalLong=6e4},renderTime:function(){var e=this.endTime-Math.floor(this.domainSettings.currentTime()/1e3),t=new Date(null);t.setSeconds(e);var i=t.toISOString().substr(14,5);this.$el.html(i)},start:function(e){this.endTime=e,this.stop(),this.started=!0,this.timerComplete()},stop:function(){this.started=!1},timerComplete:function(){if(!this.started)return!1;this.renderTime();var e=Object(_e.b)(this.endTime,this.domainSettings.currentTime());e>36e5?setTimeout(this.timerComplete,this.timerIntervalLong):e>9e5?setTimeout(this.timerComplete,this.timerIntervalMedium):e>0?setTimeout(this.timerComplete,this.timerIntervalShort):(this.finished=!0,this.trigger("finish"))}}),Ce=a.a.extend({templateName:"comment_user_actions",className:"vf-comment-user-actions",events:{"click .js-edit":"onEdit","click .js-remove":"onRemove"},confirmEvents:{"click .vf-yes":"onConfirmYes","click .vf-no":"onConfirmNo"},initialize:function(e){m.default.bindAll(this,"onRemoveSuccess","onRemoveError"),this.comment=e.comment,this.parent=e.parent,this.page=e.page,"review"!==this.comment.get("type")&&(this.countdown=new ye,this.listenTo(this.countdown,"finish",this.onCountFinish),this.comment.hasEditTimeLeft()&&this.countdown.start(this.comment.getEditTimeLeft()))},render:function(){var e={showTimer:"review"!==this.comment.get("type")&&this.comment.hasEditTimeLimit(),canUpdate:window.viafoura.$can("update","comment",p.a.current.user.toJSON(),p.a.current.settings.toJSON(),this.page.toJSON(),this.comment.toJSON(),p.a.current.settings.currentTime()),canRemove:window.viafoura.$can("remove","comment",p.a.current.user.toJSON(),p.a.current.settings.toJSON(),this.page.toJSON(),this.comment.toJSON(),p.a.current.settings.currentTime())};this.$el.html(this.template(e)),this.delegateEvents(),e.showTimer&&this.countdown&&(this.countdown.setElement(this.$(".vf-timer")),this.countdown.renderTime())},renderConfirm:function(){this.parent.$(".vf-comment-html").addClass("vf-remove-confirm"),this.$el.html(this.template(null,"comment_confirm_remove")),this.delegateEvents(this.confirmEvents)},onEdit:function(e){e.preventDefault(),this.trigger("edit")},onRemove:function(e){e.preventDefault(),this.renderConfirm()},onConfirmNo:function(e){e.preventDefault(),this.render(),this.parent.$(".vf-comment-html").removeClass("vf-remove-confirm"),this.delegateEvents()},onConfirmYes:function(e){e.preventDefault(),this.$(".vf-no").loader("show",{position:"right"}),this.comment.destroy({success:this.onRemoveSuccess,error:this.onRemoveError})},onRemoveError:function(e,t){var i=t.error||this.i18n("something_went_wrong");this.$(".vf-error-message").remove(),this.$el.append("<div class='vf-error-message'>".concat(i,"</div>")),this.parent.$(".vf-comment-html").removeClass("vf-remove-confirm"),this.$(".vf-no").loader("hide")},onRemoveSuccess:function(e,t){this.$(".vf-no").loader("hide"),this.parent.$(".vf-comment-html").removeClass("vf-remove-confirm"),e.media.length>0&&window.viafoura.$publish("media","deleted",e.media),this.comment.set("processing_status",t.result.processing_status),this.trigger("remove")},onCountFinish:function(){this.locked=!0,this.trigger("lock")},remove:function(){a.a.prototype.remove.call(this),delete this.parent,this.countdown&&this.countdown.stop()}}),Ee=i(660),Se=i(60),Te=i(11);var $e={};r.a.on("/commenting/reply/save",(function(e,t){$e[t]=e}));var ke={comment_status_disabled:"error",comment_status_removed:"disabled",comment_status_spam:"error",awaiting_moderation:"warning",verify_email_post:"warning",comment_status_awaiting_moderation:"warning",comment_status_banned:"warning"},Oe=a.a.extend({extendTemplateJSON:function(e){return e},templateName:"comment",mixins:[b.a,B.a],likeLocked:!1,wasEdited:!1,EditForm:void 0,events:{"click .vf-username":"openProfile","click .vf-like-btn":"like","click .vf-new-like-btn":"like","click .vf-dislike-btn":"dislike","click .vf-reply-btn":"reply","click .vf-flag":"flag","click .vf-show-more":"showMoreorLess","click .vf-rt-has-edit-link":"reload"},initialize:function(e){m.default.bindAll(this,"onLikeError","onLikeSuccess","onRefreshSuccess","realtimeNewCommentChange"),this.views={avatar:new V.a({user:this.model.user})},this.rollCounters={num_likes:{el:".vf-count-likes span",prop:"num_likes"},num_dislikes:{el:".vf-count-dislikes span",prop:"num_dislikes"}},this.closeDelay=500,this.show_more=!0,this.page=e.page,this.listenTo(this.model,"change:editor_pick",this.render),this.listenTo(this.model,"change:processing_status",this.render),this.listenTo(this.model,"change:content",this.contentChange),this.listenTo(this.model,"change:realtimeNewComment",this.realtimeNewCommentChange),this.listenTo(this.model,"change:date_edited",this.setOutdated),this.listenTo(this.model.parent(),"change:date_edited",this.setOutdated),this.listenTo(this.model.user,"change",this.render),this.listenTo(p.a.current.user,"change:id, change:email_verification_status",this.render),this.options.hasRealtime&&this.initRealtime(),this.afterInitialize()},afterInitialize:function(){},beforeRender:function(){},classes:{"vf-highlight-colour":function(e){return e.byCurrentUser&&!e.isReply&&"review"===e.type||e.isCurrentOwner},"vf-rt-has-edit":function(e){return e.wasEdited},"vf-rt-new":function(e){return e.realtimeNewComment},"vf-outdated":function(e){return e.isOutdated},"vf-comment-content":function(e){return e.alertStatus}},getClasses:function(e){var t=this,i=Object.keys(this.classes).filter((function(i){return t.classes[i](e)}));return e.alertStatus&&i.push("vf-".concat(e.alertStatus,"-comment-border")),i.join(" ")},getTitle:function(){return this.model.user.isModOrAdmin()?"moderator":window.viafoura.$can("trust","user",this.model.user.toJSON())?"trusted":""},render:function(){this.beforeRender();var e=this._templateJSON();e.title=this.getTitle(),e.title_desc_key="title_".concat(e.title,"_desc");var t=this.domainSettings.get("show_more_character_limit");this.renderUserActions(),e.classes=this.getClasses(e),this.templateOnly(e);var i=[];this.views.comment_actions=new we({comment:this.model,page:this.page,templateData:{showFlag:e.showFlag}});var n=this.model.media;n.total_count=n.length;var s=void 0!==this.views.gallery;this.views.gallery=new ce.a({user:e.user,collection:n,canUpload:!1}),s||this.listenToOnce(this.views.gallery,"emptyGallery",this.onEmptyGallery),this.createCommentBadge()&&i.push("verification_status"),this.$dateView=new ue({el:this.$(".vf-js-date"),model:this.model}),this.$dateView.render(),this.insertSubViews(this.$el,this.views,{disabledViews:i,isComment:!0}),this.model.user.isGuest()&&this.$el.addClass("vf-is-anonymous");var o=$e[this.model.id];if(void 0!==o&&this.renderReplyBox(o),e.user_privilege===Se.b.ADMIN&&(e.user_privilege=Se.b.MOD),this.model.isRemoved()&&(this.renderRemoved(),!this.currentUser.isModOrAdmin()))return this;this.renderTime(),this.liveRenderTime();var a=e.content.replace(/&#?[a-zA-Z0-9]+;/g,"#");a.length>t&&this.subStringLastWord(a,t).length!==a.length&&this.showMoreorLess();var l=this.$(".vf-ajax-loader-wrap");return l[0]&&l.loader("show",{inside:!0,gifType:"bluegray"}),this.initTipsy(),this.initializeAnimation(),r.a.trigger("/commenting/comment/render",this.model,this.$el[0]),r.a.trigger("/commenting/resize"),this},getLimitMsg:function(e,t){if(["disabled","removed","spam"].indexOf(t)>=0)return"comment_status_".concat(t);if(this.byCurrentUser()){var i=this.currentUser.hasUnverifiedEmail()&&!this.currentUser.has("email"),n=this.currentUser.hasUnapprovedUsername();if(i)return"verify_email_post";if(n&&!this.currentUser.get("name")||"awaiting_moderation"===t)return"comment_status_awaiting_moderation";if([Se.b.MOD,Se.b.ADMIN].includes(e.user.user_privilege)&&e.user.isBanned())return"comment_status_banned"}else if("awaiting_moderation"===t)return"comment_status_awaiting_moderation";return this.currentUser.isModOrAdmin()&&e.user.isBanned()?"comment_status_banned":null},createCommentBadge:function(){var e=this.model,t=e.get("processing_status"),i=this.getLimitMsg(e,t);if(i){var n=!this.views.comment_badge;if(n||this.views.comment_badge.options.data.messageKey===i||(delete this.views.comment_badge,n=!0),n){var s=ke[i],o="ghost"===this.model.user.get("ban_level")&&this.currentUser.isModOrAdmin()&&e.user.isBanned();this.views.comment_badge=new le({model:this.model.user,data:{infoType:s,needsGhost:o,messageKey:i,message:this.i18n(i)}})}return!1}return delete this.views.comment_badge,!0},byCurrentUser:function(){return this.currentUser.isLoggedIn()&&this.model.user.get("id")===this.currentUser.get("id")},setOutdated:function(){this.$el.toggleClass("vf-outdated",this.model.isOutdated()),this.$(".vf-js-outdated-message").toggle(this.model.isOutdated())},initTipsy:function(){var e=1===this.model.get("liked")?"unlike_tip":"like_tip",t=1===this.model.get("disliked")?"undislike_tip":"dislike_tip";if(!P.e){this.$el.find(".vf-new-like-btn").tipsy({title:e,delayIn:1e3}),this.$el.find(".vf-dislike-btn").tipsy({title:t,delayIn:1e3});var i=this.getTitle();i&&this.$el.find(".vf-user-title").tipsy({title:"title_".concat(i),delayIn:1e3})}},updateTipsyTitles:function(){var e=1===this.model.get("liked")?"unlike_tip":"like_tip",t=1===this.model.get("disliked")?"undislike_tip":"dislike_tip";this.$el.find(".vf-new-like-btn").tipsy("hide").tipsy("setTitle",e),this.$el.find(".vf-dislike-btn").tipsy("hide").tipsy("setTitle",t)},renderRemoved:function(){this.currentUser.isModOrAdmin()?this.$(".vf-comment-actions, .vf-flag").remove():(this.$(".vf-comment-html .vf-comment-html-content").empty(),this.$(".vf-comment-html").addClass("vf-comment-html-removed"),this.$(".vf-user-meta, .vf-comment-meta, .vf-comment-actions, .vf-flag, .vf-ajax-loader, .vf-media-container").remove(),this.$(".vf-avatar").css("background-image","url('".concat(this.currentUser.defaults.pic_small,"')"))),this.views.user_actions&&this.removeUserActions(),this.views.gallery&&this.removeGallery()},renderUserActions:function(){var e=window.viafoura.$can("update","comment",p.a.current.user.toJSON(),p.a.current.settings.toJSON(),this.page.toJSON(),this.model.toJSON()),t=window.viafoura.$can("remove","comment",p.a.current.user.toJSON(),p.a.current.settings.toJSON(),this.page.toJSON(),this.model.toJSON());e||t?void 0===this.views.user_actions&&(this.views.user_actions=new Ce({comment:this.model,page:this.page,parent:this}),this.listenTo(this.views.user_actions,"edit",this.startEdit),this.listenTo(this.views.user_actions,"lock",this.removeUserActions),this.listenTo(this.views.user_actions,"remove",this.onRemoved)):this.views.user_actions&&this.removeUserActions()},_templateJSON:function(){var e=this.model.toJSON();e.isOutdated=this.model.isOutdated();var t=this.model.get("page");return e.hideReply=t&&("closed"===t.status||1===this.domainSettings.get("legacy_comments_readonly")),this.model.isReply()&&(e.parentType=this.model.parent().getType()),e.showFlag=window.viafoura.$can("flag","content",p.a.current.user.toJSON(),p.a.current.settings.toJSON(),this.model.user.toJSON()),e.showTrusted=this.domainSettings.get("badging_trusted_display"),e.showMod=this.domainSettings.get("badging_moderator_display"),e.enableDislikes=1===this.domainSettings.get("enable_dislikes"),e.likeClass=1===this.model.get("liked")?"active":"",e.dislikeClass=1===this.model.get("disliked")?"active":"",e.byCurrentUser=this.byCurrentUser(),e.userCanModerate=window.viafoura.$can("moderate","comment",p.a.current.user.toJSON()),e.userPendingNew="pending_new"===p.a.current.user.get("username_verification_status"),e.wasEdited=this.wasEdited,e.current_page_id=p.a.current.page.id,e.email_unverified="pending_new"===p.a.current.user.get("email_verification_status")?1:0,e.isCurrentOwner=this.model.hasCurrentOwnerStatus(),e.user.name=this.model.user.getDisplayName(!1),e.moderatorIcon=Object(Ee.a)(this.i18n("badge_moderator")),e.alertStatus="","unverified"===e.user.verification_status?e.alertStatus="user-unverified":["disabled","removed","spam","awaiting_moderation"].includes(e.processing_status)?e.alertStatus=e.processing_status.replace(/_/g,"-"):this.currentUser.id===e.user.id&&[Se.b.MOD,Se.b.ADMIN].includes(e.user.user_privilege)&&e.user.ban_level!==Se.a.NONE&&(e.alertStatus="banned"),this.extendTemplateJSON(e)},renderTime:function(){this.$dateView||(this.$dateView=new ue({el:this.$(".js-date"),model:this.model})),this.$dateView.render()},liveRenderTime:function(){var e=this;setInterval((function(){return e.renderTime()}),3e4)},like:function(e){e.stopPropagation();var t=this.$(".vf-new-like-btn");this.likeAction(this.model.toggleLike.bind(this.model),t,se.d)},dislike:function(e){e.stopPropagation();var t=this.$(".vf-dislike-btn");this.likeAction(this.model.toggleDislike.bind(this.model),t,se.b)},likeAction:function(e,t,i){!this.likeLocked&&window.viafoura.$authorize("like","comment",[p.a.current.user.toJSON()],{trigger:t,action:i})&&(this.likeLocked=!0,d.a.fn.loader.hideErrors(),this.$(".vf-like-dislike-loader").loader("show"),e({success:this.onLikeSuccess,error:this.onLikeError}))},onLikeSuccess:function(){this.likeLocked=!1,this.$(".vf-like-dislike-loader").loader("hide"),this.updateTipsyTitles(),r.a.trigger("/commenting/comment/liked",this.model),Te.a.getInstance().$publish(s.d.CHANNEL,s.d.EVENTS.REACTION,this.model.toJSON()),this.likesChanged()},onLikeError:function(e){this.likeLocked=!1,this.$(".vf-like-dislike-loader").loader("error").tipsy({title:L.codeToI18n(e.api_code)[0],interactive:!0,delayOut:300}),this.likesChanged()},likesChanged:function(){var e=this.$el.find(".vf-like-btn").first(),t=this.model.get("liked");if(e.text(0===t?this.i18n("like_lnk"):this.i18n("unlike_lnk")),this.domainSettings.get("enable_dislikes")){var i=this.model.get("disliked");this.$el.find(".vf-dislike-text").first().text(0===i?this.i18n("dislike_lnk"):this.i18n("undislike_lnk")),this.$el.find(".vf-new-like-btn").toggleClass("active",1===t),this.$el.find(".vf-dislike-btn").toggleClass("active",1===i)}},reply:function(e){e.preventDefault(),e.stopPropagation(),this.renderReplyBox()},renderReplyBox:function(e){if(Boolean(this.replybox)&&!e)return this.closeReplyBox(),void this.$(".vf-reply-btn").removeClass("vf-active");this.$(".vf-reply-btn").addClass("vf-active");var t={comment:this.model,user:p.a.current.user,prefix:this.i18n("comment_reply_prefix",this.model.user.get("name")),text:e,settings:this.domainSettings};this.replybox=new re(t),this.listenTo(this.replybox,"comment:submitted",this.closeReplyBox),this.$el.after(this.replybox.render().el),this.isMobileReplyBox()&&r.a.trigger("reply/open",this.$el.find(".vf-comment-textarea"));var i=this.replybox.$(".vf-content")[0];i.selectionStart=i.selectionEnd=i.value.length,r.a.trigger("/commenting/resize"),this.replybox.$(".js-cancel").click(this.closeReplyBox.bind(this))},closeReplyBox:function(e){e&&e.preventDefault&&e.preventDefault(),this.replybox&&(delete $e[this.model.id],this.replybox.remove(),delete this.replybox,this.$(".vf-reply-btn").removeClass("vf-cancel-reply"),this.$(".vf-reply-btn-text").removeClass("vf-cancel-reply").text(this.i18n("reply_lnk")))},startEdit:function(){if(void 0===this.commentEditForm){this.closeReplyBox();var e={holder:this.$(".vf-comment-html .vf-comment-html-content"),model:this.model,section:p.a.locations.section};this.commentEditForm=new this.EditForm(e),this.commentEditForm.replaceHolder(),this.listenTo(this.commentEditForm,"finish",this.onEditFinish),this.$(".vf-comment-meta, .vf-comment-actions, .vf-comment-edit-links, .vf-comment-user-actions, .vf-was-edited").hide(),this.commentEditForm.render()}},removeView:function(e){this.stopListening(this.views[e]),this.views[e].remove(),delete this.views[e]},removeUserActions:function(){this.removeView("user_actions")},removeGallery:function(){this.removeView("gallery")},onRemoved:function(){this.renderRemoved()},onEmptyGallery:function(){this.model.fetch()},onEditFinish:function(e){this.commentEditForm.revertHolder(),this.commentEditForm.remove(),this.$(".vf-comment-meta, .vf-comment-actions, .vf-comment-edit-links, .vf-comment-user-actions, .vf-was-edited").show();var t=D.a.formatLinks(this.model.get("content"));this.$(".vf-comment-html .vf-comment-html-content").html(t),this.renderTime(),e&&e.media&&(this.views.gallery.collection.add(e.media,{user:new U.a(e.user)}),this.views.gallery.render()),this.stopListening(this.commentEditForm),delete this.commentEditForm},showMoreorLess:function(e){var t,i=this.model.toJSON(),n=this.$el.find(".vf-comment-html .vf-comment-html-content");if(e&&e.preventDefault){e.preventDefault();var s=e.target.dataset.action;this.show_more="more"!==s,n=d()(e.target.parentElement.parentElement)}var o=this.domainSettings.get("show_more_character_limit");t=this.show_more?this.subStringLastWord(i.content,o):i.content,t=D.a.formatLinks(t),n.html(t),this.$show_more=this.template({isShowMore:this.show_more},"show_more"),n.append(this.$show_more),r.a.trigger("/commenting/resize")},contentChange:function(e,t){this.$(".vf-comment-html .vf-comment-html-content").text(t)},openProfile:function(e){e.preventDefault(),e.stopPropagation(),this.model.user.get("id")&&window.viafoura.$publish(s.r.CHANNEL,s.r.EVENTS.SHOW,e&&e.currentTarget,this.model.user.toJSON())},remove:function(){a.a.prototype.remove.call(this)},showError:function(e){this.hideError(),this.$el.addClass("has-top-banner").prepend("<div class='vf-mod-error'>".concat(e,"</div>"))},hideError:function(){this.$el.removeClass("has-top-banner"),this.$(".vf-mod-error").remove()},onModError:function(e){var t;65554===e.api_code?(t=this.i18n("outdated_content"),this.model.fetch({success:this.onRefreshSuccess})):t=e.error||this.i18n("something_went_wrong"),this.showError(t)},onRefreshSuccess:function(){this.showError(this.i18n("outdated_content_updated"))},realtimeFilters:function(){var e,t,i,n=this.page.get("id"),s="".concat(n,":comment");return e={},t=s,i={event_type:["comment"],page_uuid:[g.a.toUuid(n)]},t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e},realtimeUpdate:function(e){if(!this.isSelf(e,p.a.current.user)&&e.comment_uuid&&e.comment_uuid===g.a.toUuid(this.model.id))switch(e.event_type){case"comment.enable":this.model.set("processing_status","completed"),this.render();break;case"comment.liked":this.model.set("num_likes",this.model.get("num_likes")+1);break;case"comment.disliked":this.model.set("num_dislikes",this.model.get("num_dislikes")+1);break;case"comment.unliked":this.model.set("num_likes",this.model.get("num_likes")-1);break;case"comment.undisliked":this.model.set("num_dislikes",this.model.get("num_dislikes")-1);break;case"comment.edit":this.wasEdited=!0,this.render();break;default:return}},realtimeNewCommentChange:function(e){this.$el.toggleClass("vf-rt-new",e.get("realtimeNewComment"))},reload:function(e){e.preventDefault(),this.listenToOnce(this.model,"sync",function(){this.wasEdited=!1,this.render()}.bind(this)),this.model.fetch()},isMobileReplyBox:function(){return this.$el.closest(".vf-comments").hasClass("vf-mobile")}}),xe=a.a.extend({mixins:[ie,ee,te],templateName:"comment_edit_form",className:"vf-comment-edit",events:{submit:"submit","click .js-cancel":"cancel","click .js-comment-edit-save":"submit","keydown .vf-comment-container textarea":"onTextChange","input .vf-comment-container textarea":"onTextChange","change .vf-attach":"uploadFile"},eventsForIE:{"click .js-cancel":"cancel","click .js-comment-edit-save":"submit","input .vf-comment-container textarea":"onIETextChange","keydown .vf-comment-container textarea":"onIETextChange"},initialize:function(e){m.default.bindAll(this,"onSuccess","onError"),this.addCountdown(),this.forceEncodeCount=P.b&&P.b<=9,this.$holder=e.holder,this.maxCharacters=this.domainSettings.get("comment_max_length"),this.showCharacterCount=this.maxCharacters-100,this.originalContent=this.model.get("content"),this.uploads=new K([],{restAPI:this.restAPI,section:e.section}),this.listenTo(this.uploads,"complete",this.save),this.listenTo(this.uploads,"remove",this.clearUploadInput)},addCountdown:function(){},showTimer:function(){return!1},render:function(){var e=P.b;0!==e&&e<=9&&this.delegateEvents(this.eventsForIE);var t=window.viafoura.$can("upload","media",p.a.current.user.toJSON(),p.a.current.settings.toJSON()),i={showTimer:this.showTimer(),comment:this.model.toJSON(),enable_file_attachment:t};this.$el.html(this.template(i)),t&&this.insertSubViews(this.$el,{attachment_viewer:new X({collection:this.uploads})}),this.$saveButton=this.$(".js-comment-edit-save"),this.$cancelButton=this.$(".vf-comment-edit-cancel"),this.$tipsyMask=this.$(".vf-tipsy-mask"),this.$("textarea").focus().trigger("input"),this.countdown&&(this.countdown.setElement(this.$(".vf-timer")),this.countdown.renderTime()),this.countdown&&this.countdown.finished&&this.onCountFinish(),this.revalidateTextarea()},revalidateTextarea:function(){this.$("textarea").keyup()},onTextChange:function(e){e&&e.ctrlKey&&13===e.keyCode&&"keydown"===e.type&&this.submit(e);var t=d()(e.target);this.resizeWithLimit(t,0,400),this.onCharactersChange(e)},onIETextChange:function(e){var t=d()(e.target);this.resizeTextarea(t),this.onCharactersChange(e)},replaceHolder:function(){this.$holder.replaceWith(this.$el)},revertHolder:function(){this.$el.replaceWith(this.$holder)},onCountFinish:function(){this.$(".vf-time-remaining-desc").empty(),this.$(".vf-timer").empty().text(this.i18n("timer_ended")),this.outOfTime=!0,this.disableSave(!0),this.$(".vf-tipsy-mask").tipsy({title:"timer_ended_tip"})},cancel:function(e){e&&e.preventDefault(),this.resetContent(),this.trigger("finish",{cancel:!0})},saveComment:function(){this.submittingComment=!0,this.disableSave(!0),this.$(".vf-error-message, .vf-char-count").empty(),this.$(".js-comment-edit-save").loader("show");var e=!this.forceEncodeCount;this.model.save(this.getCommentSaveData(),{xhr:e,success:this.onSuccess,error:this.onError})},getCommentSaveData:function(){var e={content:this.model.get("content")};return(e=this.addDataRating(e)).media_ids=this.uploads.length>0?this.uploads.getIds():void 0,e},addDataRating:function(e){return e},onSuccess:function(e){this.submittingComment=!1,this.$(".js-comment-edit-save").loader("hide");var t=e.result.media.map((function(t){return t.user=e.result.user,t}));this.enableSave(!0),this.trigger("finish",e.result),window.viafoura.$publish(s.d.CHANNEL,s.d.EVENTS.EDITED,this.model.toJSON()),window.viafoura.$publish("media","uploaded",t)},onError:function(e){this.submittingComment=!1,this.enableSave(!0),this.resetContent(),this.$(".js-comment-edit-save").loader("hide");var t=L.codeToI18n(e.api_code),i=this.i18n.apply(this,t);this.showError(i)},showError:function(e){this.$(".vf-error-box").html("<div class='vf-error-message'>".concat(e,"<div>"))},submit:function(e){e.preventDefault(),this.outOfTime||this.submittingComment||(this.model.set("content",Z.a.cleanString(this.$("textarea").val())),this.validateComment(this.model)?this.hasCommentChanged()?this.saveComment():this.cancel():(this.resetContent(),this.showError(this.commentError)))},onCharactersChange:function(e){if(!this.submittingComment&&!this.outOfTime){var t=d()(e.target).val();this.countCharacters(t,this.showCharacterCount,this.maxCharacters,this.$(".vf-char-count"),this.$tipsyMask)?this.disableSave(!0):0===this.$("textarea").val().length?this.disableSave(!0):this.enableSave(!0)}},disableSave:function(e){!this.$saveButton||!1!==this.forcedDisabled&&!0!==e||(this.save=!1,this.$saveButton.attr("disabled",!0),this.$tipsyMask.show(),this.forcedDisabled=Boolean(e))},enableSave:function(e){!this.$saveButton||!1!==this.forcedDisabled&&!0!==e||(this.save=!0,this.forcedDisabled=!1,this.$saveButton.removeAttr("disabled"),this.$tipsyMask.hide())},uploadFile:function(e){this.disableSave(),this.uploads.upload(d()(e.target)).upload(),this.$(".vf-comment-attach-wrapper").focus()},resetContent:function(){this.model.set({content:this.originalContent})},clearUploads:function(){this.uploads.reset(),this.clearUploadInput(),this.enableSubmit()},clearUploadInput:function(){this.$(".vf-attach").val("")},remove:function(){a.a.prototype.remove.call(this),this.countdown&&this.countdown.stop()}}),Ae=xe.extend({showTimer:function(){return this.model.hasEditTimeLimit()},addCountdown:function(){if(this.countdown=new ye,this.listenTo(this.countdown,"finish",this.onCountFinish),this.model.hasEditTimeLeft()){var e=this.model.getEditTimeLeft();this.countdown.start(e)}},hasCommentChanged:function(){return this.originalContent!==this.model.get("content")||this.uploads.length>0}});function Ne(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function Re(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Ie=Oe.extend({templateName:"comment",EditForm:Ae,extendTemplateJSON:function(e){return function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Ne(i,!0).forEach((function(t){Re(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ne(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({},e,{replyString:this.i18n("comment_reply_prefix",e.user.name)})}}),Me=i(585),Pe=i(835),Fe=xe.extend({initialize:function(){xe.prototype.initialize.apply(this,arguments),this.originalRating=this.model.getCommenterPageRating()},addDataRating:function(e){return e.rating=this.model.getCommenterPageRating(),e},hasCommentChanged:function(){return this.originalContent!==this.model.get("content")||this.uploads.length>0||this.originalRating!==this.model.getCommenterPageRating()},getOriginalRating:function(){return this.originalRating},resetContent:function(){this.model.set({content:this.originalContent,rating:this.originalRating})}}),De=i(1384),Le=i.n(De),Ue=i(480);i.n(Ue).a.templates.review=Le.a;var Be=Oe.extend({templateName:"review",EditForm:Fe,afterInitialize:function(){this.ratingModel=new de.a;var e=this.model.getCommenterPageRating();this.ratingModel.set("rating",e),this.byCurrentUser()?(this.views.comment_rating=new Pe.a({model:this.ratingModel,showMicroformat:!0}),this.listenTo(this.views.comment_rating,"rating",this.onRatingEdit),this.listenTo(r.a,"rating/requested",this.onRateRequest,this)):this.views.comment_rating=new Me.a({model:this.ratingModel,star_size:"small",showMicroformat:!0})},beforeRender:function(){var e=this.model.getCommenterPageRating();this.ratingModel.set("rating",e)},extendTemplateJSON:function(e){return e.hasRating=!0,e.formattedDate=this.formatDate(),e.truncatedDescription=this.truncateDescription(),e},formatDate:function(){return new Date(1e3*this.model.get("date_created")).toISOString()},truncateDescription:function(){var e=this.model.get("content");return e.length>200?"".concat(e.substring(0,197),"..."):e},onRatingEdit:function(e){this.startEdit(),this.commentEditForm.validators=["max-len"],this.model.setCommenterPageRating(e),this.views.comment_rating.setRating(e)},onEditFinish:function(e){var t=e.cancel?this.commentEditForm.originalRating:this.model.getCommenterPageRating();this.model.setCommenterPageRating(t),this.views.comment_rating.setRating(t),r.a.trigger("rating"),window.viafoura.$publish("rating","change"),Oe.prototype.onEditFinish.apply(this,arguments)},onRateRequest:function(e){this.model.isRemoved()||(this.onRatingEdit(e),d()(window).scrollTop(this.$el.offset().top))}}),Ve=i(164),je=(i(1385),a.a.extend({templateName:"discussion_ad",className:"vf-ad",render:function(){var e=this;if(this.$el.html(this.template({slotName:this.model.get("slotName")})),g.a.waitForElement((function(){return e.getElement()})).then((function(){return e.requestAd()})),window.googletag)try{this.createPubadsRenderedListener()}catch(e){}return this},getElement:function(){return d()("#".concat(this.model.get("slotName")))},requestAd:function(){window.viafoura.$publish(s.E.CHANNEL,s.E.EVENTS.REQUEST_COMMENT_AD,this.model.get("slotName"))},createPubadsRenderedListener:function(){window.googletag.pubads().addEventListener("slotRenderEnded",function(e){e.slot.getSlotElementId()===this.model.get("slotName")&&this.$el.addClass("active")}.bind(this))}})),ze=a.a.extend({templateName:"horizontal_list",initialize:function(e){this.views=[],this.view=e.view,this.canView=e.canView,this.type=e.type,this.page=e.page,this.classes=e.classes||""},render:function(){return this.templateOnly({classes:this.classes}),m.default.each(this.views,(function(e){e.remove()})),this.views=[],this.collection&&this.setCollection(this.collection),this.collection.each(function(e,t){if(!this.canView||this.canView(e)){this.handleAd(t,e,this.collection,{sync:!0});var i=new this.view({model:e,page:this.page,canView:this.canView,hasRealtime:this.options.hasRealtime});this.$el.append(i.render().$el),this.views.push(i)}}.bind(this)),this.trigger("render"),this},setCollection:function(e){this.collection&&this.stopListening(this.collection),this.collection=e,this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"add",this.onAddItem)},onAddItem:function(e,t,i){this.canView&&!this.canView(e)||(this.handleAd(t.indexOf(e),e,t,i),this.renderComment(e,t,i))},renderComment:function(e,t,i){var n=i.at,s=new this.view({model:e,page:this.page,canView:this.canView,hasRealtime:this.options.hasRealtime}).render();this.insertView(s,i),this.views.splice(n,0,s),this.trigger("add")},renderAd:function(e){var t=Object(Ve.b)("vf-adSlot-"),i=new je({model:new O.a.Model({slotName:t()})}).render();this.insertView(i,e)},shouldRenderAd:function(e,t,i){return i=i||{},t.has("addedInCurrentSession")?(i.prepend&&this.collection.commentsPosted++,!1):i.prepend?(this.collection.length-this.collection.commentsPosted-e)%this.collection.settings.limit==3:(e-this.collection.commentsPosted)%this.collection.settings.limit==3},handleAd:function(e,t,i,n){if(this.shouldRenderAd(e,t,n)){var s=Boolean(this.domainSettings.get("enable_ads"));s&&this.renderAd(n);var o={ads_enabled:s,index:e,total_count:i.total_count,limit:i.settings.limit,child_limit:i.settings.child_limit,thread_type:"replies"===this.type?"reply_thread":"main_thread"};window.viafoura.$publish("analytics","track_ad_load",{adData:o})}},insertView:function(e,t){var i=this,n=function(){(t=t||{}).prepend?i.$el.prepend(e.$el):0===t.at&&i.views.length>0?i.views[0].$el.before(e.$el):i.$el.append(e.el)};t.sync?n():requestAnimationFrame(n)},each:function(e,t){m.default.each(this.views,e,t)},clear:function(){this.collection.commentsPosted=0,this.each((function(e){e.remove()}))}});var Ke={comment:Ie,review:Be,default:Ie},Ye=a.a.extend({templateName:"comment_thread",mixins:[b.a,M],events:{"click .vf-replies-button":"loadReplies","click .vf-rt-reply":"loadRealtimeReplies","touchstart .vf-rt-reply":"touchstartReply","touchend .vf-rt-reply":"touchendReply"},initialize:function(e){m.default.bindAll(this,"afterLoad","rtAfterLoad","loadReplies","realtimeRenderNotification","updateLoadReplies"),this.new_replies=0,this.new_replies_counter_limit=9,this.views=[];var t=[];this.page=e.page,this.model.has("thread")&&(t=this.model.getThreadsAsc()),this.collection=this.model.replies(),this.collection.add(t),this.collection.before_id=m.default.result(m.default.last(t),"id"),this.collection.after_id=m.default.result(m.default.first(t),"id");var i=Ke[this.model.get("type")]||Ke.default;this.subviews={root_comment:new i({model:this.model,page:this.page,hasRealtime:e.hasRealtime}),replies:new ze({collection:this.collection,page:this.page,view:Ie,canView:e.canView,hasRealtime:e.hasRealtime,type:"replies"})},e.hasRealtime&&this.initRealtime()},findComment:function(e){return e(this)?this:this.findReply(e)},findReply:function(e){return m.default.find(this.subviews.replies.views,e)},render:function(){if(this.templateOnly(this.model.toJSON()),this.$load_replies=this.$(".vf-replies-button"),(!this.model.thread||this.model.thread.after_count<1)&&this.$load_replies.parent().addClass("hidden"),this.$rtReplyNote=this.$el.find(".vf-rt-reply"),this.$rtReplyNoteText=this.$el.find(".vf-rt-reply-text"),this.$rtReplyNoteCount=this.$el.find(".vf-rt-bubble-text"),this.listenTo(r.a,"/commenting/comment/reply",this.addReplies),P.e){var e=this.$el.find(".vf-rt-reply .vf-rt-hover-state");this.rt_reply={$el:e,heightDefault:e.height()}}return this},addReplies:function(e){return this.model.get("thread_id")===e.thread_id&&(e.addedInCurrentSession=!0,this.subviews.replies.collection.add(e,{slide:!0})),this},realtimeFilters:function(){var e,t,i,n=this.page.get("id"),s="".concat(n,":comment");return e={},t=s,i={event_type:["comment"],page_uuid:[g.a.toUuid(n)]},t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e},realtimeUpdate:function(e){if(e.thread_uuid===g.a.toUuid(this.model.get("thread_id")))switch(e.event_type){case"comment.enable":!this.isSelf(e,p.a.current.user)&&this.notYetLoaded(g.a.toVfId(e.comment_uuid))&&this.realtimeIncrement()}},notYetLoaded:function(e){return this.model.get("id")!==e&&!this.collection.isLoadedThread(e)},realtimeReset:function(){this.new_replies=0,this.realtimeRenderNotification()},realtimeIncrement:function(){this.$rtReplyNote.removeClass("invisible"),this.new_replies=this.new_replies+1,this.realtimeRenderNotification()},realtimeRenderNotification:function(){this.$rtReplyNote.toggleClass("invisible",0===this.new_replies),this.$rtReplyNoteText.html(this.i18n("comment_has_realtime_replies",this.new_replies,this.new_replies_counter_limit)),this.$rtReplyNoteCount.toggleClass("vf-rt-over-limit",this.new_replies>this.new_replies_counter_limit).html(this.new_replies<=this.new_replies_counter_limit?this.new_replies:"".concat(this.new_replies_counter_limit,"+")),this.rt_reply&&(this.rt_reply.heightOnHover=this.$rtReplyNote.height(),this.rt_reply.transition=this.$rtReplyNote.find(".vf-rt-hover-state").css("transition"))},updateLoadReplies:function(){this.collection&&this.collection.after_count&&this.collection.after_count>0?this.$load_replies.html(this.i18n("comment_has_replies",this.collection.after_count)).parent().removeClass("hidden"):this.$load_replies.parent().addClass("hidden")},loadRealtimeReplies:function(e){e.preventDefault();var t=this.collection.length>0?this.rtAfterLoad:this.afterLoad;r.a.trigger("threads:cleanRealtimeNew",this.model.get("thread_id"));var i=this.collection.settings&&this.collection.settings.limit?this.collection.settings.limit:10;this.collection.settings.limit=50,this.collection.fetchPageBefore({slide:!0,realtimeNewComment:!0,success:function(){r.a.trigger("/commenting/comment/rt-load-replies",this.model.page,this.model),t()}.bind(this)}),this.collection.settings.limit=i},loadReplies:function(e){e.preventDefault(),this.collection&&(this.collection.settings.limit=this.collection.length<=2?10-this.collection.length:10,this.collection.sortBy("oldest"),this.collection.fetchPageAfter({prepend:!0,slide:!0,success:function(){r.a.trigger("/commenting/comment/load-replies",this.model.page,this.model),this.updateLoadReplies()}.bind(this)}))},afterLoad:function(){this.updateLoadReplies(),this.rtAfterLoad()},rtAfterLoad:function(){this.new_replies=this.collection.before_count,this.realtimeRenderNotification()},closeReplies:function(){this.subviews.root_comment.closeReplyBox(),this.subviews.replies.each((function(e){e.closeReplyBox()}))},remove:function(){this.subviews.root_comment&&(this.subviews.root_comment.remove(),this.subviews.root_comment=null),a.a.prototype.remove.call(this)},touchstartReply:function(e){M.renderHoverStyles(e,this.rt_reply.$el,this.rt_reply.heightOnHover,this.rt_reply.transition)},touchendReply:function(e){M.removeHoverStyles(e,this.rt_reply.$el,this.rt_reply.heightDefault,this.rt_reply.reply_transition),this.loadRealtimeReplies(e)}}),He=(i(100),i(10),i(43)),Je={fetchShare:function(e){e=e||{},m.default.defaults(e,{id:Object(He.j)()});var t=e.id,i=e.type,n=e.page;return!t&&0!==t||t===e.avoid?Promise.reject():(this.model=new Y.a({id:t,page:n}),new Promise(function(e,t){this.model.getThread({success:function(s){if(0===s.length)return this.clearShare(),void t();var o=s.models[0];n&&o.page.id!==n.id?(this.clearShare(),t()):i&&o.has("type")&&o.get("type")!==i?(this.clearShare(),t()):e(s)}.bind(this),error:function(){t()}})}.bind(this)))},setShare:function(e){var t="";e&&(t="vf-".concat(e)),window.location.hash=""!==t?t:window.location.hash.split("vf-")[0]},clearShare:function(){this.setShare()}},We=(i(23),i(26),i(163));function qe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var i=[],n=!0,s=!1,o=void 0;try{for(var a,r=e[Symbol.iterator]();!(n=(a=r.next()).done)&&(i.push(a.value),!t||i.length!==t);n=!0);}catch(e){s=!0,o=e}finally{try{n||null==r.return||r.return()}finally{if(s)throw o}}return i}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Ge=O.a.Model.extend({defaults:{topHasLeftViewport:!1,isCommentingVisible:!1},initialize:function(){this.observers=[]},isFullyInViewport:function(){return this.get("isMiddleVisible")&&this.get("topHasLeftViewport")},observe:function(e,t){var i=this;Object(We.d)().then((function(){i.clearIntersectionObservers(),i.addTopExitObserver(e,"topHasLeftViewport"),i.addVisibleObserver(t,"isMiddleVisible")}))},addTopExitObserver:function(e,t){var i,n,s=this,o=(i=function(){return s.set(t,!0)},n=function(){return s.set(t,!1)},function(e){e.forEach((function(e){var t=e.isIntersecting,s=e.boundingClientRect,o=e.rootBounds;null!==o&&(t||function(e,t){return function(e,t){return e.left+e.width<=t.left}(e,t)||function(e,t){return e.right-e.width>=t.right}(e,t)}(s,o)?t&&n():i())}))});this.addIntersectionObserver(e,o)},addVisibleObserver:function(e,t){var i=this;this.addIntersectionObserver(e,(function(e){e.forEach((function(e){return i.set(t,e.isIntersecting)}))}))},addIntersectionObserver:function(e,t){var i=new IntersectionObserver(t,{root:null,threshold:0});i.observe(e),this.observers.push([i,e])},clearIntersectionObservers:function(){this.observers.forEach((function(e){var t=qe(e,2),i=t[0],n=t[1];i.unobserve(n)})),this.observers=[]}}),Qe=i(266),Xe=i(599);var Ze=a.a.extend({templateName:"commenting",mixins:[b.a],events:{"click .vf-load-more":"loadMoreComments","click .vf-show-all":"loadAllComments"},isEmpty:function(){},initialize:function(e){var t=this;m.default.bindAll(this,"onCommentsError","onCommentsSuccess","loadMoreComments","loadMoreSuccess","loadMoreError","canView","onWindowChange","loadNewComments","isLoadedThread","updateRealtimeCount","realtimeToggle","toggleNoCommentsMessage");var i=this.$el[0].dataset;this.toggleLoadingButtons=m.default.debounce(this.toggleLoadingButtons,1e3),this.realtimeIDs=[],this.numCommentsMade=0,this.isShare=!1,e.page_id?this.page=new o.a(c.vuexStore.getInstance().getters[n.nc]({uuid:Object(l.f)(e.page_id)})):this.page=this.currentPage,this.user=this.currentUser,this.section=e.section||p.a.locations.section,this.settings=this.domainSettings,this.$subscribe(s.F.CHANNEL,s.F.EVENTS.LOADED,(function(){t.hasNotificationBell||t.render()})),this.hasNotificationBell=this.shouldForceBell()||e.hasNotificationBell||this.hasNotificationBell||Object(Qe.a)()&&!Object(Qe.b)(),i.sort?this.sort=i.sort:"reviews"===this.type?this.sort=this.settings.get("review_sort"):this.sort=this.settings.get("commenting_sort"),this.intersectionModel=new Ge,this.listenTo(this.intersectionModel,"change:isMiddleVisible",this.onWindowChange),this.realtimeUID=".vf-rt-commenting-".concat(this.$el.data("widget-id")),this.pageSettings=new x({page:this.page});var a={};this.settings.get("comment_thread_replies")&&(a.child_limit=this.settings.get("comment_thread_replies")),this.collection=this.threads=this.page.threads(a),this.collection.settings.limit=i.limit||10,this.collection.sortBy(this.sort)||(console.warn("data-sort value is invalid (".concat(this.sort,")")),this.sort=this.collection.defaultSort);var h=this.hasRealtime();this.views={comments_options:new F({model:this.page,user:this.user,settings:this.settings,isShare:this.isShare,hasRealtime:h,hasNotificationBell:this.hasNotificationBell,sort:this.sort,widgetType:this.type,PageCountView:this.PageCountView,SortOptionsView:this.SortOptionsView,intersectionModel:this.intersectionModel}),comments:new ze({view:Ye,page:this.page,collection:this.collection,canView:this.canView,classes:"vf3-conversations-list ".concat(this.listClass),hasRealtime:h})},this.views.comment_box=new this.HeaderView({formId:i.formId,section:this.section,page:this.page,user:this.user,settings:this.settings,hasRealtime:h,hasCommentBoxAvatar:!0}),this.domainSettings.get("enable_anonymous_comments")&&this.$el.addClass("vf-enable-anonymous"),this.listenTo(this.page,"change:status",this.onStatusChange),this.listenTo(r.a,"/commenting/comment/created",this.addComment),this.listenTo(this.user,"change:id",this.userChanged),this.listenTo(this.views.comments_options,"change:sort",this.changeCommentSort),this.listenTo(this.views.comments_options,"fetch",this.loadNewComments),this.listenTo(this.views.comments_options,"visible",this.isLoadedThread),this.listenTo(this.views.comments_options,"new_rt_comment",this.addRealtimeID),this.listenTo(this.views.comments_options,"realtime-toggle",this.realtimeToggle),this.listenTo(r.a,"/commenting/reload",this.reloadComments),this.$subscribe(s.e.CHANNEL,s.e.EVENTS.RELOAD,this.reloadComments.bind(this)),this.render(),this.checkScrollDown(),this.listenTo(this.views.comments,"render add",this.toggleLoadingButtons),this.listenTo(this.views.comments,"render add",this.toggleNoCommentsMessage),this.unsubscribeRealtime(),this.initRealtime(),d()(window).on("hashchange",this.onHashChange.bind(this)),this.$publish(s.e.CHANNEL,s.e.EVENTS.LOADED,this.$el[0]),r.a.trigger("onWidgetLoad",this.$el[0],"onCommentingLoad"),r.a.trigger("/commenting/resize")},onIsOnScreen:function(){this.hasRealtime()&&(this.rtToggledOn=!0,this.listenTo(v.a,"rt-comment-throttler",this.handleThrottleEvent),v.a.subscribe({namespace:"rt-comment-throttler",interval:3e5}),this.realtimeToggle(this.rtToggledOn,!1)),this.runShareLoader()},onWindowChange:function(){var e=this.intersectionModel.get("isMiddleVisible"),t=Object(He.j)();(e||t)&&(this.onIsOnScreen(),this.stopListening(this.intersectionModel),e&&!t&&r.a.trigger("/commenting/page/load-thread",this.page))},runShareLoader:function(){Je.fetchShare({page:this.page}).then(this.showSharedComment.bind(this),this.showPageComments.bind(this))},hasRealtime:function(){var e;return(!this.page||"closed"!==(e=this.page.get("status"))&&"hidden"!==e)&&Boolean(this.settings.get("enable_realtime"))},canView:function(e){return!(!this.user.canAnonymouslyPost()||!e.has("user")||e.get("user").name!==this.user.get("name"))||("ghost"===e.user.get("ban_level")?this.user.isModOrAdmin()||e.get("user").id===this.user.id:e.has("user")&&e.get("user").id===this.user.id||this.user.isModOrAdmin()||"completed"===e.get("processing_status")||"removed"===e.get("processing_status"))},isLoadedThread:function(e,t){var i=this.collection.isLoadedThread(e);if(!t)return i;t(i)},getFetchData:function(){return{}},showPageComments:function(){var e=this;this.page.isHidden()||(d.a.fn.loader.hideErrors(),this.views.comments.$el.loader("show",{loaderSize:"large",block:!0,inside:!0}).addClass("vf-comment-sorting-loader"),this.collection=this.threads,this.views.comments.setCollection(this.collection),this.collection.fetchBeginning({data:this.getFetchData(),success:function(){e.views.comments_options.realtimeReset(),e.onCommentsSuccess()},error:this.onCommentsError}))},loadNewComments:function(){var e=this.collection,t=this;d.a.fn.loader.hideErrors(),this.views.comments.$el.loader("show",{loaderSize:"large",block:!0}).addClass("vf-comment-sorting-loader"),r.a.trigger("threads:cleanRealtimeNew"),e.multiFetch({realtimeNewComment:!0}).add(this.realtimeIDs).add("fetchPageBefore",{reverse:!0,data:this.getFetchData()}).success((function(i){i.sort(t.sortRealtimeResponses);for(var n=0,s=0;s<i.length;s++)n+=t.processModels(i[s],e);n>0&&e.trigger("sync"),t.updateRealtimeCount(n)})).error(this.onCommentsError)},processModels:function(e,t){var i=e.get("thread_id"),n=e.get("id"),s=0;if(i===n)t.isLoadedThread(n)||(s+=1,e.thread&&(s+=e.thread.length),e.set("addedInCurrentSession",!0),t.add(e,{at:0,prepend:!0}));else if(t.isLoadedThread(i)){var o=t.get(i).thread;o&&o.contains(e)||(s+=1,e.triggerCreatedEvents())}return s},sortRealtimeResponses:function(e,t){if(e.get("id")===t.get("id")){var i=e.get("thread")||{results:[]},n=t.get("thread")||{results:[]};return i.results.length<n.results.length?1:-1}if(e.get("id")!==e.get("thread_id")){if(t.get("id")===t.get("thread_id"))return 1}else if(t.get("id")!==t.get("thread_id"))return-1;return e.get("date_created")===t.get("date_created")?0:e.get("date_created")>t.get("date_created")?1:-1},showSharedComment:function(e){var t=Object(He.j)();this.isShare=!0,this.views.comments_options.isShare=this.isShare,this.views.comments_options.realtimeReset(),this.collection=e,this.views.comments.setCollection(this.collection),this.views.comments.render(),d()(window).scrollTop(this.$el.offset().top);var i=this.views.comments.views[0].findComment((function(e){return e.model.id===t}));i.$el.addClass("vf-comment-background-highlight"),setTimeout((function(){i.$el.removeClass("vf-comment-background-highlight")}),5e3)},shouldForceBell:function(){return"true"===this.$el[0].dataset.hasNotificationBell},render:function(){var e=Boolean(this.settings.get("viafoura_branding")),t=this.hasNotificationBell,i="reviews"===this.type?"Reviews":"Comments",n=Object(l.f)(p.a.current.section_tree.getId(this.section)),s=p.a.current.section_tree.get("section_uuid"),o=Boolean(this.domainSettings.get("legacy_comments_readonly")),a={hasBranding:e,hasNotificationBell:t,product:i,sectionUuid:n,rootSectionUuid:s,ariaLabel:this.i18n("aria_label_conversations_footer"),commentingClosed:this.page.isClosed()||o,hasCommentBox:this.page.canComment()&&!o,hasCommentOptions:!this.page.isHidden(),hasComments:!this.page.isHidden(),hasRealtime:this.hasRealtime(),hasEmailVerification:1===this.domainSettings.get("enable_email_verification"),hasCommentBoxAvatar:!0,customClass:this.customClass,isShare:this.isShare,canShowMore:this.canShowMore()};return this.$el.html(this.template(a)),this.insertSubViews(this.$el,this.views),this.showPageSettings(),this.$el.toggleClass("vf-is-logged-in",this.user.isLoggedIn()),this.$view_all_btn=this.$(".vf-show-all-con"),this.$show_more_btn=this.$(".vf-load-more-con"),this.toggleLoadingButtons(),this.trigger("windowChange"),this.observeIntersection(),e&&(this.branding=new f.default({store:c.vuexStore.getInstance(),el:this.$el[0].querySelector(".meta-mount"),components:{conversationsFooter:Xe.a}})),this.hasNotificationBell&&this.mountWidget(),this},mountWidget:function(){this.$publish(s.H.CHANNEL,s.H.EVENTS.MOUNT)},observeIntersection:function(){this.intersectionModel.observe(this.$el.find(".commenting--start-sticky-bar")[0],this.$el[0])},clearComments:function(){this.views.comments.clear(),this.$view_all_btn.hide(),this.$show_more_btn.hide()},toggleNoCommentsMessage:function(){if(this.isEmpty()){var e=this.i18n(this.empty_message_key),t="vf-no-messages";"editor-picks"===this.sort&&(e=this.i18n("no_comments_editors_pick"),t+=" vf-no-editors-picks"),this.views.comments.$el.html('<p class="'.concat(t,'"><span>').concat(e,"</span></p>"))}else this.views.comments.$(".vf-no-messages").remove();r.a.trigger("/commenting/resize")},canShowMore:function(){return!this.isShare&&Boolean(this.collection.after_count)},toggleLoadingButtons:function(){this.views.comment_box.toggle(!this.isShare),this.$view_all_btn.toggle(this.isShare),this.$show_more_btn.toggle(this.canShowMore()),this.$show_more_btn.children(".vf-error-message").remove(),this.$view_all_btn.children(".vf-error-message").remove()},changeCommentSort:function(e){this.sort=e,this.reloadComments()},reloadComments:function(){this.clearComments(),this.views.comments_options.realtimeReset(),this.collection.sortBy(this.sort),this.collection.fetchBeginning({data:this.getFetchData(),success:this.onCommentsSuccess,error:this.onCommentsError}),this.views.comments.$el.loader("show",{loaderSize:"large",block:!0,inside:!0}).addClass("vf-comment-sorting-loader")},onCommentsSuccess:function(){this.views.comments.$el.loader("hide"),this.$(".vf-horizontal-list").loader("hide")},onCommentsError:function(){this.$(".vf-horizontal-list").loader("hide");var e=this.i18n("something_went_wrong");this.$(".vf-horizontal-list").html("<div class='vf-error-message'>".concat(e,"</div>"))},addComment:function(e){this.page.id===e.parent_id&&(this.numCommentsMade+=1,this.page.trigger("comment-created",this.page)),this.afterAddComment(e)},afterAddComment:function(){},loadAllComments:function(e){var t=this;e.stopPropagation(),e.preventDefault(),Je.clearShare(),this.showPageComments(),this.isShare=!1,this.views.comments_options.isShare=!1,this.$view_all_btn.hide(),setTimeout((function(){t.$el[0].scrollIntoView({behavior:"smooth",block:"start",inline:"start"})}),0)},closeReplyBoxes:function(){this.views.comments.each((function(e){return e.closeReplies()}))},loadMoreComments:function(e){e.preventDefault(),this.$show_more_btn.children(".vf-error-message").remove(),this.$show_more_btn.hide(),this.$show_more_btn.loader("show",{loaderSize:"large",block:!0}),this.collection.fetchPageAfter({data:this.getFetchData(),success:this.loadMoreSuccess,error:this.loadMoreError})},loadMoreSuccess:function(){this.$show_more_btn.loader("hide"),r.a.trigger("/commenting/page/load-more",this.page)},loadMoreError:function(){this.$show_more_btn.show().loader("hide"),this.$show_more_btn.children(".vf-error-message").remove();var e=this.i18n("something_went_wrong");this.$show_more_btn.append("<div class='vf-error-message'>".concat(e,"</div>"))},showPageSettings:function(){this.user.isModOrAdmin()?(this.$(".vf-page-settings-container").empty().append(this.pageSettings.$el),this.pageSettings.render()):this.pageSettings.remove()},onStatusChange:function(){this.collection.before_count=0,this.render(),this.page.isClosed()&&this.closeReplyBoxes()},userChanged:function(){this.showPageSettings(),this.$el.toggleClass("vf-is-logged-in",this.user.isLoggedIn()),this.clearComments(),Je.fetchShare({page:this.page}).then(this.showSharedComment.bind(this),this.showPageComments.bind(this)),this.page.fetch({batch:!0})},onHashChange:function(){Object(He.j)()&&(r.a.trigger("/sharelink/show"),r.a.trigger("/modal/close"),this.clearComments(),Je.fetchShare({page:this.page}).then(this.showSharedComment.bind(this),this.showPageComments.bind(this)))},updateRealtimeCount:function(e){this.numCommentsMade=0,e=e>0?e:1/0,this.views.comments_options.realtimeIncrement(-e),this.onCommentsSuccess(),r.a.trigger("/commenting/page/rt-load-more",this.page)},realtimeIsOn:function(){return v.a.isActive("rt-comment-throttler")&&this.rtToggledOn},realtimeToggle:function(e,t,i){this.rtToggledOn=e,this.realtimeIsOn()?(this.subscribeRealtime(),t&&Je.fetchShare({page:this.page}).then(this.showSharedComment.bind(this),this.changeCommentSort("newest").bind(this)),this.isShare||!0!==i||this.getNewRTCommentCount()):this.unsubscribeRealtime()},getNewRTCommentCount:function(){var e=this;if(this.collection.before_id){var t=this.collection,i=m.default.clone(t.settings,!0),n=t.before_id;t.settings.limit=1,t.fetchPageBefore({add:!1,remove:!1,silent:!0,setCounts:!1,setBeforeAfterIDs:!1,success:function(t,i){var n=i.result.results.length,s=i.result.before_count-e.numCommentsMade+n;e.views.comments_options.realtimeReset(),e.views.comments_options.realtimeIncrement(s),e.onCommentsSuccess()}}),t.settings=i,t.before_id=n}},handleThrottleEvent:function(e){"active"!==e&&"inactive"!==e||this.realtimeToggle(this.rtToggledOn,!1,!0)},checkScrollDown:function(){if(window.location.hash.match(/^#vf-commenting-widget$/)){var e=d()(".vf-widget.vf-comments").first();if(e.length>0){var t=e.offset();d()(window).scrollTop(t.top)}}},realtimeFilters:function(){var e,t,i,n="".concat(this.page.id,":comment");return e={},t=n,i={event_type:["comment"],page_uuid:[g.a.toUuid(this.page.id)]},t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e},realtimeUpdate:function(e){if(!this.isShare&&"comment.enable"===e.event_type){var t=g.a.toVfId(e.comment_uuid);this.isSelf(e,this.currentUser)||e.comment_uuid!==e.thread_uuid||this.realtimeIDs.push(t)}},remove:function(){if(this.branding){var e=this.branding.$el;e.parentNode.removeChild(e),this.branding.$destroy()}this.intersectionModel.clearIntersectionObservers(),a.a.prototype.remove.call(this)}});var et=a.a.extend({lang_keys:{},templateName:"page_count",mixins:[b.a],events:{"click .vf-subscribe":"followPage"},initialize:function(e){m.default.bindAll(this,"onPageFollowError","onPageFollowSuccess","pageFollowChanged"),this.listenTo(this.model,"change:num_replies",this.render),this.listenTo(this.model,"comment-created",this.incrementCount),e.hasRealtime&&this.initRealtime(),this.listenTo(this.model,"change:subscribed",this.pageFollowChanged),this.displayCount=0,this.setDisplayCount()},setDisplayCount:function(){},incrementCount:function(){this.displayCount++,this.model.set("num_replies",this.model.get("num_replies")+1)},realtimeFilters:function(){var e,t,i,n=this.model.get("id"),s="".concat(n,":comment");return e={},t=s,i={event_type:["comment"],page_uuid:[g.a.toUuid(n)]},t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e},realtimeUpdate:function(e){"comment.enable"!==e.event_type||this.isSelf(e,p.a.current.user)||this.incrementCount()},followPage:function(e){e.preventDefault(),e.stopPropagation(),window.viafoura.$authorize("follow","page",[p.a.current.user.toJSON(),p.a.current.settings.toJSON()],{trigger:e.currentTarget,action:se.q})&&this.model.toggleFollow().then(this.onPageFollowSuccess.bind(this)).catch(this.onPageFollowError.bind(this))},pageFollowChanged:function(e,t){t?this.$subscribe.text(this.i18n("unsubscribe_btn")).attr("data-title","unsubscribe-page"):this.$subscribe.text(this.i18n("subscribe_btn")).attr("data-title","subscribe-page")},onPageFollowSuccess:function(){this.$subscribe.tipsy("hide"),this.$subscribe.loader("hide"),this.render(),this.$subscribe.focus()},onPageFollowError:function(){this.$subscribe.loader("error",{position:"right"}).tipsy({title:"something_went_wrong",interactive:!0}),this.$subscribe.focus()},threadIsClosed:function(){return"closed"===this.model.get("status")},render:function(){var e=this.model.toJSON();e.page_count=this.displayCount,e.page_count||(e.page_count=0),e.widgetType=this.options.widgetType,e.can_follow_thread=window.viafoura.$can("follow_thread","page",this.model.toJSON(),p.a.current.settings.toJSON()),e.lang_keys=this.lang_keys,this.templateOnly(e),this.$subscribe=this.$(".vf-subscribe")}}),tt=et.extend({lang_keys:{unsubscribe:"unsubscribe-page-comments",subscribe:"subscribe-page-comments"},setDisplayCount:function(){this.displayCount=this.model.get("num_replies"),this.model.total_count&&(this.displayCount=this.model.total_count)}}),it=i(622),nt=a.a.extend({templateName:"sort_options",mixins:[it.a],events:{"click .js-sort-option":"onSortOptionClick"},initialize:function(){m.default.bindAll(this,"onSortOptionClick","onOutsideSortOptionsClick","isSortOptionsActive")},render:function(){var e=this;this.templateOnly(),this.$sortOptions=this.$(".vf-sort-options"),this.$sortOptionsLabel=this.$(".js-other"),this.$sortOptionsIcon=this.$(".js-other-icon"),this.sorts.forEach((function(t){return e.$sortOptions.append(e.createSortOptionListItem(t))})),this.$sortOptionsLabel.click(this.onSortOptionsToggle.bind(this)),document.addEventListener("click",this.onOutsideSortOptionsClick),this.cycleSortOptionTabbing()},cycleSortOptionTabbing:function(){var e=this.$sortOptionsLabel[0],t=this.$sortOptions.find(".js-sort-option").last()[0];this.bindTabbingExplicitly(e,this.isSortOptionsActive,t,this.isSortOptionsActive)},onSortOptionClick:function(e){var t=e.target.getAttribute("data-value");this.$sortOptionsLabel.find(".js-other-text").text(this.i18n("".concat(t,"_sort"))),this.$sortOptions.toggleClass("vf-hidden"),this.$sortOptions.find(".vf-sort-option").removeClass("vf-active"),d()(e.target).closest(".vf-sort-option").addClass("vf-active"),this.$sortOptionsIcon.toggleClass("vf-active"),this.trigger("/sort/change",t)},isSortOptionsActive:function(){return this.$sortOptionsIcon.hasClass("vf-active")},closeSortOptions:function(){this.$sortOptions.addClass("vf-hidden"),this.$sortOptionsIcon.removeClass("vf-active")},openSortOptions:function(){this.$sortOptions.removeClass("vf-hidden"),this.$sortOptionsIcon.addClass("vf-active")},onOutsideSortOptionsClick:function(e){this.isSortOptionsActive()&&!d.a.contains(this.$sortOptions[0],e.target)&&this.closeSortOptions()},onSortOptionsToggle:function(e){e.preventDefault(),e.stopPropagation(),this.$sortOptionsIcon.hasClass("vf-active")?this.closeSortOptions():this.openSortOptions()},createSortOptionListItem:function(e){var t=document.createElement("li");return t.className="vf-sort-option",t.appendChild(this.createSortOptionButton(e)),t},createSortOptionButton:function(e){var t=document.createElement("button");return t.className="js-sort-option vf-label vf-label-upper",t.setAttribute("data-value",e),t.setAttribute("aria-label",this.i18n("".concat(e,"_sort_aria"))),t.textContent=this.i18n("".concat(e,"_sort")),t},remove:function(){document.removeEventListener("click",this.onOutsideSortOptionsClick),a.a.prototype.remove.call(this)}}),st=nt.extend({sorts:["oldest","likes","replies","activity","editor-picks"],initialize:function(){m.default.bindAll(this,"onSortOptionClick","onOutsideSortOptionsClick","isSortOptionsActive"),this.domainSettings.get("enable_custom_badge_sort")&&this.sorts.push("custom-badge")}}),ot=Ze.extend({type:"comments",customClass:"vf-comments-widget",listClass:"vf3-conversations-list--comments",empty_message_key:"no_comments",HeaderView:re,PageCountView:tt,SortOptionsView:st,afterAddComment:function(e){this.page.id===e.parent_id&&(e.addedInCurrentSession=!0,this.collection.add(e,{at:0,prepend:!0,slide:!0}))},isEmpty:function(){return this.collection.isEmpty()}}),at=a.a.extend({className:"pinned-review vf-horizontal-list",initialize:function(e){this.user=e.user||p.a.current.user,this.page=e.page||p.a.current.page,this.collection=this.page.threads({}),this.views={userReviewThread:new ze({view:Ye,page:this.page,collection:this.collection,canView:!1,hasRealtime:e.hasRealtime})}},fetchCollectionData:function(e){var t={type:"review",user_id:this.user.id};this.collection.fetchBeginning({data:t,success:e.success,error:e.error})},render:function(){this.$el.empty(),this.views.userReviewThread.render().$el.appendTo(this.el)}}),rt=(i(108),i(14)),lt=i(583),ct=i(167),ht=i(822),ut=i(301);function dt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var i=[],n=!0,s=!1,o=void 0;try{for(var a,r=e[Symbol.iterator]();!(n=(a=r.next()).done)&&(i.push(a.value),!t||i.length!==t);n=!0);}catch(e){s=!0,o=e}finally{try{n||null==r.return||r.return()}finally{if(s)throw o}}return i}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var mt={":id":"id",":section":"section",":page-uuid":"pageUuid"};var ft=O.a.View.extend({tagName:function(){return rt.e.REVIEW_FORM},initialize:function(e){Te.a.getInstance().install(this),this.user=p.a.current.user,this.id=e.formId||Object(ct.a)(),this.pageUuid=Object(l.f)(e.page.id),this.section=e.section,this.$subscribe(Object(ht.a)(this.id),lt.c,this.onReviewSaved.bind(this)),this.listenTo(r.a,"rating/requested",this.onRateRequest,this)},render:function(){if(!this.view){!this.originalEl&&this.options.formId&&(this.originalEl=document.getElementById(this.options.formId)),!this.options.formId||this.originalEl||this.view||(s=this.options.formId,window.console.error('VF Reviews: Could not locate element with id="'.concat(s,'"; falling back to loading review form inside the review widget.\n\n    Please ensure that the element with id="').concat(s,'" exists in the DOM before loading reviews.')));var e=this.getRenderTarget(),t=this.getRenderData();i=e,n=mt,Object.entries(n).forEach((function(e){var t=dt(e,2),n=t[0],s=t[1];i.setAttribute(n,s)})),this.renderInEl(e,t)}var i,n,s;this.originalEl||(this.el=this.view.$el)},getRenderData:function(){return{id:this.id,section:this.section,pageUuid:this.pageUuid}},getRenderTarget:function(){if(this.originalEl){var e=document.createElement(rt.e.REVIEW_FORM);return this.originalEl.parentNode.replaceChild(e,this.originalEl),e}return this.el},renderInEl:function(e,t){var i=c.vuexStore.getInstance();this.view=new f.default({el:e,data:t,store:i,components:{vfReviewForm:ut.a}})},remove:function(){if(this.view){var e=this.view.$el;this.originalEl?e.parentNode.replaceChild(this.originalEl,e):e.parentNode.removeChild(e),this.view.$destroy(),delete this.view,delete this.originalEl}},onReviewSaved:function(e){var t=this;this.trigger("comment:submitted",e),new Y.a(e).triggerCreatedEvents(),e.media.forEach((function(e){e.user=t.user.attributes})),window.viafoura.$publish("media","uploaded",e.media),this.user.set("comments_made",this.user.get("comments_made")+1),r.a.trigger("rating"),window.viafoura.$publish("rating","change")},onRateRequest:function(e){this.$publish(Object(ht.a)(this.id),lt.a,e)}}),pt=a.a.extend({initialize:function(e){m.default.bindAll(this,"onCommentCreated","onCollectionFetchSuccess","loadRateReviewBox","loadPinnedReview"),a.a.prototype.initialize.apply(this,arguments),this.page=e.page||p.a.current.page,this.user=e.user||p.a.current.user,this.views={pinnedReview:new at(e)},this.listenTo(this.user,"change:id",this.resetViews),this.listenTo(r.a,"/commenting/comment/created",this.onCommentCreated),this.loadRateReviewBox(),this.resetViews()},toggle:function(e){this.$el.toggle(e)},onCommentCreated:function(e){var t;(t=e).thread_id===t.id&&this.resetViews()},resetViews:function(){this.user.isLoggedIn()?this.views.pinnedReview.fetchCollectionData({success:this.onCollectionFetchSuccess,error:this.onCollectionFetchError}):(this.loadRateReviewBox(),this.render())},onCollectionFetchSuccess:function(e){e.models.length?this.loadPinnedReview():this.loadRateReviewBox(),this.render()},onCollectionFetchError:function(){this.loadRateReviewBox(),this.render()},loadRateReviewBox:function(){this.views.rateReviewBox||(this.views.rateReviewBox=new ft(this.options)),this.currentView=this.views.rateReviewBox},loadPinnedReview:function(){this.views.rateReviewBox&&(this.views.rateReviewBox.remove(),delete this.views.rateReviewBox),this.currentView=this.views.pinnedReview},render:function(){this.currentView.render(),this.$el.html(this.currentView.el)},isEmpty:function(){return!p.a.current.user.isLoggedIn()||this.views.pinnedReview.collection.isEmpty()}}),gt=et.extend({lang_keys:{unsubscribe:"unsubscribe-page-reviews",subscribe:"subscribe-page-reviews"},initialize:function(){m.default.bindAll(this,"onReviewFetchSuccess","onReviewFetchError"),et.prototype.initialize.apply(this,arguments)},setDisplayCount:function(){this.collection=this.model.threads(),this.collection.fetchBeginning({data:{type:"review"},success:this.onReviewFetchSuccess,error:this.onReviewFetchError})},onReviewFetchSuccess:function(){this.displayCount=this.collection.total_count,this.render()},onReviewFetchError:function(){this.displayCount=0,this.render()}}),vt=nt.extend({sorts:["oldest","likes","replies","activity","editor-picks","page-ratings-descending"]}),bt=Ze.extend({type:"reviews",customClass:"vf-reviews-widget",listClass:"vf3-conversations-list--reviews",empty_message_key:"no_reviews",HeaderView:pt,PageCountView:gt,SortOptionsView:vt,getFetchData:function(){return{type:"review",exclude_user_id:this.user.id}},afterAsyncInit:function(){this.listenTo(this.views.comment_box,"loaded",this.toggleNoCommentsMessage)},isEmpty:function(){return this.collection.isEmpty()&&this.views.comment_box.isEmpty()}}),wt=a.a.extend({templateName:"community",events:{"click .vf-next-btn":"nextPage","click .vf-prev-btn":"prevPage"},render:function(){this.$el.html(this.template(this.$el.data())),this.$el.find(".vf-data-container").append(this.view.el),this.renderUI()},renderUI:function(){if("cycle"===this.navigation){var e=this.collection,t=this.$(".vf-prev-btn"),i=this.$(".vf-next-btn");e.before_count||e.after_count?(t.toggleClass("vf-disable",!e.before_count),i.toggleClass("vf-disable",!e.after_count)):(t.hide(),i.hide())}},nextPage:function(e){e.preventDefault();var t=this.collection,i=t.settings;i.before_id&&delete i.before_id,t.after_count>0&&(i.after_id=t.at(t.length-1).id,t.fetch({reset:!0}))},prevPage:function(e){e.preventDefault();var t=this.collection,i=t.settings;i.after_id&&delete i.after_id,t.before_count>0&&(t.settings.before_id=t.at(0).id,t.fetch({reset:!0}))}}),_t=i(836),yt=a.a.extend({templateName:"comment_row",tagName:"li",className:"vf-item",events:{"click .vf-username":"showAccount"},initialize:function(){this.listenTo(this.model,"change",this.render),this.render()},render:function(){var e=this.getComment();return e.current_page_id=p.a.current.page.id,this.$el.html(this.template(e)),this.delegateEvents(),this.model.user.isGuest()&&this.$el.addClass("vf-is-anonymous"),this},getComment:function(){var e=this.model.toJSON();return e.timeAgo=this.getRelativeTime(e.date_created,this.domainSettings.currentTime()),e.video&&e.video.thumbs&&(e.video_placeholder=e.video.thumbs.medium),e.content&&e.content.replace(/&#?[a-zA-Z0-9]+;/g,"#").length>75&&(e.content="".concat(this.subStringLastWord(e.content,71)," ...")),e.picture&&(e.picture.s?e.imageURL=e.picture.s.url:e.picture.t&&(e.imageURL=e.picture.t.url)),e},showAccount:function(e){this.$publish(s.r.CHANNEL,s.r.EVENTS.SHOW,e.currentTarget,this.model.toJSON().user)}}),Ct=yt.extend({templateName:"popular",tagName:"div",className:"vf-community-comment",events:{"click .vf-user":"showAccount"},render:function(){var e=this.getComment();return e.current_page_id=p.a.current.page.id,this.$el.html(this.template(e)),this.delegateEvents(),this.model.user.isGuest()&&this.$el.addClass("vf-is-anonymous"),this},showAccount:function(e){this.$publish(s.r.CHANNEL,s.r.EVENTS.SHOW,e.currentTarget,this.model.toJSON().user)}}),Et=wt.extend({show:"top",initialize:function(e){var t=this.$el[0].dataset;this.collection=new _t.a,this.orientation=t.orientation||"vertical",this.collection.settings.section=null,void 0!==t.section&&(this.collection.settings.section=t.section),this.collection.settings.show=e.show||this.show,this.collection.settings.type=t.type||"comment",this.collection.settings.days=t.days||0;var i="";t.path?i=encodeURIComponent(this.parsePath(decodeURIComponent(t.path))):t.url&&(i=encodeURIComponent(Object(He.m)(decodeURIComponent(t.url)))),i&&(this.collection.rootUrl="/pages/".concat(i),"comment"===this.collection.settings.type&&(this.collection.settings.type="any")),t.navigation&&(this.navigation=t.navigation),this.cols=t.cols||1,this.rows=t.rows||t.limit||5,"horizontal"===t.orientation?this.collection.settings.limit=this.cols*this.rows:(this.collection.settings.limit=this.rows,this.view=new G({itemView:yt,collection:this.collection})),"editor_pick"===t.filter&&(this.collection.settings.show="editor-picks"),this.collection.fetch({batch:!0,reset:!0}),this.listenTo(this.collection,"reset",this.render)},render:function(){this.$el.html(this.template(this.$el[0].dataset)),this.$data_container=this.$el.find(".vf-data-container"),"horizontal"===this.orientation?this.renderHorizontal():this.$el.find(".vf-data-container").append(this.view.el),this.renderUI()},renderHorizontal:function(){var e,t=this;this.collection.each((function(i,n){n%t.cols==0&&(e=t.createRow());var s=new Ct({model:i}),o=d()(s.render().el);o.css({width:t.getColWidth()}),e.append(o),n%t.cols==0&&t.$data_container.append(e)}))},createRow:function(){var e=d()("<div />");return e.addClass("vf-community-widget vf-clearfix"),e},getColWidth:function(){this.$el.css({visibility:"hidden",display:"block"});var e=this.$data_container.width()/this.cols;return this.$el.removeAttr("style"),e}});t.default={CommentCount:h,CommentingView:ot,ReviewView:bt,CommunityComments:Et.extend({show:"recent"}),CommunityPopular:Et.extend({show:"top"})}},433:function(e,t,i){"use strict";i.d(t,"o",(function(){return n})),i.d(t,"e",(function(){return s})),i.d(t,"f",(function(){return o})),i.d(t,"d",(function(){return a})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return l})),i.d(t,"u",(function(){return c})),i.d(t,"v",(function(){return h})),i.d(t,"a",(function(){return u})),i.d(t,"s",(function(){return d})),i.d(t,"t",(function(){return m})),i.d(t,"q",(function(){return f})),i.d(t,"r",(function(){return p})),i.d(t,"p",(function(){return g})),i.d(t,"g",(function(){return v})),i.d(t,"i",(function(){return b})),i.d(t,"j",(function(){return w})),i.d(t,"h",(function(){return _})),i.d(t,"m",(function(){return y})),i.d(t,"k",(function(){return C})),i.d(t,"l",(function(){return E})),i.d(t,"n",(function(){return S}));var n="livestory_reply",s="comment_post",o="comment_upload_media",a="comment_like",r="comment_dislike",l="comment_flag",c="tray_community_click",h="tray_profile_click",u="avatar_follow_user",d="profile_follow_user",m="profile_mute_user",f="page_follow",p="page_rate",g="menu_follow_user",v="livechat_message",b="livechat_message_flag",w="livechat_message_like",_="livechat_message_dislike",y="livecomments_comment_like",C="livecomments_comment_disliked",E="livecomments_comment_flag",S="livecomments_follow"},438:function(e,t,i){"use strict";i.d(t,"c",(function(){return n})),i.d(t,"d",(function(){return o})),i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return r}));i(31),i(34),i(6),i(8),i(4),i(63),i(180);var n=Object.freeze({DEFAULT:"vf-feed",PROFILE:"vf-profile",COMMUNITY:"vf-community",SETTINGS:"vf-settings",ACCOUNT:"vf-account"}),s=Object.values(n);function o(e){return s.includes(e)}Object.freeze([n.DEFAULT,n.PROFILE,n.COMMUNITY,n.SETTINGS]);var a=100,r="vf-js-tray-activator"},447:function(e,t,i){},449:function(e,t,i){"use strict";i(86);var n=i(0),s=i(279),o=i(70),a=i(2),r=i(438),l=i(12),c=i(465);var h={props:{isClickable:{type:Boolean,default:!0},outline:{type:String,default:s.a.NONE},user:Object,size:String},computed:{currentUser:function(){return this.$store.getters[n.eb]},isAvatarClickable:function(){return this.isClickable&&o.b!==this.user.uuid},classes:function(){return e={},t=r.b,i=this.isAvatarClickable,t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e;var e,t,i},isCurrentUser:function(){return this.user.uuid===this.currentUser.uuid},alt:function(){return this.isClickable?this.isCurrentUser?Object(l.D)(this.currentUser)?this.$i18n("aria.images.open_profile"):this.$i18n("aria.images.avatar_login"):this.$i18n("aria.images.open_other_profile",{username:this.user.name}):this.isCurrentUser?this.$i18n("aria.images.avatar_current_user"):this.$i18n("aria.images.avatar_user",{username:this.user.name})}},methods:{onAvatarClick:function(e){var t=this,i=e.currentTarget;this.isAvatarClickable&&setTimeout((function(){return t.$publish(a.r.CHANNEL,a.r.EVENTS.SHOW,i,t.user)}))}},components:{vfAvatar:c.a}},u=(i(489),i(85)),d=Object(u.a)(h,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("vf-avatar",{staticClass:"vf-front-avatar",class:e.classes,attrs:{user:e.user,current_user_uuid:e.currentUser.uuid,size:e.size,"is-clickable":e.isClickable,"outline-palette":e.outline,alt:e.alt},nativeOn:{click:function(t){return e.onAvatarClick(t)}}})}),[],!1,null,"736c8ac4",null);t.a=d.exports},450:function(e,t,i){"use strict";i(23),i(26),i(13),i(10),i(6),i(8),i(4),i(108);var n=i(430),s=i(174);function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var i=[],n=!0,s=!1,o=void 0;try{for(var a,r=e[Symbol.iterator]();!(n=(a=r.next()).done)&&(i.push(a.value),!t||i.length!==t);n=!0);}catch(e){s=!0,o=e}finally{try{n||null==r.return||r.return()}finally{if(s)throw o}}return i}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}t.a={isSelf:function(e,t){try{if(t.isGuest()&&"1"===e.user_anonymous)return!0;if("awaiting_moderation"===e.status&&!t.isModOrAdmin())return!0;var i;switch(e.event_type){case"comment.liked":case"comment.unliked":case"comment.disliked":case"comment.undisliked":case"page.share":i="actor_uuid";break;default:i="user_uuid"}return Boolean(t&&e&&n.a.toUuid(t.id)===e[i])}catch(e){return!1}},initRealtime:function(){s.c.rtBind.call(this,this.realtimeUpdate.bind(this)),this.subscribeRealtime()},subscribeRealtime:function(){var e=this,t=this.realtimeFilters();return Object.entries(t).map((function(e){var t=o(e,2);return{filter_id:t[0],filter:t[1]}})).reduce((function(t,i){var n=i.filter_id,o=i.filter;return t.then(s.c.rtSubscribe.bind(e,o,n))}),Promise.resolve())},unsubscribeRealtime:function(){s.c.rtUnsubscribe.call(this)}}},458:function(e,t,i){},466:function(e,t,i){"use strict";var n=i(19),s=i(227)(6),o="findIndex",a=!0;o in[]&&Array(1)[o]((function(){a=!1})),n(n.P+n.F*a,"Array",{findIndex:function(e){return s(this,e,arguments.length>1?arguments[1]:void 0)}}),i(121)(o)},482:function(e,t,i){"use strict";i(87),i(6),i(8),i(63),i(23),i(4);var n=function(e){return e.toString(10)},s={initializeAnimation:function(){var e=this;this.rollerFormatter||(this.rollerFormatter=n),Object.values(this.rollCounters).forEach((function(t){t.$elCounter=e.$el.find(t.el),e.stopListening(e.model,"change:".concat(t.prop)),e.listenTo(e.model,"change:".concat(t.prop),e.simpleUpdate.bind(e,t.prop))}))},simpleUpdate:function(e){this.rollCounters[e].$elCounter.html(this.model.get(e))}};t.a=s},489:function(e,t,i){"use strict";var n=i(447);i.n(n).a},492:function(e,t,i){!function(t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var s,o=!1,a=void 0!==t;a&&t.getComputedStyle?(s=i.createElement("div"),["","-webkit-","-moz-","-ms-"].some((function(e){try{s.style.position=e+"sticky"}catch(e){}return""!=s.style.position}))&&(o=!0)):o=!0;var r=!1,l="undefined"!=typeof ShadowRoot,c={top:null,left:null},h=[];function u(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}function d(e){return parseFloat(e)||0}function m(e){for(var t=0;e;)t+=e.offsetTop,e=e.offsetParent;return t}var f=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!(t instanceof HTMLElement))throw new Error("First argument must be HTMLElement");if(h.some((function(e){return e._node===t})))throw new Error("Stickyfill is already applied to this node");this._node=t,this._stickyMode=null,this._active=!1,h.push(this),this.refresh()}return n(e,[{key:"refresh",value:function(){if(!o&&!this._removed){this._active&&this._deactivate();var e=this._node,n=getComputedStyle(e),s={position:n.position,top:n.top,display:n.display,marginTop:n.marginTop,marginBottom:n.marginBottom,marginLeft:n.marginLeft,marginRight:n.marginRight,cssFloat:n.cssFloat};if(!isNaN(parseFloat(s.top))&&"table-cell"!=s.display&&"none"!=s.display){this._active=!0;var a=e.style.position;"sticky"!=n.position&&"-webkit-sticky"!=n.position||(e.style.position="static");var r=e.parentNode,c=l&&r instanceof ShadowRoot?r.host:r,h=e.getBoundingClientRect(),f=c.getBoundingClientRect(),p=getComputedStyle(c);this._parent={node:c,styles:{position:c.style.position},offsetHeight:c.offsetHeight},this._offsetToWindow={left:h.left,right:i.documentElement.clientWidth-h.right},this._offsetToParent={top:h.top-f.top-d(p.borderTopWidth),left:h.left-f.left-d(p.borderLeftWidth),right:-h.right+f.right-d(p.borderRightWidth)},this._styles={position:a,top:e.style.top,bottom:e.style.bottom,left:e.style.left,right:e.style.right,width:e.style.width,marginTop:e.style.marginTop,marginLeft:e.style.marginLeft,marginRight:e.style.marginRight};var g=d(s.top);this._limits={start:h.top+t.pageYOffset-g,end:f.top+t.pageYOffset+c.offsetHeight-d(p.borderBottomWidth)-e.offsetHeight-g-d(s.marginBottom)};var v=p.position;"absolute"!=v&&"relative"!=v&&(c.style.position="relative"),this._recalcPosition();var b=this._clone={};b.node=i.createElement("div"),u(b.node.style,{width:h.right-h.left+"px",height:h.bottom-h.top+"px",marginTop:s.marginTop,marginBottom:s.marginBottom,marginLeft:s.marginLeft,marginRight:s.marginRight,cssFloat:s.cssFloat,padding:0,border:0,borderSpacing:0,fontSize:"1em",position:"static"}),r.insertBefore(b.node,e),b.docOffsetTop=m(b.node)}}}},{key:"_recalcPosition",value:function(){if(this._active&&!this._removed){var e=c.top<=this._limits.start?"start":c.top>=this._limits.end?"end":"middle";if(this._stickyMode!=e){switch(e){case"start":u(this._node.style,{position:"absolute",left:this._offsetToParent.left+"px",right:this._offsetToParent.right+"px",top:this._offsetToParent.top+"px",bottom:"auto",width:"auto",marginLeft:0,marginRight:0,marginTop:0});break;case"middle":u(this._node.style,{position:"fixed",left:this._offsetToWindow.left+"px",right:this._offsetToWindow.right+"px",top:this._styles.top,bottom:"auto",width:"auto",marginLeft:0,marginRight:0,marginTop:0});break;case"end":u(this._node.style,{position:"absolute",left:this._offsetToParent.left+"px",right:this._offsetToParent.right+"px",top:"auto",bottom:0,width:"auto",marginLeft:0,marginRight:0})}this._stickyMode=e}}}},{key:"_fastCheck",value:function(){this._active&&!this._removed&&(Math.abs(m(this._clone.node)-this._clone.docOffsetTop)>1||Math.abs(this._parent.node.offsetHeight-this._parent.offsetHeight)>1)&&this.refresh()}},{key:"_deactivate",value:function(){var e=this;this._active&&!this._removed&&(this._clone.node.parentNode.removeChild(this._clone.node),delete this._clone,u(this._node.style,this._styles),delete this._styles,h.some((function(t){return t!==e&&t._parent&&t._parent.node===e._parent.node}))||u(this._parent.node.style,this._parent.styles),delete this._parent,this._stickyMode=null,this._active=!1,delete this._offsetToWindow,delete this._offsetToParent,delete this._limits)}},{key:"remove",value:function(){var e=this;this._deactivate(),h.some((function(t,i){if(t._node===e._node)return h.splice(i,1),!0})),this._removed=!0}}]),e}(),p={stickies:h,Sticky:f,forceSticky:function(){o=!1,g(),this.refreshAll()},addOne:function(e){if(!(e instanceof HTMLElement)){if(!e.length||!e[0])return;e=e[0]}for(var t=0;t<h.length;t++)if(h[t]._node===e)return h[t];return new f(e)},add:function(e){if(e instanceof HTMLElement&&(e=[e]),e.length){for(var t=[],i=function(i){var n=e[i];return n instanceof HTMLElement?h.some((function(e){if(e._node===n)return t.push(e),!0}))?"continue":void t.push(new f(n)):(t.push(void 0),"continue")},n=0;n<e.length;n++)i(n);return t}},refreshAll:function(){h.forEach((function(e){return e.refresh()}))},removeOne:function(e){if(!(e instanceof HTMLElement)){if(!e.length||!e[0])return;e=e[0]}h.some((function(t){if(t._node===e)return t.remove(),!0}))},remove:function(e){if(e instanceof HTMLElement&&(e=[e]),e.length)for(var t=function(t){var i=e[t];h.some((function(e){if(e._node===i)return e.remove(),!0}))},i=0;i<e.length;i++)t(i)},removeAll:function(){for(;h.length;)h[0].remove()}};function g(){if(!r){r=!0,o(),t.addEventListener("scroll",o),t.addEventListener("resize",p.refreshAll),t.addEventListener("orientationchange",p.refreshAll);var e=void 0,n=void 0,s=void 0;"hidden"in i?(n="hidden",s="visibilitychange"):"webkitHidden"in i&&(n="webkitHidden",s="webkitvisibilitychange"),s?(i[n]||a(),i.addEventListener(s,(function(){i[n]?clearInterval(e):a()}))):a()}function o(){t.pageXOffset!=c.left?(c.top=t.pageYOffset,c.left=t.pageXOffset,p.refreshAll()):t.pageYOffset!=c.top&&(c.top=t.pageYOffset,c.left=t.pageXOffset,h.forEach((function(e){return e._recalcPosition()})))}function a(){e=setInterval((function(){h.forEach((function(e){return e._fastCheck()}))}),500)}}o||g(),e.exports?e.exports=p:a&&(t.Stickyfill=p)}(window,document)},507:function(e,t,i){},508:function(e,t,i){},510:function(e,t,i){},511:function(e,t,i){},541:function(e,t,i){},556:function(e,t,i){"use strict";i(31),i(34);var n,s=i(492),o=i.n(s),a=i(434),r=i(617),l=i(453),c=(i(6),i(8),i(4),i(63),i(221)),h={props:{enterDirection:{type:String,default:l.TOP,validator:function(e){return[l.TOP,l.BOTTOM].includes(e)}},transitionSpeed:{type:String,default:c.d.FAST,validator:function(e){return Object.values(c.d).includes(e)}}}},u=(i(731),i(85)),d=Object(u.a)(h,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"transition-wrapper"},[t("transition",{attrs:{name:"slide-in-out","enter-active-class":"slide-in-out-enter-active--"+this.transitionSpeed,"leave-active-class":"slide-in-out-leave-active--"+this.transitionSpeed,"enter-class":"slide-in-out-enter--"+this.enterDirection,"leave-to-class":"slide-in-out-leave-to--"+this.enterDirection}},[this._t("default")],2)],1)}),[],!1,null,"cf1d3914",null).exports,m=i(448);function f(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var p=(f(n={},l.TOP,"realtime-bar-button--at-top"),f(n,l.BOTTOM,"realtime-bar-button--at-bottom"),n),g={props:{labelText:{type:String,required:!1},showMainButton:{type:Boolean,default:!0,required:!1},showActionButton:{type:Boolean,default:!0,required:!1},actionText:{type:String,required:!1},actionDirection:{type:String,default:r.a.UP},palette:{type:String,default:a.a.ACCENT},location:{type:String,default:l.TOP,validator:function(e){return[l.BOTTOM,l.TOP].includes(e)}},isVisible:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1}},mounted:function(){this.location===l.TOP&&o.a.add(this.$el)},computed:{actionArrow:function(){return"&".concat(this.actionDirection,"arr;")},buttonClasses:function(){var e;return f(e={"realtime-bar-button":!0},p[this.location],!0),f(e,"realtime-bar-button--with-skip",this.showActionButton),e}},components:{slideInOutTransition:d,vfButton:m.a}},v=(i(732),Object(u.a)(g,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"realtime-bar vf-rt-stuck-link vf-rt-main-sticky",class:"realtime-bar--at-"+e.location},[i("slide-in-out-transition",{attrs:{"enter-direction":e.location}},[e.isVisible?i("div",{staticClass:"realtime-buttons-wrapper",class:{"realtime-buttons-wrapper--with-skip":e.showActionButton}},[e.showMainButton?i("vf-button",{staticClass:"realtime-main-button",class:e.buttonClasses,attrs:{size:"small",palette:e.palette,disabled:e.disabled,"is-cta":""},nativeOn:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.$emit("realtime-main-action")}}},[e._v("\n                "+e._s(e.labelText)+"\n            ")]):e._e(),e._v(" "),e.showActionButton?i("vf-button",{staticClass:"realtime-action-button",class:e.buttonClasses,attrs:{size:"small","is-cta":"",palette:e.palette},nativeOn:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.$emit("realtime-arrow-action")}}},[i("span",{staticClass:"realtime-action-button__label"},[e._v("\n                    "+e._s(e.actionText)+"\n                ")]),e._v(" "),i("span",{staticClass:"realtime-action-button__arrow",domProps:{innerHTML:e._s(e.actionArrow)}})]):e._e()],1):e._e()])],1)}),[],!1,null,"7d0c36f5",null));t.a=v.exports},575:function(e,t,i){"use strict";var n=i(458);i.n(n).a},579:function(e,t,i){"use strict";var n;function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.d(t,"a",(function(){return o}));var o={EMAIL:"email",FACEBOOK:"facebook",TWITTER:"twitter"};s(n={},o.EMAIL,"comment_share_email"),s(n,o.FACEBOOK,"comment_share_facebook"),s(n,o.TWITTER,"comment_share_twitter"),s(n,"DEFAULT","comment_share")},582:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n=i(150),s=i.n(n),o=i(16),a=function(){return"media"};function r(e,t,i){return t=t||function(){},Object(o.c)().post(a(),e,{onUploadProgress:t,cancelToken:i})}function l(e,t){var i=s.a.CancelToken.source();return[r(e,t,i.token),i.cancel]}},583:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return s})),i.d(t,"a",(function(){return o}));var n="review",s="submitted",o="rate-requested"},584:function(e,t,i){"use strict";i(80);t.a={cleanString:function(e){return e&&"string"==typeof e?this.condense(e.trim()):""},condense:function(e){return e.replace(/\n\s*\n/g,"\n\n")}}},585:function(e,t,i){"use strict";i(278);var n=i(429),s=i.n(n),o=i(424),a=i(430),r=i(426),l=i(161),c=i(43),h=r.a.extend({templateName:"rating_stars",initialize:function(){o.default.bindAll(this,"render","setRating"),this.listenTo(this.model,"change:rating",this.setRating),this.options.star_size=this.options.star_size||"medium",this.options.showMicroformat=this.options.showMicroformat||!1},render:function(){var e=this.model.toJSON();e.star_size=this.options.star_size,e.showMicroformat=this.options.showMicroformat;var t=this.template(e);return this.$stars=s()(".vf-icon-star",t),s.a.each(this.$stars,(function(e,t){return t.setAttribute("data-value",e+1)})),this.setRating(),this.$el.replaceWith(t),this.setElement(t),this},setRating:function(){var e=this.model.toJSON(),t=Math.round(e.rating),i=0===t?t:a.a.clamp(t,1,5);s.a.each(this.$stars,(function(e,t){a.a.addClassToSVG(t,"vf-star-filled-in"),e>=i&&a.a.removeClassFromSVG(t,"vf-star-filled-in")}))},fetchNewPage:function(e){var t=e.path,i=e.url;return t?Object(l.c)({path:this.parsePath(t)}):Object(l.c)({url:Object(c.m)(i)})}});t.a=h},594:function(e,t,i){"use strict";i(23),i(4);var n=i(0),s={},o=(i(728),i(85)),a={props:["sectionUuid","rootSectionUuid","product"],computed:{vfLink:function(){var e=this.$store.getters[n.zc],t="".concat(e.protocol,"//").concat(e.domain),i=new URL("https://viafoura.com");return i.searchParams.append("pt","Engagement"),i.searchParams.append("pr",this.product),i.searchParams.append("vfsid",this.sectionUuid),i.searchParams.append("vfrsid",this.rootSectionUuid),i.searchParams.append("vfdom",t),i.toString()}},components:{vfLogo:Object(o.a)(s,(function(){var e=this.$createElement,t=this._self._c||e;return t("svg",{staticClass:"vf-logo",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 300 60"}},[t("path",{staticClass:"viafoura-logo__logo",attrs:{d:"M33.6 1.1a29 29 0 1 0 0 58 29 29 0 0 0 0-58zm5.2 39.8l-4.5 7.7a1 1 0 0 1-.9.5c-.3 0-.7-.2-.9-.5L15.7 19.2a1 1 0 0 1 0-1c.2-.3.5-.5.9-.5h8.9c.3 0 .7.2.9.5l12.4 21.7c.3.3.3.7 0 1zm7.3-12.6L41.6 36a1 1 0 0 1-.9.5c-.3 0-.7-.2-.9-.5l-9.6-16.8a1 1 0 0 1 0-1c.2-.3.5-.5.9-.5H40c.3 0 .7.2.9.5l5.2 9.1c.2.3.2.6 0 1zm5.2-9.1l-2.4 4.2a1 1 0 0 1-.9.5 1 1 0 0 1-.9-.5l-2.3-4.2a1 1 0 0 1 0-1c.2-.3.5-.5.9-.5h4.9c.3 0 .7.2.9.5 0 .4 0 .7-.2 1zM89.6 49.1L78 17.7h8.9l6 20.4.1.5h1.2l.1-.5 5.9-20.4h8.7L97.1 49.1zM115.8 49.1v-22l.7-3.4h-4.8l3.2-6h8.5v31.4zM143.2 49.7c-2.1 0-4-.1-5.8-.6-1.7-.4-3.1-.9-4.3-1.8-1.1-.7-2-1.9-2.6-3.1-.6-1.3-.9-2.9-.9-4.9 0-1.9.4-3.5 1.2-4.6a7.5 7.5 0 0 1 3.1-3c1.3-.7 2.7-1.3 4.3-1.6 1.6-.4 3.3-.5 5-.5h1.3l1.9.1 1 .1v-1.1c-.1-2.6-1.3-3.7-2.4-4.2-1.3-.5-2.9-.8-4.9-.8-1 0-2.2.1-3.6.4-1 .1-2.1.4-3.2.7l-.7-2.5-.5-2-.2-1.1c1.8-.6 3.4-.9 5-1.3 1.9-.4 3.5-.4 5-.4 4.3 0 7.5 1 9.7 3s3.3 5.2 3.3 9.5v17.9L150 49c-2.1.4-4.4.7-6.8.7zm.5-15.4c-1.9 0-3.6.4-4.9.9-1.4.7-2.2 2-2.2 3.8 0 1.1.2 2 .8 2.7a4 4 0 0 0 1.9 1.3l2.2.5 1.8.1c.9 0 1.9-.1 3-.4l.7-.1v-8.5l-.7-.1-1.4-.1-1.2-.1zM163.4 49.1V23.7h-4.3v-6h4.3v-2c0-1.9.5-2.9 1.1-4.3a12 12 0 0 1 11.3-6.3l3.1.2 2.3.6c-.6.9-1.7 2.5-3.1 5.1h-1c-1.6 0-3.1.4-4 1-1.1.7-1.9 2-1.9 3.7v2h8.1l-3.2 5.9h-4.9v25.6h-7.8zM194.5 49.5c-2.1 0-4.2-.2-5.9-.8a11.5 11.5 0 0 1-7.5-7.6c-.7-2-1.1-4.6-1.1-7.5s.4-5.3 1.1-7.4a12.1 12.1 0 0 1 7.6-7.7 18 18 0 0 1 5.8-.9c2.1 0 4 .2 5.8.8 1.8.6 3.3 1.4 4.5 2.7 1.3 1.3 2.3 2.9 3 4.9.7 2 1.1 4.6 1.1 7.5 0 3-.4 5.5-1.1 7.5a11.5 11.5 0 0 1-7.5 7.6c-1.7.6-3.7.9-5.8.9zm0-25.8c-2.2 0-4 .7-5.3 2.4-1.3 1.5-1.9 4-1.9 7.4 0 3.6.6 5.9 1.9 7.5a6.7 6.7 0 0 0 5.3 2.3c2.2 0 4-.7 5.3-2.3 1.3-1.5 1.9-3.9 1.9-7.5s-.6-5.9-1.9-7.5a6.4 6.4 0 0 0-5.3-2.3zM229.5 49.5c-2.1 0-4.2-.1-6.1-.5-1.8-.4-3.4-1-4.8-1.9-1.3-1-2.7-2.5-3.5-4.4s-1.5-4.6-1.5-8.2V17.7h7.6v16.5c0 1.6.4 2.9.7 4a5.8 5.8 0 0 0 4 4.3c.8.2 1.9.4 3 .4l3.5-.1.8-.1-.1-1.9v-23h7.6v30l-4.8 1.2c-2 .2-4.3.5-6.4.5zM250.2 49.1V23.7h-4.4l3.1-5.9h9.1v3.7s3-3.1 5.1-3.5c.8-.1 1.7-.4 2.7-.4l2.3.1h.1v6.4H266l-2.6.4c-1 .2-1.9.6-2.8 1.2-1 .7-1.8 1.7-2.2 3-.4 1.1-.6 2.6-.6 4.6v16h-7.6zM283.7 49.7c-2.1 0-4-.1-5.8-.6-1.7-.4-3.1-.9-4.3-1.8-1.1-.7-2-1.9-2.6-3.1a12 12 0 0 1-.9-4.9c0-1.9.4-3.5 1.2-4.6a7.5 7.5 0 0 1 3.1-3c1.3-.7 2.7-1.3 4.3-1.6 1.6-.4 3.3-.5 5-.5h1.3l1.9.1 1.1.1v-1.1c-.1-2.6-1.3-3.7-2.4-4.2-1.3-.5-2.9-.8-4.9-.8-1 0-2.2.1-3.6.4-1 .1-2.1.4-3.2.7l-.7-2.5-.5-2-.2-1.1c1.8-.6 3.4-.9 5-1.3 1.9-.4 3.5-.4 5-.4 4.3 0 7.4 1 9.7 3 2.2 1.9 3.2 5.2 3.2 9.5v17.9c-.8.4-3 .7-4.8 1.1-2.3.4-4.4.7-6.9.7zm.6-15.4c-1.9 0-3.6.4-4.9.9-1.4.7-2.2 2-2.2 3.8 0 1.1.2 2 .8 2.7a4 4 0 0 0 1.9 1.3l2.2.5 1.8.1c.9 0 1.8-.1 2.9-.4l.7-.1v-8.5l-.7-.1-1.4-.1-1.1-.1z"}})])}),[],!1,null,"3f20ce66",null).exports}},r=(i(729),Object(o.a)(a,(function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"vf-branding-container"},[this._v("\n    "+this._s(this.$i18n("branding.powered_by"))+" "),t("span",{staticClass:"vf-offscreen-text"},[this._v("\n        Viafoura\n    ")]),this._v(" "),t("a",{staticClass:"vf-branding",attrs:{href:this.vfLink,title:"Visit the Viafoura website",rel:"noopener noreferrer",target:"_blank"}},[t("vf-logo",{staticClass:"vf-branding__logo"})],1)])}),[],!1,null,"c6c265ec",null));t.a=r.exports},597:function(e,t,i){"use strict";i(278);var n=i(18),s=(i(40),i(13),i(6),i(8),i(4),i(17),i(86),i(0)),o=i(3),a=i(79),r=i(445),l=i(433),c=i(122),h=i(12),u=i(232),d=i(428),m=i(449);function f(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function p(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var g={props:{userUuid:{required:!0},showFollow:{default:!0},isCommentBoxAvatar:{default:!1},size:{default:r.a.MEDIUM}},computed:function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?f(i,!0).forEach((function(t){p(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):f(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({},Object(a.c)({currentUser:s.eb,settings:s.Dc,userByUuid:s.ed,currentUserUuid:s.fb}),{user:function(){return this.userByUuid(this.userUuid)||{}},isCurrentUser:function(){return this.user.uuid&&this.$store.getters[s.Lb](this.user.uuid)},canFollow:function(){return!this.isCurrentUser&&Object(h.q)(this.currentUser,this.user,this.settings)},isLoggedIn:function(){return Object(u.b)(this.currentUser)},isGuestUser:function(){return Object(u.a)(this.user)},showFollowButton:function(){return this.showFollow&&this.canFollow&&!this.isFollowing&&!this.isCurrentUser&&!this.isGuestUser},isFollowing:function(){return this.canFollow&&this.user.is_followed},buttonAriaLabel:function(){return this.isCurrentUser?this.$i18n("aria.images.open_profile"):this.$i18n("aria.images.open_other_profile",{username:this.user.name})}}),methods:{followUser:function(){c.a.getInstance().$authorize("follow","user",[this.currentUser,this.user,this.settings],{action:l.a})&&this.$store.dispatch(o.Ib,{uuid:this.user.uuid})}},components:{frontAvatar:m.a,vfButton:d.a}},v=(i(833),i(85)),b=Object(v.a)(g,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"vf-comment-user vf-avatar-container vf-legacy-avatar"},[i("front-avatar",{staticClass:"vf-user-avatar-btn",attrs:{"is-clickable":"",user:e.user,size:e.size}}),e._v(" "),e.showFollowButton?i("vf-button",{staticClass:"vf-button-full vf-button-small vf-button-outline vf-grey vf-comment-follow",class:{"vf-avatar-hidden":e.isFollowing},nativeOn:{"&click":function(t){return e.followUser(t)}}},[i("span",[e._v(e._s(e.$i18n("user_actions.follow")))])]):e._e()],1)}),[],!1,null,"277b7a87",null).exports,w=i(5),_=i(441),y=i(57),C=i(2);t.a=_.a.View.extend({tagName:"legacy-avatar",attributes:{":user-uuid":"userUuid",":show-follow":"showFollowButton",":size":"size"},initialize:function(e){this.backboneUser=e.user,this.showFollowButton=e.showFollowButton||!e.hasCommentBoxAvatar,this.size=e.size},render:function(){var e=this.backboneUser.toJSON(),t=w.vuexStore.getInstance();this.vueComponent=new n.default({el:this.el,data:{showFollowButton:this.showFollowButton,userUuid:e.uuid||y.b,size:this.size},mounted:function(){var e=this;this.$subscribe(C.o.CHANNEL,C.o.EVENTS.SUCCESS,(function(t){var i=t.uuid;return e.updateUser(i)})),this.$subscribe(C.p.CHANNEL,C.p.EVENTS.SUCCESS,(function(){return e.updateUser(y.b)}))},methods:{updateUser:function(e){this.userUuid=e}},store:t,components:{legacyAvatar:b}})},remove:function(){this.vueComponent&&this.vueComponent.$destroy()}})},599:function(e,t,i){"use strict";var n=i(33),s=i(594),o={props:{sectionUuid:n.a.uuid.isRequired,rootSectionUuid:n.a.uuid,product:n.a.string.isRequired,ariaLabel:n.a.string.isRequired},components:{branding:s.a}},a=(i(575),i(85)),r=Object(a.a)(o,(function(){var e=this.$createElement,t=this._self._c||e;return t("footer",{staticClass:"vf3-conversations-footer",attrs:{"aria-label":this.ariaLabel}},[t("branding",{attrs:{product:this.product,"section-uuid":this.sectionUuid,"root-section-uuid":this.rootSectionUuid}})],1)}),[],!1,null,"abfaf74a",null);t.a=r.exports},616:function(e,t,i){e.exports=i(711)},617:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var n={UP:"u",DOWN:"d",LEFT:"l",RIGHT:"r"}},621:function(e,t,i){"use strict";i(26),i(13),i(37),i(80);var n=i(429),s=i.n(n),o=i(424),a=i(441),r=i(431),l=i(831),c=i(20),h=i(582),u=i(72);function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}t.a=a.a.Model.extend({idAttribute:"progressId",defaults:{loaded:0,total:0},initialize:function(e){o.default.bindAll(this,"onProgress","onDone","onError"),this.restAPI=e.restAPI,this.paths={media:"".concat(c.a.api_url+r.a.locations.domain,"/media"),avatar:"".concat(c.a.api_url+r.a.locations.domain,"/users/").concat(r.a.current.user.id)},e&&"object"===d(e)&&(this.file=e.file[0].files[0],s()(e.file).replaceWith(s()(e.file).clone()),this.type=e.type||"media",this.section=e.section,this.pageId=e.pageId),this.set("progressId",this.generateUID()),this.progress=0,this.state="init",this.delay=500},generateUID:function(){return"1".concat(Math.random()).replace(".","0")},getFormData:function(){var e=new FormData;return e.append("media",this.file),this.section&&e.append("section",this.section),this.pageId&&e.append("page_id",this.pageId),e},upload:function(){var e=Object(h.a)(this.getFormData(),this.onProgress);this._cancel=e[1],this.cachedData={user:r.a.current.user,date_created:Date.now()},e[0].then(this.onDone).catch(this.onError)},cancel:function(){this._cancel(),delete this._cancel,this.onCancel()},setPoll:function(){setTimeout(this.poll.bind(this),this.delay)},onCancel:function(){this.state="cancel",this.trigger(this.state,this)},onError:function(e){Object(u.b)(["response","status"],e)&&(this.state="error",this.trigger("error",{id:this.get("progressId"),state:"error",status:e.response.status},this))},onDone:function(e){var t=this;this.state="done",this.trigger("done",{id:this.get("progressId"),state:"done"}),new l.a({id:e.id}).fetch({params:!0,success:function(e,i){t.set("loaded",t.get("total"));var n=Object.assign({progressId:t.get("progressId")},t.cachedData);e.set(n),t.trigger("media",e,i,t),t.trigger("afterMedia",e,i,t)},error:function(e){t.trigger("error",e,t)}})},onProgress:function(e){this.state="uploading",this.set({loaded:.9*e.loaded,total:e.total}),this.trigger("progress",{state:"uploading",received:e.loaded,size:e.total,is:this.get("progressId")},this)},getProgress:function(){var e=this.get("total");return 0===e?e:Math.round(this.get("loaded")/e*100)}})},622:function(e,t,i){"use strict";var n=function(e,t,i){e&&e.addEventListener("keydown",(function(e){t(e)&&(e.preventDefault(),e.stopPropagation(),i())}))};t.a={storedEl:null,tabTo:function(e){e.focus()},setStored:function(e){return this.storedEl=e,this},bindTabbingExplicitly:function(e,t,i,s){this.firstEl=e,this.lastEl=i,n(this.firstEl,(function(e){return 9===e.which&&e.shiftKey&&(!t||t())}),this.tabTo.bind(this,this.lastEl)),n(this.lastEl,(function(e){return 9===e.which&&!e.shiftKey&&(!s||s())}),this.tabTo.bind(this,this.firstEl))},bindTabbing:function(){return this.bindTabbingExplicitly(this.$(".vf-js-first-tab")[0],!1,this.$(".vf-js-last-tab")[0],!1)}}},660:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var n=function(e){return'<span class="vf-icon vf-icon-mod vf-icon-medium">'.concat(e,"</span>")}},711:function(e,t){t.KEY_CANCEL=3,t.KEY_HELP=6,t.KEY_BACK_SPACE=8,t.KEY_TAB=9,t.KEY_CLEAR=12,t.KEY_RETURN=13,t.KEY_ENTER=14,t.KEY_SHIFT=16,t.KEY_CONTROL=17,t.KEY_ALT=18,t.KEY_PAUSE=19,t.KEY_CAPS_LOCK=20,t.KEY_ESCAPE=27,t.KEY_SPACE=32,t.KEY_PAGE_UP=33,t.KEY_PAGE_DOWN=34,t.KEY_END=35,t.KEY_HOME=36,t.KEY_LEFT=37,t.KEY_UP=38,t.KEY_RIGHT=39,t.KEY_DOWN=40,t.KEY_PRINTSCREEN=44,t.KEY_INSERT=45,t.KEY_DELETE=46,t.KEY_0=48,t.KEY_1=49,t.KEY_2=50,t.KEY_3=51,t.KEY_4=52,t.KEY_5=53,t.KEY_6=54,t.KEY_7=55,t.KEY_8=56,t.KEY_9=57,t.KEY_SEMICOLON=59,t.KEY_EQUALS=61,t.KEY_A=65,t.KEY_B=66,t.KEY_C=67,t.KEY_D=68,t.KEY_E=69,t.KEY_F=70,t.KEY_G=71,t.KEY_H=72,t.KEY_I=73,t.KEY_J=74,t.KEY_K=75,t.KEY_L=76,t.KEY_M=77,t.KEY_N=78,t.KEY_O=79,t.KEY_P=80,t.KEY_Q=81,t.KEY_R=82,t.KEY_S=83,t.KEY_T=84,t.KEY_U=85,t.KEY_V=86,t.KEY_W=87,t.KEY_X=88,t.KEY_Y=89,t.KEY_Z=90,t.KEY_LEFT_CMD=91,t.KEY_RIGHT_CMD=93,t.KEY_CONTEXT_MENU=93,t.KEY_NUMPAD0=96,t.KEY_NUMPAD1=97,t.KEY_NUMPAD2=98,t.KEY_NUMPAD3=99,t.KEY_NUMPAD4=100,t.KEY_NUMPAD5=101,t.KEY_NUMPAD6=102,t.KEY_NUMPAD7=103,t.KEY_NUMPAD8=104,t.KEY_NUMPAD9=105,t.KEY_MULTIPLY=106,t.KEY_ADD=107,t.KEY_SEPARATOR=108,t.KEY_SUBTRACT=109,t.KEY_DECIMAL=110,t.KEY_DIVIDE=111,t.KEY_F1=112,t.KEY_F2=113,t.KEY_F3=114,t.KEY_F4=115,t.KEY_F5=116,t.KEY_F6=117,t.KEY_F7=118,t.KEY_F8=119,t.KEY_F9=120,t.KEY_F10=121,t.KEY_F11=122,t.KEY_F12=123,t.KEY_F13=124,t.KEY_F14=125,t.KEY_F15=126,t.KEY_F16=127,t.KEY_F17=128,t.KEY_F18=129,t.KEY_F19=130,t.KEY_F20=131,t.KEY_F21=132,t.KEY_F22=133,t.KEY_F23=134,t.KEY_F24=135,t.KEY_NUM_LOCK=144,t.KEY_SCROLL_LOCK=145,t.KEY_COMMA=188,t.KEY_PERIOD=190,t.KEY_SLASH=191,t.KEY_BACK_QUOTE=192,t.KEY_OPEN_BRACKET=219,t.KEY_BACK_SLASH=220,t.KEY_CLOSE_BRACKET=221,t.KEY_QUOTE=222,t.KEY_META=224},728:function(e,t,i){"use strict";var n=i(507);i.n(n).a},729:function(e,t,i){"use strict";var n=i(508);i.n(n).a},731:function(e,t,i){"use strict";var n=i(510);i.n(n).a},732:function(e,t,i){"use strict";var n=i(511);i.n(n).a},822:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i(583),s=function(e){return"".concat(n.b,"-").concat(e)}},832:function(e,t,i){"use strict";var n=i(424),s=i(436),o=i(222),a=i(11);function r(){}n.default.extend(r.prototype,s.a,{subscribe:function(e){var t=this,i=o.c.getInstance().subscribe(e);return a.a.getInstance().$subscribe(o.a,i.namespace,(function(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return t.trigger.apply(t,[i.namespace].concat(n))})),this.trigger(i.namespace,o.b.subscribed),i},unsubscribe:function(e){o.c.getInstance().unsubscribe(e),a.a.getInstance().$unsubscribe(o.a,e)},isActive:function(e){return o.c.getInstance().isActive(e)},setActive:function(e){return o.c.getInstance().setActive(e)},setInactive:function(e){return o.c.getInstance().setInactive(e)}}),Object.defineProperty(r.prototype,"subscriptions",{get:function(){return o.c.getInstance().subscriptions}}),t.a=new r},833:function(e,t,i){"use strict";var n=i(541);i.n(n).a},834:function(e,t,i){e.exports=i.p+"assets/flashmediaelement.80886842736d03577cd76df986a3ff22.swf"},835:function(e,t,i){"use strict";i(278);var n=i(429),s=i.n(n),o=i(424),a=i(431),r=i(436),l=i(430),c=i(442),h=i(426),u=i(585);t.a=h.a.extend({templateName:"rating_interactive",className:"vf-rating-interactive js-rating-interactive",events:{"mouseover .vf-rating":"setInteractive","mouseleave .vf-rating":"clearInteractive","click svg":"rate"},initialize:function(e){var t=this;o.default.bindAll(this,"setInteractive","clearInteractive","updateNewUserRating","onPageFetchError"),e=e||{},this.user=e.user||a.a.current.user,this.page=e.page||a.a.current.page,this.model=e.model||new c.a,this.baseRatingView=new u.a({model:this.model,showMicroformat:this.options.showMicroformat}),this.views={".js-rating-stars":this.baseRatingView};var i=this.$el[0].dataset;if(1===this.domainSettings.get("enable_page_rating")&&(i.path||i.url)){var n={path:i.path,url:i.url};this.baseRatingView.fetchNewPage(n).then((function(e){return t.page.set(e.attributes)}))}this.listenTo(this.user,"change:id",this.updateSelf),this.listenTo(r.a,"rating",this.updateSelf,this)},clearInteractive:function(){s.a.each(this.$stars,(function(e,t){return l.a.removeClassFromSVG(t,"vf-interactive")}))},setInteractive:function(){s.a.each(this.$stars,(function(e,t){return l.a.addClassToSVG(t,"vf-interactive")}))},updateSelf:function(){this.page.fetch({batch:!0,success:this.updateNewUserRating,error:this.onPageFetchError})},updateNewUserRating:function(){this.setRating(this.currentRating())},onPageFetchError:function(e){console.warn("Page fetch errror: ".concat(e.error))},rate:function(e){e.preventDefault(),e.stopPropagation();var t=s()(e.target).closest("svg").data("value");this.trigger("rating",t),this.onRate(t)},updatePage:function(e){this.page.set(e),r.a.trigger("/page/rate/success",this.page)},onRate:function(){},onRateSuccess:function(e){var t=e.result;t&&(this.updatePage(t),this.setRating(t.ratings[t.id].points))},onRateError:function(e){console.warn("Page rate error: ".concat(e.error))},setRating:function(e){this.model.get("rating")===e?this.baseRatingView.setRating():this.model.set("rating",e)},currentRating:function(){return this.model.get("rating")||0},render:function(){return this.$el.html(this.template(this.page.toJSON())),this.setElement(this.$el),this.renderView(this.views),this.setRating(this.currentRating()),this.$stars=this.views[".js-rating-stars"].$stars,this}})},836:function(e,t,i){"use strict";var n=i(424),s=i(539),o=i(540),a=s.a.extend({model:o.a,url:function(){var e="/comments";return this.page&&(e="/pages/".concat(this.page.getRouteId()).concat(e)),e},initialize:function(e,t){s.a.prototype.initialize.apply(this,arguments),t&&(this.page=t.page),this.settings={limit:5},t&&t.settings&&n.default.extend(this.settings,t.settings)}});t.a=a},851:function(e,t,n){"use strict";n(10),n(6),n(8),n(4),n(32),n(466),n(87);var s=n(48),o=n(424),a=n(430),r=(n(138),function(e,t){var i=new FileReader;return new Promise((function(n){i.onload=function(){n(i.result)},i[e](t)}))}),l=function(e){return e.type.match("image")},c=function(e){return e.type.match("video")},h=function(e){return r("readAsDataURL",e)},u=function(e){return r("readAsArrayBuffer",e)},d=function(e,t,i){var n=document.createElement("canvas");n.width=t.videoWidth,n.height=t.videoHeight,n.getContext("2d").drawImage(t,0,0,n.width,n.height);var s=n.toDataURL(),o=s.length>1e5;return o&&(e(s),URL.revokeObjectURL(i)),o},m=function(e,t,i){return new Promise((function(e){var n=function n(){d(e,i,t)&&(i.removeEventListener("timeupdate",n),i.pause())};i.addEventListener("loadeddata",(function(){d(e,i,t)&&i.removeEventListener("timeupdate",n)})),i.addEventListener("timeupdate",n),i.preload="metadata",i.src=t,i.muted=!0,i.playsInline=!0,i.play()}))},f=function(e){return u(e).then((function(t){var i=new Blob([t],{type:e.type}),n=URL.createObjectURL(i),s=document.createElement("video");return m(i,n,s,t)}))},p=n(120),g=function(e,t,i){return window.requestAnimationFrame(i),new Promise((function(i){e.addEventListener("transitionend",(function n(){a.a.removeClassFromSVG(e,"".concat(t,"-transition")),e.removeEventListener("transitionend",n),i()}))}))},v=function(e,t){a.a.addClassToSVG(e,"".concat(t,"-transition")),a.a.addClassToSVG(e,"".concat(t,"-enter"));return g(e,t,(function(){a.a.removeClassFromSVG(e,"".concat(t,"-enter"))}))},b=function(e,t){a.a.addClassToSVG(e,"".concat(t,"-transition"));return g(e,t,(function(){a.a.addClassToSVG(e,"".concat(t,"-leave"))}))},w=function(e){return new Promise((function(t){window.requestAnimationFrame((function(){e(),t()}))}))},_=function(){return p.b>0&&p.b<=11},y=function(e,t){var i=Object(s.a)(t,e);i&&i.parentNode.removeChild(i)},C=n(481),E=n(426),S=(n(306),E.a.extend({initialize:function(){E.a.prototype.initialize.apply(this,arguments),o.default.bindAll(this,"poll","updateMedia"),this.model&&!this.model.isCompleted()&&this.poll()},templateName:"inline_gallery_item",events:{"click a":"onClick"},afterRender:function(){this.model.isVideo()&&!this.model.isCompleted()&&this.playButton&&(this.playButton.style.opacity=0)},getTemplateData:function(){return{url:this.model.isVideo()?this.model.isCompleted()?this.model.get("thumbs").small:"":this.model.get("s")?this.model.get("s").url:this.model.get("t").url,count:this.model.total,isVideo:this.isVideo(),id:this.model.getId(),isUploading:!1,isProcessing:this.isProcessing()}},isProcessing:function(){return!!this.isVideo()&&"in_progress"===this.model.get("processing_status")},isVideo:function(){return this.model&&this.model.isVideo()&&!this.model.total},render:function(){var e=this.template(this.getTemplateData());return this.isVideo()&&(this.playButton=Object(s.a)(".vf-icon-play",e[0])),this.afterRender(e[0]),this.setElement(e),this},renderAndReplace:function(){var e=this.$el;this.render(),e.replaceWith(this.$el)},onClick:function(e){e.preventDefault(),this.trigger("show",this.model,this.$("a")[0])},poll:function(){clearInterval(this.pollTID),this.pollTID=setInterval(this.updateMedia,3e3)},updateMedia:function(){this.model&&this.model.fetch({batch:!0,success:function(){this.model.isCompleted()&&(clearInterval(this.pollTID),this.updateMediaDisplay())}.bind(this),error:function(){clearInterval(this.pollTID)}.bind(this)})},updateMediaDisplay:function(){this.playButton&&(b(this.playButton,"fade-partial"),this.playButton.style.opacity=1);var e=this.getTemplateData().url;this.$el[0].style.backgroundImage="url('".concat(e,"')"),this.$el.find(".vf-video-processing").hide()}})),T=S.extend({initialize:function(e){S.prototype.initialize.apply(this,arguments),this.upload=e.upload},onClick:function(e){e.preventDefault(),"done"===this.upload.state&&S.prototype.onClick.apply(this,arguments)},getTemplateData:function(){return{url:this.upload.get("preview"),count:null,isVideo:this.isVideo(),id:null,progress:this.upload.getProgress(),isUploading:!0,isProcessing:!1}},isProcessing:function(){return!1},isVideo:function(){return c(this.upload.file)||S.prototype.isVideo.call(this)},enter:function(){v(this.$el[0],"fade-image"),v(this.progressBarContainer,"fade")},afterRender:function(e){this.listenTo(this.upload,"change:loaded",this.updateBar),this.listenTo(this.upload,"media",this.transitionToItemView),this.progressBarContainer=Object(s.a)(".vf-progress-bar",e),this.progressBarProgress=Object(s.a)(".vf-progress",e),this.isVideo()&&(a.a.addClassToSVG(this.playButton,"vf-js-play-fade"),v(this.playButton,"fade"),this.playButton.style.display="none")},updateBar:function(){this.progressBarProgress&&window.requestAnimationFrame(function(){this.progressBarProgress.style.width="".concat(this.upload.getProgress(),"%")}.bind(this))},transitionToItemView:function(e){this.model=e,this.model.isVideo()&&this.poll(),this.$(".vf-js-anchor").data("id",e.getId()),b(this.$el[0],"fade-image"),b(this.progressBarContainer,"fade").then(function(){return this.progressBarContainer.parentNode.removeChild(this.progressBarContainer),e.isVideo()&&this.playButton?(this.playButton.style.display="block",v(this.playButton,"fade-partial")):Promise.resolve()}.bind(this))},onMediaUpdate:function(){b(this.playButton,"fade-partial")}}),$=(n(278),n(429)),k=n.n($),O=n(431),x=n(621),A=n(164),N=n(433),R=E.a.extend({tagName:"li",className:"vf-media-gallery-item vf-media-gallery-upload vf-accent-bg-colour",templateName:"inline_gallery_upload_button",events:{"change .vf-attach":"uploadFile","click .vf-js-upload":"attemptFileChoice","keydown .vf-js-upload":"onUploadMediaKeyboard"},initialize:function(e){E.a.prototype.initialize.call(this,e),this.page=e.page},render:function(e){var t=Object(A.b)("vf-page-upload-");e=e||"label",this.$el.html(this.template({tagName:e,uploadId:t()}))},onUploadMediaKeyboard:function(e){13===e.keyCode&&this.attemptFileChoice(e)},attemptFileChoice:function(e){window.viafoura.$authorize("upload","media",[O.a.current.user.toJSON(),O.a.current.settings.toJSON()],{trigger:e.currentTarget,action:N.f})||(e.preventDefault(),e.stopPropagation())},uploadFile:function(e){this.render("div"),this.doUpload(e),this.trigger("upload",this.upload)},doUpload:function(e){this.upload=new x.a({restAPI:this.restAPI,file:k()(e.target),type:"media",section:this.section,pageId:this.page.id}),this.upload.upload()}}),I=(n(37),n(442).a.extend({url:"/media"}));n(80),n(26),n(13),n(86),n(91),n(23),n(100);function M(e){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var P={};P.version="2.11.0",P.meIndex=0,P.plugins={silverlight:[{version:[3,0],types:["video/mp4","video/m4v","video/mov","video/wmv","audio/wma","audio/m4a","audio/mp3","audio/wav","audio/mpeg"]}],flash:[{version:[9,0,124],types:["video/mp4","video/m4v","video/mov","video/flv","video/rtmp","video/x-flv","audio/flv","audio/x-flv","audio/mp3","audio/m4a","audio/mpeg","video/youtube","video/x-youtube"]}],youtube:[{version:null,types:["video/youtube","video/x-youtube","audio/youtube","audio/x-youtube"]}],vimeo:[{version:null,types:["video/vimeo","video/x-vimeo"]}]},P.Utility={encodeUrl:function(e){return encodeURIComponent(e)},escapeHTML:function(e){return e.toString().split("&").join("&amp;").split("<").join("&lt;").split('"').join("&quot;")},absolutizeUrl:function(e){var t=document.createElement("div");return t.innerHTML='<a href="'+this.escapeHTML(e)+'">x</a>',t.firstChild.href},getScriptPath:function(e){for(var t,i,n=0,s="",o="",a=document.getElementsByTagName("script"),r=a.length,l=e.length;n<r;n++){for(i=a[n].src,t=0;t<l;t++)if(o=e[t],i.indexOf(o)>-1){s=i.substring(0,i.indexOf(o));break}if(""!==s)break}return s},secondsToTimeCode:function(e,t,i,n){void 0===i?i=!1:void 0===n&&(n=25);var s=Math.floor(e/3600)%24,o=Math.floor(e/60)%60,a=Math.floor(e%60),r=Math.floor((e%1*n).toFixed(3));return(t||s>0?(s<10?"0"+s:s)+":":"")+(o<10?"0"+o:o)+":"+(a<10?"0"+a:a)+(i?":"+(r<10?"0"+r:r):"")},timeCodeToSeconds:function(e,t,i,n){void 0===i?i=!1:void 0===n&&(n=25);var s=e.split(":"),o=parseInt(s[0],10),a=parseInt(s[1],10),r=parseInt(s[2],10),l=0;return i&&(l=parseInt(s[3])/n),3600*o+60*a+r+l},convertSMPTEtoSeconds:function(e){if("string"!=typeof e)return!1;var t=0,i=-1!=(e=e.replace(",",".")).indexOf(".")?e.split(".")[1].length:0,n=1;e=e.split(":").reverse();for(var s=0;s<e.length;s++)n=1,s>0&&(n=Math.pow(60,s)),t+=Number(e[s])*n;return Number(t.toFixed(i))},removeSwf:function(e){var t=document.getElementById(e);t&&/object|embed/i.test(t.nodeName)&&(P.MediaFeatures.isIE?(t.style.display="none",function(){4==t.readyState?P.Utility.removeObjectInIE(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))},removeObjectInIE:function(e){var t=document.getElementById(e);if(t){for(var i in t)"function"==typeof t[i]&&(t[i]=null);t.parentNode.removeChild(t)}}},P.PluginDetector={hasPluginVersion:function(e,t){var i=this.plugins[e];return t[1]=t[1]||0,t[2]=t[2]||0,i[0]>t[0]||i[0]==t[0]&&i[1]>t[1]||i[0]==t[0]&&i[1]==t[1]&&i[2]>=t[2]},nav:window.navigator,ua:window.navigator.userAgent.toLowerCase(),plugins:[],addPlugin:function(e,t,i,n,s){this.plugins[e]=this.detectPlugin(t,i,n,s)},detectPlugin:function(e,t,i,n){var s,o,a,r=[0,0,0];if(void 0!==this.nav.plugins&&"object"==M(this.nav.plugins[e])){if((s=this.nav.plugins[e].description)&&(void 0===this.nav.mimeTypes||!this.nav.mimeTypes[t]||this.nav.mimeTypes[t].enabledPlugin))for(r=s.replace(e,"").replace(/^\s+/,"").replace(/\sr/gi,".").split("."),o=0;o<r.length;o++)r[o]=parseInt(r[o].match(/\d+/),10)}else if(void 0!==window.ActiveXObject)try{(a=new ActiveXObject(i))&&(r=n(a))}catch(e){}return r}},P.PluginDetector.addPlugin("flash","Shockwave Flash","application/x-shockwave-flash","ShockwaveFlash.ShockwaveFlash",(function(e){var t=[],i=e.GetVariable("$version");return i&&(i=i.split(" ")[1].split(","),t=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)]),t})),P.PluginDetector.addPlugin("silverlight","Silverlight Plug-In","application/x-silverlight-2","AgControl.AgControl",(function(e){var t=[0,0,0,0],i=function(e,t,i,n){for(;e.isVersionSupported(t[0]+"."+t[1]+"."+t[2]+"."+t[3]);)t[i]+=n;t[i]-=n};return i(e,t,0,1),i(e,t,1,1),i(e,t,2,1e4),i(e,t,2,1e3),i(e,t,2,100),i(e,t,2,10),i(e,t,2,1),i(e,t,3,1),t})),P.MediaFeatures={init:function(){var e,t,i=this,n=document,s=P.PluginDetector.nav,o=P.PluginDetector.ua.toLowerCase(),a=["source","track","audio","video"];i.isiPad=null!==o.match(/ipad/i),i.isiPhone=null!==o.match(/iphone/i),i.isiOS=i.isiPhone||i.isiPad,i.isAndroid=null!==o.match(/android/i),i.isBustedAndroid=null!==o.match(/android 2\.[12]/),i.isIE=-1!=s.appName.toLowerCase().indexOf("microsoft"),i.isChrome=null!==o.match(/chrome/gi),i.isFirefox=null!==o.match(/firefox/gi),i.isWebkit=null!==o.match(/webkit/gi),i.isGecko=null!==o.match(/gecko/gi)&&!i.isWebkit,i.isOpera=null!==o.match(/opera/gi),i.hasTouch="ontouchstart"in window,i.svg=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect;for(e=0;e<a.length;e++)t=document.createElement(a[e]);i.supportsMediaTag=void 0!==t.canPlayType||i.isBustedAndroid,i.hasSemiNativeFullScreen=void 0!==t.webkitEnterFullscreen,i.hasWebkitNativeFullScreen=void 0!==t.webkitRequestFullScreen,i.hasMozNativeFullScreen=void 0!==t.mozRequestFullScreen,i.hasTrueNativeFullScreen=i.hasWebkitNativeFullScreen||i.hasMozNativeFullScreen,i.nativeFullScreenEnabled=i.hasTrueNativeFullScreen,i.hasMozNativeFullScreen&&(i.nativeFullScreenEnabled=t.mozFullScreenEnabled),this.isChrome&&(i.hasSemiNativeFullScreen=!1),i.hasTrueNativeFullScreen&&(i.fullScreenEventName=i.hasWebkitNativeFullScreen?"webkitfullscreenchange":"mozfullscreenchange",i.isFullScreen=function(){return t.mozRequestFullScreen?n.mozFullScreen:t.webkitRequestFullScreen?n.webkitIsFullScreen:void 0},i.requestFullScreen=function(e){i.hasWebkitNativeFullScreen?e.webkitRequestFullScreen():i.hasMozNativeFullScreen&&e.mozRequestFullScreen()},i.cancelFullScreen=function(){i.hasWebkitNativeFullScreen?document.webkitCancelFullScreen():i.hasMozNativeFullScreen&&document.mozCancelFullScreen()}),i.hasSemiNativeFullScreen&&o.match(/mac os x 10_5/i)&&(i.hasNativeFullScreen=!1,i.hasSemiNativeFullScreen=!1)}},P.MediaFeatures.init(),P.HtmlMediaElement={pluginType:"native",isFullScreen:!1,setCurrentTime:function(e){this.currentTime=e},setMuted:function(e){this.muted=e},setVolume:function(e){this.volume=e},stop:function(){this.pause()},setSrc:function(e){for(var t,i,n=this.getElementsByTagName("source");n.length>0;)this.removeChild(n[0]);if("string"==typeof e)this.src=e;else for(t=0;t<e.length;t++)if(i=e[t],this.canPlayType(i.type)){this.src=i.src;break}},setVideoSize:function(e,t){this.width=e,this.height=t}},P.PluginMediaElement=function(e,t,i){this.id=e,this.pluginType=t,this.src=i,this.events={},this.attributes={}},P.PluginMediaElement.prototype={pluginElement:null,pluginType:"",isFullScreen:!1,playbackRate:-1,defaultPlaybackRate:-1,seekable:[],played:[],paused:!0,ended:!1,seeking:!1,duration:0,error:null,tagName:"",muted:!1,volume:1,currentTime:0,play:function(){null!=this.pluginApi&&("youtube"==this.pluginType?this.pluginApi.playVideo():this.pluginApi.playMedia(),this.paused=!1)},load:function(){null!=this.pluginApi&&("youtube"==this.pluginType||this.pluginApi.loadMedia(),this.paused=!1)},pause:function(){null!=this.pluginApi&&("youtube"==this.pluginType?this.pluginApi.pauseVideo():this.pluginApi.pauseMedia(),this.paused=!0)},stop:function(){null!=this.pluginApi&&("youtube"==this.pluginType?this.pluginApi.stopVideo():this.pluginApi.stopMedia(),this.paused=!0)},canPlayType:function(e){var t,i,n,s=P.plugins[this.pluginType];for(t=0;t<s.length;t++)if(n=s[t],P.PluginDetector.hasPluginVersion(this.pluginType,n.version))for(i=0;i<n.types.length;i++)if(e==n.types[i])return"probably";return""},positionFullscreenButton:function(e,t,i){null!=this.pluginApi&&this.pluginApi.positionFullscreenButton&&this.pluginApi.positionFullscreenButton(e,t,i)},hideFullscreenButton:function(){null!=this.pluginApi&&this.pluginApi.hideFullscreenButton&&this.pluginApi.hideFullscreenButton()},setSrc:function(e){var t,i;if("string"==typeof e)this.pluginApi.setSrc(P.Utility.absolutizeUrl(e)),this.src=P.Utility.absolutizeUrl(e);else for(t=0;t<e.length;t++)if(i=e[t],this.canPlayType(i.type)){this.pluginApi.setSrc(P.Utility.absolutizeUrl(i.src)),this.src=P.Utility.absolutizeUrl(e);break}},setCurrentTime:function(e){null!=this.pluginApi&&("youtube"==this.pluginType?this.pluginApi.seekTo(e):this.pluginApi.setCurrentTime(e),this.currentTime=e)},setVolume:function(e){null!=this.pluginApi&&("youtube"==this.pluginType?this.pluginApi.setVolume(100*e):this.pluginApi.setVolume(e),this.volume=e)},setMuted:function(e){null!=this.pluginApi&&("youtube"==this.pluginType?(e?this.pluginApi.mute():this.pluginApi.unMute(),this.muted=e,this.dispatchEvent("volumechange")):this.pluginApi.setMuted(e),this.muted=e)},setVideoSize:function(e,t){this.pluginElement.style&&(this.pluginElement.style.width=e+"px",this.pluginElement.style.height=t+"px"),null!=this.pluginApi&&this.pluginApi.setVideoSize&&this.pluginApi.setVideoSize(e,t)},setFullscreen:function(e){null!=this.pluginApi&&this.pluginApi.setFullscreen&&this.pluginApi.setFullscreen(e)},enterFullScreen:function(){null!=this.pluginApi&&this.pluginApi.setFullscreen&&this.setFullscreen(!0)},exitFullScreen:function(){null!=this.pluginApi&&this.pluginApi.setFullscreen&&this.setFullscreen(!1)},addEventListener:function(e,t,i){this.events[e]=this.events[e]||[],this.events[e].push(t)},removeEventListener:function(e,t){if(!e)return this.events={},!0;var n=this.events[e];if(!n)return!0;if(!t)return this.events[e]=[],!0;for(i=0;i<n.length;i++)if(n[i]===t)return this.events[e].splice(i,1),!0;return!1},dispatchEvent:function(e){var t,i,n=this.events[e];if(n)for(i=Array.prototype.slice.call(arguments,1),t=0;t<n.length;t++)n[t].apply(null,i)},hasAttribute:function(e){return e in this.attributes},removeAttribute:function(e){delete this.attributes[e]},getAttribute:function(e){return this.hasAttribute(e)?this.attributes[e]:""},setAttribute:function(e,t){this.attributes[e]=t},remove:function(){P.Utility.removeSwf(this.pluginElement.id),P.MediaPluginBridge.unregisterPluginElement(this.pluginElement.id)}},P.MediaPluginBridge={pluginMediaElements:{},htmlMediaElements:{},registerPluginElement:function(e,t,i){this.pluginMediaElements[e]=t,this.htmlMediaElements[e]=i},unregisterPluginElement:function(e){delete this.pluginMediaElements[e],delete this.htmlMediaElements[e]},initPlugin:function(e){var t=this.pluginMediaElements[e],i=this.htmlMediaElements[e];if(t){switch(t.pluginType){case"flash":t.pluginElement=t.pluginApi=document.getElementById(e);break;case"silverlight":t.pluginElement=document.getElementById(t.id),t.pluginApi=t.pluginElement.Content.MediaElementJS}null!=t.pluginApi&&t.success&&t.success(t,i)}},fireEvent:function(e,t,i){var n,s,o,a=this.pluginMediaElements[e];for(s in n={type:t,target:a},i)a[s]=i[s],n[s]=i[s];o=i.bufferedTime||0,n.target.buffered=n.buffered={start:function(e){return 0},end:function(e){return o},length:1},a.dispatchEvent(n.type,n)}},P.MediaElementDefaults={mode:"auto",plugins:["flash","silverlight","youtube","vimeo"],enablePluginDebug:!1,type:"",pluginPath:P.Utility.getScriptPath(["mediaelement.js","mediaelement.min.js","mediaelement-and-player.js","mediaelement-and-player.min.js"]),flashName:"flashmediaelement.swf",flashStreamer:"",enablePluginSmoothing:!1,silverlightName:"silverlightmediaelement.xap",defaultVideoWidth:480,defaultVideoHeight:270,pluginWidth:-1,pluginHeight:-1,pluginVars:[],timerRate:250,startVolume:.8,success:function(){},error:function(){}},P.MediaElement=function(e,t){return P.HtmlMediaElementShim.create(e,t)},P.HtmlMediaElementShim={create:function(e,t){var i,n,s=P.MediaElementDefaults,o="string"==typeof e?document.getElementById(e):e,a=o.tagName.toLowerCase(),r="audio"===a||"video"===a,l=r?o.getAttribute("src"):o.getAttribute("href"),c=o.getAttribute("poster"),h=o.getAttribute("autoplay"),u=o.getAttribute("preload"),d=o.getAttribute("controls");for(n in t)s[n]=t[n];return l=null==l||""==l?null:l,c=null==c?"":c,u=null==u||"false"===u?"none":u,h=!(null==h||"false"===h),d=!(null==d||"false"===d),(i=this.determinePlayback(o,s,P.MediaFeatures.supportsMediaTag,r,l)).url=null!==i.url?P.Utility.absolutizeUrl(i.url):"","native"==i.method?(P.MediaFeatures.isBustedAndroid&&(o.src=i.url,o.addEventListener("click",(function(){o.play()}),!1)),this.updateNative(i,s,h,u)):""!==i.method?this.createPlugin(i,s,c,h,u,d):(this.createErrorMessage(i,s,c),this)},determinePlayback:function(e,t,i,n,s){var o,a,r,l,c,h,u,d,m,f,p,g=[],v={method:"",url:"",htmlMediaElement:e,isVideo:"audio"!=e.tagName.toLowerCase()};if(void 0!==t.type&&""!==t.type)if("string"==typeof t.type)g.push({type:t.type,url:s});else for(o=0;o<t.type.length;o++)g.push({type:t.type[o],url:s});else if(null!==s)h=this.formatType(s,e.getAttribute("type")),g.push({type:h,url:s});else for(o=0;o<e.childNodes.length;o++)1==(c=e.childNodes[o]).nodeType&&"source"==c.tagName.toLowerCase()&&(s=c.getAttribute("src"),h=this.formatType(s,c.getAttribute("type")),(!(p=c.getAttribute("media"))||!window.matchMedia||window.matchMedia&&window.matchMedia(p).matches)&&g.push({type:h,url:s}));if(!n&&g.length>0&&null!==g[0].url&&this.getTypeFromFile(g[0].url).indexOf("audio")>-1&&(v.isVideo=!1),P.MediaFeatures.isBustedAndroid&&(e.canPlayType=function(e){return null!==e.match(/video\/(mp4|m4v)/gi)?"maybe":""}),i&&("auto"===t.mode||"auto_plugin"===t.mode||"native"===t.mode)){for(n||(f=document.createElement(v.isVideo?"video":"audio"),e.parentNode.insertBefore(f,e),e.style.display="none",v.htmlMediaElement=e=f),o=0;o<g.length;o++)if(""!==e.canPlayType(g[o].type).replace(/no/,"")||""!==e.canPlayType(g[o].type.replace(/mp3/,"mpeg")).replace(/no/,"")){v.method="native",v.url=g[o].url;break}if("native"===v.method&&(null!==v.url&&(e.src=v.url),"auto_plugin"!==t.mode))return v}if("auto"===t.mode||"auto_plugin"===t.mode||"shim"===t.mode)for(o=0;o<g.length;o++)for(h=g[o].type,a=0;a<t.plugins.length;a++)for(u=t.plugins[a],d=P.plugins[u],r=0;r<d.length;r++)if(null==(m=d[r]).version||P.PluginDetector.hasPluginVersion(u,m.version))for(l=0;l<m.types.length;l++)if(h==m.types[l])return v.method=u,v.url=g[o].url,v;return"auto_plugin"===t.mode&&"native"===v.method?v:(""===v.method&&g.length>0&&(v.url=g[0].url),v)},formatType:function(e,t){return e&&!t?this.getTypeFromFile(e):t&&~t.indexOf(";")?t.substr(0,t.indexOf(";")):t},getTypeFromFile:function(e){var t=(e=e.split("?")[0]).substring(e.lastIndexOf(".")+1);return(/(mp4|m4v|ogg|ogv|webm|webmv|flv|wmv|mpeg|mov)/gi.test(t)?"video":"audio")+"/"+this.getTypeFromExtension(t)},getTypeFromExtension:function(e){switch(e){case"mp4":case"m4v":return"mp4";case"webm":case"webma":case"webmv":return"webm";case"ogg":case"oga":case"ogv":return"ogg";default:return e}},createErrorMessage:function(e,t,i){var n=e.htmlMediaElement,s=document.createElement("div");s.className="me-cannotplay";try{s.style.width=n.width+"px",s.style.height=n.height+"px"}catch(e){}t.errorHtml?s.innerHTML=t.errorHtml:s.innerHTML=""!==i?'<a href="'+e.url+'"><img src="'+i+'" width="100%" height="100%" /></a>':'<a href="'+e.url+'"><span>Download File</span></a>',n.parentNode.insertBefore(s,n),n.style.display="none",t.error(n)},createPlugin:function(e,t,i,n,s,o){var a,r,l,c=e.htmlMediaElement,h=1,u=1,d="me_"+e.method+"_"+P.meIndex++,m=new P.PluginMediaElement(d,e.method,e.url),f=document.createElement("div");m.tagName=c.tagName;for(var p=0;p<c.attributes.length;p++){var g=c.attributes[p];1==g.specified&&m.setAttribute(g.name,g.value)}for(r=c.parentNode;null!==r&&"body"!=r.tagName.toLowerCase();){if("p"==r.parentNode.tagName.toLowerCase()){r.parentNode.parentNode.insertBefore(r,r.parentNode);break}r=r.parentNode}switch(e.isVideo?(h=t.videoWidth>0?t.videoWidth:null!==c.getAttribute("width")?c.getAttribute("width"):t.defaultVideoWidth,u=t.videoHeight>0?t.videoHeight:null!==c.getAttribute("height")?c.getAttribute("height"):t.defaultVideoHeight,h=P.Utility.encodeUrl(h),u=P.Utility.encodeUrl(u)):t.enablePluginDebug&&(h=320,u=240),m.success=t.success,P.MediaPluginBridge.registerPluginElement(d,m,c),f.className="me-plugin",f.id=d+"_container",e.isVideo?c.parentNode.insertBefore(f,c):document.body.insertBefore(f,document.body.childNodes[0]),l=["id="+d,"isvideo="+(e.isVideo?"true":"false"),"autoplay="+(n?"true":"false"),"preload="+s,"width="+h,"startvolume="+t.startVolume,"timerrate="+t.timerRate,"flashstreamer="+t.flashStreamer,"height="+u],null!==e.url&&("flash"==e.method?l.push("file="+P.Utility.encodeUrl(e.url)):l.push("file="+e.url)),t.enablePluginDebug&&l.push("debug=true"),t.enablePluginSmoothing&&l.push("smoothing=true"),o&&l.push("controls=true"),t.pluginVars&&(l=l.concat(t.pluginVars)),e.method){case"silverlight":f.innerHTML='<object data="data:application/x-silverlight-2," type="application/x-silverlight-2" id="'+d+'" name="'+d+'" width="'+h+'" height="'+u+'" class="mejs-shim"><param name="initParams" value="'+l.join(",")+'" /><param name="windowless" value="true" /><param name="background" value="black" /><param name="minRuntimeVersion" value="3.0.0.0" /><param name="autoUpgrade" value="true" /><param name="source" value="'+t.pluginPath+t.silverlightName+'" /></object>';break;case"flash":P.MediaFeatures.isIE?(a=document.createElement("div"),f.appendChild(a),a.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab" id="'+d+'" width="'+h+'" height="'+u+'" class="mejs-shim"><param name="movie" value="'+t.pluginPath+t.flashName+"?x="+new Date+'" /><param name="flashvars" value="'+l.join("&amp;")+'" /><param name="quality" value="high" /><param name="bgcolor" value="#000000" /><param name="wmode" value="transparent" /><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="true" /></object>'):f.innerHTML='<embed id="'+d+'" name="'+d+'" play="true" loop="false" quality="high" bgcolor="#000000" wmode="transparent" allowScriptAccess="always" allowFullScreen="true" type="application/x-shockwave-flash" pluginspage="//www.macromedia.com/go/getflashplayer" src="'+t.pluginPath+t.flashName+'" flashvars="'+l.join("&")+'" width="'+h+'" height="'+u+'" class="mejs-shim"></embed>';break;case"youtube":var v=e.url.substr(e.url.lastIndexOf("=")+1);youtubeSettings={container:f,containerId:f.id,pluginMediaElement:m,pluginId:d,videoId:v,height:u,width:h},P.PluginDetector.hasPluginVersion("flash",[10,0,0])?P.YouTubeApi.createFlash(youtubeSettings):P.YouTubeApi.enqueueIframe(youtubeSettings);break;case"vimeo":m.vimeoid=e.url.substr(e.url.lastIndexOf("/")+1),f.innerHTML='<iframe src="http://player.vimeo.com/video/'+m.vimeoid+'?portrait=0&byline=0&title=0" width="'+h+'" height="'+u+'" frameborder="0" class="mejs-shim"></iframe>'}return c.style.display="none",m},updateNative:function(e,t,i,n){var s,o=e.htmlMediaElement;for(s in P.HtmlMediaElement)o[s]=P.HtmlMediaElement[s];return t.success(o,o),o}},P.YouTubeApi={isIframeStarted:!1,isIframeLoaded:!1,loadIframeApi:function(){if(!this.isIframeStarted){var e=document.createElement("script");e.src="http://www.youtube.com/player_api";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t),this.isIframeStarted=!0}},iframeQueue:[],enqueueIframe:function(e){this.isLoaded?this.createIframe(e):(this.loadIframeApi(),this.iframeQueue.push(e))},createIframe:function(e){var t=e.pluginMediaElement,i=new YT.Player(e.containerId,{height:e.height,width:e.width,videoId:e.videoId,playerVars:{controls:0},events:{onReady:function(){e.pluginMediaElement.pluginApi=i,P.MediaPluginBridge.initPlugin(e.pluginId),setInterval((function(){P.YouTubeApi.createEvent(i,t,"timeupdate")}),250)},onStateChange:function(e){P.YouTubeApi.handleStateChange(e.data,i,t)}}})},createEvent:function(e,t,i){var n={type:i,target:t};if(e&&e.getDuration){t.currentTime=n.currentTime=e.getCurrentTime(),t.duration=n.duration=e.getDuration(),n.paused=t.paused,n.ended=t.ended,n.muted=e.isMuted(),n.volume=e.getVolume()/100,n.bytesTotal=e.getVideoBytesTotal(),n.bufferedBytes=e.getVideoBytesLoaded();var s=n.bufferedBytes/n.bytesTotal*n.duration;n.target.buffered=n.buffered={start:function(e){return 0},end:function(e){return s},length:1}}t.dispatchEvent(n.type,n)},iFrameReady:function(){for(this.isLoaded=!0,this.isIframeLoaded=!0;this.iframeQueue.length>0;){var e=this.iframeQueue.pop();this.createIframe(e)}},flashPlayers:{},createFlash:function(e){this.flashPlayers[e.pluginId]=e;var t,i="http://www.youtube.com/apiplayer?enablejsapi=1&amp;playerapiid="+e.pluginId+"&amp;version=3&amp;autoplay=0&amp;controls=0&amp;modestbranding=1&loop=0";P.MediaFeatures.isIE?(t=document.createElement("div"),e.container.appendChild(t),t.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab" id="'+e.pluginId+'" width="'+e.width+'" height="'+e.height+'" class="mejs-shim"><param name="movie" value="'+i+'" /><param name="wmode" value="transparent" /><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="true" /></object>'):e.container.innerHTML='<object type="application/x-shockwave-flash" id="'+e.pluginId+'" data="'+i+'" width="'+e.width+'" height="'+e.height+'" style="visibility: visible; " class="mejs-shim"><param name="allowScriptAccess" value="always"><param name="wmode" value="transparent"></object>'},flashReady:function(e){var t=this.flashPlayers[e],i=document.getElementById(e),n=t.pluginMediaElement;n.pluginApi=n.pluginElement=i,P.MediaPluginBridge.initPlugin(e),i.cueVideoById(t.videoId);var s=t.containerId+"_callback";window[s]=function(e){P.YouTubeApi.handleStateChange(e,i,n)},i.addEventListener("onStateChange",s),setInterval((function(){P.YouTubeApi.createEvent(i,n,"timeupdate")}),250)},handleStateChange:function(e,t,i){switch(e){case-1:i.paused=!0,i.ended=!0,P.YouTubeApi.createEvent(t,i,"loadedmetadata");break;case 0:i.paused=!1,i.ended=!0,P.YouTubeApi.createEvent(t,i,"ended");break;case 1:i.paused=!1,i.ended=!1,P.YouTubeApi.createEvent(t,i,"play"),P.YouTubeApi.createEvent(t,i,"playing");break;case 2:i.paused=!0,i.ended=!1,P.YouTubeApi.createEvent(t,i,"pause");break;case 3:P.YouTubeApi.createEvent(t,i,"progress")}}};var F=P.MediaElement,D=n(834),L=n.n(D),U=E.a.extend({attributes:{class:"vf-player"},initialize:function(e){this.startPaused=e.startPaused||!1},templateName:"player",render:function(){var e=this.model,t=e.attributes.mp4,i=e.attributes.webm,n=e.id;this.id=n||1,t&&i&&(t=t.replace("https:",location.protocol),i=i.replace("https:",location.protocol)),this.$el.append(this.template({mp4:t,webm:i,id:n}));return this.mejs=new F(this.$("video")[0],{features:["playpause","progress","current","duration","volume"],startVolume:.5,plugins:["flash"],errorHtml:this.i18n("download_flash","http://get.adobe.com/flashplayer"),pluginPath:"",flashName:L.a,success:function(e){this.startPaused||e.play()}.bind(this)}),this},videoRendered:function(){return Boolean(this.mejs)},play:function(){return this.videoRendered()&&this.mejs.play&&this.mejs.play(),this},pause:function(){return this.videoRendered()&&this.mejs.pause&&this.mejs.pause(),this}}),B=n(597),V=E.a.extend({templateName:"fullscreen_viewer_item",events:{"click .vf-js-video-button":"onVideoClick","click .js-delete-media":"deleteMedia","click .js-flag-media":"flagMedia"},initialize:function(){o.default.bindAll(this,"onMediaDeleteSuccess","onMediaDeleteError","onMediaFlagSuccess","onMediaFlagError","onMediaFlagged"),this.$subscribe("media","flagged",this.onMediaFlagged),this.views={avatar:new B.a({user:this.model.get("user"),showFollowButton:!1})}},getLargestImageURL:function(){if(this.model.isVideo())return this.model.isCompleted()?this.model.get("thumbs").medium:"";var e=["o","x","l","m","s","t"].find(function(e){return this.model.get(e)}.bind(this));return this.model.get(e).url},templateData:function(){var e=this.model.get("user");return{avatar:e.get("pic_small"),name:e.get("name"),timeAgo:this.getRelativeTime(this.model.get("date_created"),this.domainSettings.currentTime()),isImage:this.model.isImage(),isCompleted:this.model.isCompleted(),isByCurrentUser:e.get("id")===O.a.current.user.id,isFlagged:Boolean(this.model.get("flagged"))}},render:function(){return this.templateOnly(Object.assign({},this.templateData(),{url:this.getLargestImageURL(),index:this.options.index,total:this.options.total,showPagination:this.options.total>1,isUserLoggedIn:O.a.current.user.isLoggedIn()})),this.insertSubViews(this.$el,{avatar:this.views.avatar}),this},onVideoClick:function(e){e.preventDefault();var t=this.model.toJSON();this.video=new I(t),this.player=new U({model:this.video}),this.$el.find(".vf-js-video-button").replaceWith(this.player.$el),this.player.render()},deleteMedia:function(e){e.stopPropagation(),this.model.destroy({success:this.onMediaDeleteSuccess,error:this.onMediaDeleteError})},onMediaDeleteSuccess:function(e){this.$publish("media","deleted",[e])},onMediaDeleteError:function(e){this.$publish("media","deleted:fail",e)},flagMedia:function(){!this.model.get("flagged")&&window.viafoura.$can("flag","content",O.a.current.user.toJSON(),O.a.current.settings.toJSON(),this.model.toJSON())&&this.restAPI.request("put","flags/".concat(this.model.id),{},{success:this.onMediaFlagSuccess,error:this.onMediaFlagError})},onMediaFlagSuccess:function(){this.$publish("media","flagged",this.model.id)},onMediaFlagError:function(e){this.$publish("media","flagged:fail",e)},onMediaFlagged:function(e){this.model.id===e&&(this.model.set("flagged",!0),this.render())}}),j=E.a.extend({templateName:"fullscreen_viewer",events:{"click .vf-fullscreen-gallery-view-left":"previousMediaItem","click .vf-fullscreen-gallery-view-right":"nextMediaItem"},initialize:function(e){o.default.bindAll(this,"previousMediaItem","nextMediaItem","onMediaDelete"),this.views=[],this.index=e.index,this.$subscribe("media","deleted",this.onMediaDelete)},render:function(){return this.templateOnly({showPagination:this.collection.length>1}),this.$mediaContainer=this.$(".vf-fullscreen-gallery-view"),this.renderMediaItem(),this.updateBackButtonDisplay(),this},renderMediaItem:function(){var e=new V({model:this.collection.at(this.index),index:this.index+1,total:this.collection.total_count});return this.$mediaContainer.html(e.render().$el),this},previousMediaItem:function(){0===this.index?this.index=this.collection.length-1:this.index-=1,0===this.index&&this.updateBackButtonDisplay(),this.renderMediaItem()},nextMediaItem:function(){if(this.collection.length<this.collection.total_count){var e=this.index===this.collection.length-1;this.index>this.collection.length-5&&this.trigger("fetchMore",e?this.renderNextItem.bind(this):null),e||this.renderNextItem()}else this.renderNextItem()},renderNextItem:function(){this.index=(this.index+1)%this.collection.length,1===this.index&&this.updateBackButtonDisplay(),this.renderMediaItem()},onMediaDelete:function(){0!==this.collection.length?(this.index>this.collection.length-1&&(this.index=this.collection.length-1),this.renderMediaItem()):window.viafoura.$publish("overlay","close")},updateBackButtonDisplay:function(){var e=this.index>0||this.collection.length===this.collection.total_count,t=e?"visible":"hidden";this.$(".vf-fullscreen-gallery-view-left").css("visibility",t).attr("aria-hidden",!e)}}),z=n(622),K=E.a.extend({templateName:"overlay",mixins:[z.a],events:{"click .vf-js-overlay-close":"closeOverlayAction"},initialize:function(e){o.default.bindAll(this,"closeOverlay","onOverlayKeydown"),this.views=[],this.setStored(e.storedEl),this.$subscribe("overlay","close",this.closeOverlay)},render:function(e){k()("body").addClass("vf-no-scroll");var t=k()(this.template());return e&&t.append(e),this.$el.replaceWith(t),this.setElement(t),this.bindTabbing(),document.body.appendChild(this.$el[0]),document.removeEventListener("keydown",this.onOverlayKeydown),document.addEventListener("keydown",this.onOverlayKeydown),this.tabTo(this.firstEl),this},renderWith:function(e){return this.views.push(e),e.render(),this.render(e.$el)},onOverlayKeydown:function(e){27===e.which&&this.closeOverlay()},closeOverlayAction:function(){window.viafoura.$publish("overlay","close")},closeOverlay:function(){k()("body").removeClass("vf-no-scroll"),this.storedEl.focus(),this.$el.remove(),document.removeEventListener("keydown",this.onOverlayKeydown)}}),Y=E.a.extend({templateName:"inline_gallery",initialize:function(e){o.default.bindAll(this,"render","initNewUploadView","openMediaGalleryOverlay","onMediaDelete","onMediaFlagged","onOverlayClose","onUserChange","removeLastChild"),e.user&&e.collection.mergeInUser(new C.a(e.user)),this.collection=e.collection,this.views=[],this.page=e.page,this.listenTo(this.currentUser,"change:id",this.onUserChange),this.$subscribe("media","deleted",this.onMediaDelete),this.$subscribe("media","flagged",this.onMediaFlagged),this.$subscribe("overlay","close",this.onOverlayClose)},onUserChange:function(){this.collection.models.forEach((function(e){e.set("flagged",!1)}))},onMediaDelete:function(e){this.collection.models.forEach((function(e){delete e.total})),e.forEach(function(e){this.collection.remove(e)}.bind(this)),this.collection.length||this.trigger("emptyGallery"),this.render()},onMediaFlagged:function(e){var t=this.collection.models.find((function(t){return t.id===e}));t&&t.set("flagged",!0)},canUpload:!1,getGalleryCountClass:function(){var e=this.canUpload?6:5;return"vf-media-gallery-".concat(e)},render:function(){this.canUpload&&this.initNewUploadView();var e=this.template({cannotUpload:!this.canUpload,galleryCountClass:this.getGalleryCountClass()}),t=this.collection.models.slice(0,5);this.collection.length>5&&(t.forEach((function(e){delete e.total})),t[t.length-1].total=this.getAdditionalCount()),this.canUpload&&e.append(this.uploadView.$el[0]),t.forEach(function(t){var i=new S({model:t});e.append(i.render().$el[0]),this.views.push(i),this.listenTo(i,"show",this.openMediaGalleryOverlay)}.bind(this)),this.setFinalClass(e),this.$el.replaceWith(e),this.setElement(e)},openMediaGalleryOverlay:function(e,t){var i=this.collection.models.findIndex((function(t){return e===t})),n=new K({storedEl:t});this.fullscreenViewer=new j({index:i,collection:this.collection}),this.listenTo(this.fullscreenViewer,"fetchMore",(function(e){e=e||function(){},this.collection.length!==this.collection.total_count?this.collection.fetchPageAfter({success:e.bind(this)}):e()})),n.renderWith(this.fullscreenViewer)},onOverlayClose:function(){this.fullscreenViewer&&(this.stopListening(this.fullscreenViewer),delete this.fullscreenViewer)},onUpload:function(e){var t=new T({upload:e});this.views.unshift(t),this.listenTo(t,"show",this.openMediaGalleryOverlay);var i=function(e){var t=e.file;return l(t)?h(t).then((function(t){e.set("preview",t)})):c(t)?f(t).then((function(t){e.set("preview",t)})):void 0}(e),n=[b(this.uploadView.$el[0],"fade-black"),i];Promise.all(n).then(function(){return w(function(){t.render(),this.uploadView.$el.replaceWith(t.$el[0]),t.enter()}.bind(this))}.bind(this)).then(this.initNewUploadView),this.listenTo(e,"afterMedia",this.onMediaComplete),this.listenTo(e,"error",this.onUploadError)},onUploadError:function(){this.render();var e=this.uploadView.$el;e.tipsy({title:"generic_error_tip",interactive:!1,live:!1,stayOpen:!0}),e.tipsy("show"),setTimeout((function(){e.tipsy("remove")}),3e3)},onMediaComplete:function(e){this.collection.add(e),this.collection.total_count++,this.slideViews()},slideViews:function(){if(_())return this.render();var e=this.uploadView.$el[0];e.classList.add("fade-enter"),e.classList.add("slide-left"),w(function(){this.$el.prepend(e)}.bind(this)).then((function(){return Promise.race([v(e,"slide-left"),new Promise((function(e){setTimeout((function(){e()}),500)}))])})).then(function(){if(this.setFinalClass(this.$el),this.collection.length>5){var e=this.$el.children().last().siblings(),t=e[e.length-1];y(t,".vf-video-processing"),this.insertNewCount(t),w(this.removeLastChild).then(function(){this.setFinalClass(this.$el)}.bind(this))}return v(this.uploadView.$el[0],"fade")}.bind(this))},setFinalClass:function(e){this.collection.length>=5&&e.children().last().addClass("vf-media-gallery-count")},initNewUploadView:function(){this.uploadView&&(this.stopListening(this.uploadView),this.uploadView.remove(),delete this.uploadView),this.uploadView=new R({page:this.page}),this.listenTo(this.uploadView,"upload",this.onUpload),this.uploadView.render()},removeLastChild:function(){var e=this.views.pop();this.stopListening(e),e.remove()},getAdditionalCount:function(){return this.collection.total_count-5},insertNewCount:function(e){var t=document.createElement("span");a.a.addClassToSVG(t,"vf-count-value"),t.innerHTML="+".concat(this.getAdditionalCount()),window.requestAnimationFrame((function(){var i=Object(s.a)(".vf-icon-play",e);i&&i.parentElement.removeChild(i);var n=Object(s.a)(".vf-js-anchor",e);n.classList.add("vf-media-gallery-count"),v(t,"fade"),n.append(t)}))}});t.a=Y}}]);